<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.266">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Telling Stories with Data - 7&nbsp; Gather data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08-hunt.html" rel="next">
<link href="./06-farm.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-farm.html">Acquisition</a></li><li class="breadcrumb-item"><a href="./07-gather.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Gather data</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Telling Stories with Data</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/RohanAlexander/telling_stories/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Telling stories with data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-drinking_from_a_fire_hose.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Drinking from a fire hose</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Reproducible workflows</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Communication</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-writing_research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Writing research</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-static_communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Static communication</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Acquisition</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-farm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Farm data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-gather.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Gather data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-hunt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Hunt data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Preparation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-clean_and_prepare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Clean and prepare</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-store_and_share.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Store and share</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Modeling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-ijalm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-ijaglm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Generalized linear models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Applications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-causality_from_obs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Causality from observational data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-mrp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Multilevel regression with post-stratification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Text as data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-concluding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Concluding remarks</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-r_essentials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">R essentials</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">R Markdown</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-assessment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Papers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-interaction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Interaction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-datasheet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Datasheets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26-sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">SQL essentials</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27-prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./28-deploy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Production</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./29-activities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Class activities</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./97-errata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Errata and updates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./98-cocktails.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">Cocktails</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">7.1</span> Introduction</a></li>
  <li><a href="#apis" id="toc-apis" class="nav-link" data-scroll-target="#apis"><span class="header-section-number">7.2</span> APIs</a>
  <ul class="collapse">
  <li><a href="#arxiv-nasa-and-dataverse" id="toc-arxiv-nasa-and-dataverse" class="nav-link" data-scroll-target="#arxiv-nasa-and-dataverse"><span class="header-section-number">7.2.1</span> arXiv, NASA, and Dataverse</a></li>
  <li><a href="#spotify" id="toc-spotify" class="nav-link" data-scroll-target="#spotify"><span class="header-section-number">7.2.2</span> Spotify</a></li>
  </ul></li>
  <li><a href="#web-scraping" id="toc-web-scraping" class="nav-link" data-scroll-target="#web-scraping"><span class="header-section-number">7.3</span> Web scraping</a>
  <ul class="collapse">
  <li><a href="#principles" id="toc-principles" class="nav-link" data-scroll-target="#principles"><span class="header-section-number">7.3.1</span> Principles</a></li>
  <li><a href="#htmlcss-essentials" id="toc-htmlcss-essentials" class="nav-link" data-scroll-target="#htmlcss-essentials"><span class="header-section-number">7.3.2</span> HTML/CSS essentials</a></li>
  <li><a href="#book-information" id="toc-book-information" class="nav-link" data-scroll-target="#book-information"><span class="header-section-number">7.3.3</span> Book information</a></li>
  <li><a href="#prime-ministers-of-the-united-kingdom" id="toc-prime-ministers-of-the-united-kingdom" class="nav-link" data-scroll-target="#prime-ministers-of-the-united-kingdom"><span class="header-section-number">7.3.4</span> Prime Ministers of the United Kingdom</a></li>
  <li><a href="#iteration" id="toc-iteration" class="nav-link" data-scroll-target="#iteration"><span class="header-section-number">7.3.5</span> Iteration</a></li>
  </ul></li>
  <li><a href="#pdfs" id="toc-pdfs" class="nav-link" data-scroll-target="#pdfs"><span class="header-section-number">7.4</span> PDFs</a>
  <ul class="collapse">
  <li><a href="#jane-eyre" id="toc-jane-eyre" class="nav-link" data-scroll-target="#jane-eyre"><span class="header-section-number">7.4.1</span> <em>Jane Eyre</em></a></li>
  <li><a href="#total-fertility-rate-in-the-united-states" id="toc-total-fertility-rate-in-the-united-states" class="nav-link" data-scroll-target="#total-fertility-rate-in-the-united-states"><span class="header-section-number">7.4.2</span> Total Fertility Rate in the United States</a></li>
  <li><a href="#optical-character-recognition" id="toc-optical-character-recognition" class="nav-link" data-scroll-target="#optical-character-recognition"><span class="header-section-number">7.4.3</span> Optical Character Recognition</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">7.5</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#scales" id="toc-scales" class="nav-link" data-scroll-target="#scales">Scales</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions">Questions</a></li>
  <li><a href="#tutorial" id="toc-tutorial" class="nav-link" data-scroll-target="#tutorial">Tutorial</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/RohanAlexander/telling_stories/edit/main/07-gather.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-gather-data" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Gather data</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><strong>Prerequisites</strong></p>
<ul>
<li>Read <em>Turning History into Data: Data Collection, Measurement, and Inference in HPE</em>, <span class="citation" data-cites="cirone">(<a href="99-references.html#ref-cirone" role="doc-biblioref">Cirone and Spirling 2021</a>)</span>
<ul>
<li>This paper discusses some of the challenges of creating datasets.</li>
</ul></li>
<li>Read <em>Two Regimes of Prison Data Collection</em>, <span class="citation" data-cites="Johnson2021Two">(<a href="99-references.html#ref-Johnson2021Two" role="doc-biblioref">Johnson 2021</a>)</span>
<ul>
<li>This paper compares data about prisons from the United States government with data from incarcerated people and the community.</li>
</ul></li>
<li>Read <em>Atlas of AI</em>, <span class="citation" data-cites="crawford">(<a href="99-references.html#ref-crawford" role="doc-biblioref">Crawford 2021</a>)</span>
<ul>
<li>Focus on Chapter 3 “Data”, which discusses the importance of understanding the sources of data.</li>
</ul></li>
</ul>
<p><strong>Key concepts and skills</strong></p>
<ul>
<li>Sometimes data are available but they are not necessarily put together for the purposes of being a dataset. We must gather the data.</li>
<li>It can be cumbersome and annoying to must clean and prepare the datasets that come from these unstructured sources but the resulting structured, tidy data are often especially exciting and useful.</li>
<li>We can gather data from a variety of sources. This includes APIs, both directly, which may involve semi-structured data, and indirectly through R packages. We can also gather data through reasonable and ethical web scraping. Finally, we may wish to gather data from PDFs.</li>
</ul>
<p><strong>Software and packages</strong></p>
<ul>
<li>Base R <span class="citation" data-cites="citeR">(<a href="99-references.html#ref-citeR" role="doc-biblioref">R Core Team 2023</a>)</span></li>
<li><code>babynames</code> <span class="citation" data-cites="citebabynames">(<a href="99-references.html#ref-citebabynames" role="doc-biblioref">Wickham 2021</a>)</span></li>
<li><code>gh</code> <span class="citation" data-cites="gh">(<a href="99-references.html#ref-gh" role="doc-biblioref">Bryan and Wickham 2021</a>)</span></li>
<li><code>here</code> <span class="citation" data-cites="here">(<a href="99-references.html#ref-here" role="doc-biblioref">Müller 2020</a>)</span></li>
<li><code>httr</code> <span class="citation" data-cites="citehttr">(<a href="99-references.html#ref-citehttr" role="doc-biblioref">Wickham 2023</a>)</span></li>
<li><code>janitor</code> <span class="citation" data-cites="janitor">(<a href="99-references.html#ref-janitor" role="doc-biblioref">Firke 2023</a>)</span></li>
<li><code>jsonlite</code> <span class="citation" data-cites="jsonlite">(<a href="99-references.html#ref-jsonlite" role="doc-biblioref">Ooms 2014</a>)</span></li>
<li><code>knitr</code> <span class="citation" data-cites="citeknitr">(<a href="99-references.html#ref-citeknitr" role="doc-biblioref">Xie 2023</a>)</span></li>
<li><code>lubridate</code> <span class="citation" data-cites="GrolemundWickham2011">(<a href="99-references.html#ref-GrolemundWickham2011" role="doc-biblioref">Grolemund and Wickham 2011</a>)</span></li>
<li><code>pdftools</code> <span class="citation" data-cites="pdftools">(<a href="99-references.html#ref-pdftools" role="doc-biblioref">Ooms 2022a</a>)</span></li>
<li><code>purrr</code> <span class="citation" data-cites="citepurrr">(<a href="99-references.html#ref-citepurrr" role="doc-biblioref">Wickham and Henry 2022</a>)</span></li>
<li><code>rvest</code> <span class="citation" data-cites="citervest">(<a href="99-references.html#ref-citervest" role="doc-biblioref">Wickham 2022</a>)</span></li>
<li><code>spotifyr</code> <span class="citation" data-cites="spotifyr">(<a href="99-references.html#ref-spotifyr" role="doc-biblioref">Thompson et al. 2022</a>)</span></li>
<li><code>tesseract</code> <span class="citation" data-cites="citetesseract">(<a href="99-references.html#ref-citetesseract" role="doc-biblioref">Ooms 2022b</a>)</span></li>
<li><code>tidyverse</code> <span class="citation" data-cites="tidyverse">(<a href="99-references.html#ref-tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span></li>
<li><code>usethis</code> <span class="citation" data-cites="usethis">(<a href="99-references.html#ref-usethis" role="doc-biblioref">Wickham, Bryan, and Barrett 2022</a>)</span></li>
<li><code>xml2</code> <span class="citation" data-cites="xml2">(<a href="99-references.html#ref-xml2" role="doc-biblioref">Wickham, Hester, and Ooms 2021</a>)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(babynames)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gh)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdftools)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spotifyr)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tesseract)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(usethis)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="introduction" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">7.1</span> Introduction</h2>
<p>In this chapter we consider data that we must gather ourselves. This means that although the observations exist, we must parse, pull, clean, and prepare them to get the dataset that we will consider. In contrast to farmed data, discussed in <a href="06-farm.html"><span>Chapter&nbsp;6</span></a>, often these observations are not being made available for the purpose of analysis. This means that we need to be especially concerned with documentation, inclusion and exclusion decisions, missing data, and ethical behavior.</p>
<p>As an example of such a dataset, consider <span class="citation" data-cites="Cummins2022">Cummins (<a href="99-references.html#ref-Cummins2022" role="doc-biblioref">2022</a>)</span> who create a dataset using individual-level probate records from England between 1892 and 1992. They find that about one-third of the inheritance of “elites” is concealed. Similarly, <span class="citation" data-cites="Taflaga2019">Taflaga and Kerby (<a href="99-references.html#ref-Taflaga2019" role="doc-biblioref">2019</a>)</span> construct a systematic dataset of job responsibilities based on Australian Ministerial telephone directories. They find substantial differences by gender. Neither wills nor telephone directories were created for the purpose of being included in a dataset. But with a respectful approach they enable insights that we could not get by other means. We term this “data gathering”—the data exist but we need to get them.</p>
<p>Decisions need to be made at the start of a project about the values we want the project to have. For instance, <span class="citation" data-cites="huggingfaceethics">Saulnier et al. (<a href="99-references.html#ref-huggingfaceethics" role="doc-biblioref">2022</a>)</span> value transparency, reproducibility, fairness, being self-critical, and giving credit. How might that affect the project? Valuing “giving credit” might mean being especially zealous about attribution and licensing. In the case of gathered data we should give special thought to this as the original, unedited data may not be ours.</p>
<p>The results of a data science workflow cannot be better than their underlying data <span class="citation" data-cites="bailey2008design">(<a href="99-references.html#ref-bailey2008design" role="doc-biblioref">Bailey 2008</a>)</span>. Even the most-sophisticated statistical analysis will struggle to adjust for poorly-gathered data. This means when working in a team, data gathering should be overseen and at least partially conducted by senior members of the team. And when working by yourself, try to give special consideration and care to this stage.</p>
<p>In this chapter we go through a variety of approaches for gathering data. We begin with the use of APIs and semi-structured data, such as JSON and XML. Using an API is typically a situation in which the data provider has specified the conditions under which they are comfortable providing access. An API allows us to write code to gather data. This is valuable because it can be efficient and scales well. Developing comfort with gathering data through APIs enables access to exciting datasets. For instance, <span class="citation" data-cites="facebookapitrump">Wong (<a href="99-references.html#ref-facebookapitrump" role="doc-biblioref">2020</a>)</span> use the Facebook Political Ad API to gather 218,100 of the Trump 2020 campaign ads to better understand the campaign.</p>
<p>We then turn to web scraping, which we may want to use when there are data available on a website. As these data have typically not been put together for the purposes of being a dataset, it is especially important to have deliberate and definite values for the project. Scraping is a critical part of data gathering because there are many data sources where the priorities of the data provider mean they have not implemented an API. For instance, considerable use of web scraping was critical for creating COVID-19 dashboards in the early days of the pandemic <span class="citation" data-cites="scrapecoviddata">(<a href="99-references.html#ref-scrapecoviddata" role="doc-biblioref">Eisenstein 2022</a>)</span>.</p>
<p>Finally, we consider gathering data from PDFs. This enables the construction of interesting datasets, especially those contained in government reports and old books. Indeed, while freedom of information legislation exists in many countries and require the government to make data available, these all too often result in spreadsheets being shared as PDFs, even when they were a CSV to begin with.</p>
<p>Gathering data can require more of us than using farmed data, but it allows us to explore datasets and answer questions that we could not otherwise. Some of the most exciting work in the world uses gathered data, but it is especially important that we approach it with respect.</p>
</section>
<section id="apis" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="apis"><span class="header-section-number">7.2</span> APIs</h2>
<p>In everyday language, and for our purposes, an Application Programming Interface (API) is a situation in which someone has set up specific files on their computer such that we can follow their instructions to get them. For instance, when we use a gif on Slack, one way it could work in the background is that Slack asks Giphy’s server for the appropriate gif, Giphy’s server gives that gif to Slack, and then Slack inserts it into the chat. The way in which Slack and Giphy interact is determined by Giphy’s API. More strictly, an API is an application that runs on a server that we access using the HTTP protocol.</p>
<p>Here we focus on using APIs for gathering data. In that context an API is a website that is set up for another computer to be able to access it, rather than a person. For instance, we could go to <a href="https://www.google.com/maps">Google Maps</a>. And we could then scroll and click and drag to center the map on, say, Canberra, Australia. Or we could paste <a href="https://www.google.com/maps/@-35.2812958,149.1248113,16z">this link</a> into the browser. By pasting that link, rather than navigating, we have mimicked how we will use an API: provide a URL and be given something back. In this case the result should be a map like <a href="#fig-focuson2020">Figure&nbsp;<span>7.1</span></a>.</p>
<div id="fig-focuson2020" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/07-googlemaps_canberra.png" class="quarto-discovered-preview-image img-fluid figure-img" style="width:75.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.1: Example of an API response from Google Maps, as of 12 February 2023</figcaption><p></p>
</figure>
</div>
<p>The advantage of using an API is that the data provider usually specifies the data that they are willing to provide, and the terms under which they will provide it. These terms may include aspects such as rate limits (i.e.&nbsp;how often we can ask for data), and what we can do with the data, for instance, we might not be allowed to use it for commercial purposes, or to republish it. As the API is being provided specifically for us to use it, it is less likely to be subject to unexpected changes or legal issues. Because of this it is clear that when an API is available, we should try to use it rather than web scraping.</p>
<p>We will now go through a few case studies of using APIs. In the first we deal directly with an API using <code>httr</code>. And then we access data from Spotify using <code>spotifyr</code>.</p>
<section id="arxiv-nasa-and-dataverse" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="arxiv-nasa-and-dataverse"><span class="header-section-number">7.2.1</span> arXiv, NASA, and Dataverse</h3>
<p>After installing and loading <code>httr</code> we use <code>GET()</code> to obtain data from an API directly. This will try to get some specific data and the main argument is “url”. This is similar to the Google Maps example in <a href="#fig-focuson2020">Figure&nbsp;<span>7.1</span></a> where the specific information that we were interested in was a map.</p>
<section id="arxiv" class="level4" data-number="7.2.1.1">
<h4 data-number="7.2.1.1" class="anchored" data-anchor-id="arxiv"><span class="header-section-number">7.2.1.1</span> arXiv</h4>
<p>In this case study we will use an <a href="https://arxiv.org/help/api/">API provided by arXiv</a>. arXiv is an online repository for academic papers before they go through peer review. These papers are typically referred to as “pre-prints”. We use <code>GET()</code> to ask arXiv to obtain some information about a pre-print by providing a URL.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>arxiv <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"http://export.arxiv.org/api/query?id_list=2111.09299"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">status_code</span>(arxiv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 200</code></pre>
</div>
</div>
<p>We can use <code>status_code()</code> to check our response. For instance, 200 means a success, while 400 means we received an error from the server. Assuming we received something back from the server, we can use <code>content()</code> to display it. In this case we have received XML formatted data. XML is a markup language where entries are identified by tags, which can be nested within other tags. After installing and loading <code>xml2</code> we can read XML using <code>read_xml()</code>. XML is a semi-formatted structure, and it can be useful to start by having a look at it using <code>html_structure()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">content</span>(arxiv) <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_xml</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_structure</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;feed [xmlns]&gt;
  &lt;link [href, rel, type]&gt;
  &lt;title [type]&gt;
    {text}
  &lt;id&gt;
    {text}
  &lt;updated&gt;
    {text}
  &lt;totalResults [xmlns:opensearch]&gt;
    {text}
  &lt;startIndex [xmlns:opensearch]&gt;
    {text}
  &lt;itemsPerPage [xmlns:opensearch]&gt;
    {text}
  &lt;entry&gt;
    &lt;id&gt;
      {text}
    &lt;updated&gt;
      {text}
    &lt;published&gt;
      {text}
    &lt;title&gt;
      {text}
    &lt;summary&gt;
      {text}
    &lt;author&gt;
      &lt;name&gt;
        {text}
    &lt;author&gt;
      &lt;name&gt;
        {text}
    &lt;comment [xmlns:arxiv]&gt;
      {text}
    &lt;link [href, rel, type]&gt;
    &lt;link [title, href, rel, type]&gt;
    &lt;primary_category [term, scheme, xmlns:arxiv]&gt;
    &lt;category [term, scheme]&gt;</code></pre>
</div>
</div>
<p>We might like to create a dataset based on extracting various aspects of this XML tree. For instance, we might look at “entry”, which is the eighth item, and in particular obtain the “title” and the “URL”, which are the fourth and ninth items, respectively, within “entry”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data_from_arxiv <span class="ot">&lt;-</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">content</span>(arxiv) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_xml</span>() <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xml_child</span>(<span class="at">search =</span> <span class="dv">8</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xml_child</span>(<span class="at">search =</span> <span class="dv">4</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xml_text</span>(),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">link =</span> <span class="fu">content</span>(arxiv) <span class="sc">|&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_xml</span>() <span class="sc">|&gt;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xml_child</span>(<span class="at">search =</span> <span class="dv">8</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xml_child</span>(<span class="at">search =</span> <span class="dv">9</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xml_attr</span>(<span class="st">"href"</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>data_from_arxiv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  title                                                                    link 
  &lt;chr&gt;                                                                    &lt;chr&gt;
1 "The Increased Effect of Elections and Changing Prime Ministers on Topi… http…</code></pre>
</div>
</div>
</section>
<section id="nasa-astronomy-picture-of-the-day" class="level4" data-number="7.2.1.2">
<h4 data-number="7.2.1.2" class="anchored" data-anchor-id="nasa-astronomy-picture-of-the-day"><span class="header-section-number">7.2.1.2</span> NASA Astronomy Picture of the Day</h4>
<p>To consider another example, each day, NASA provides the Astronomy Picture of the Day (APOD) through its <a href="https://api.nasa.gov">APOD API</a>. We can use <code>GET()</code> to obtain the URL for the photo on particular dates and then display it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>NASA_APOD_20190719 <span class="ot">&lt;-</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">GET</span>(<span class="st">"https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY&amp;date=2019-07-19"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Examining the returned data using <code>content()</code>, we can see that we are provided with various fields, such as date, title, explanation, and a URL.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># APOD July 19, 2019</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">content</span>(NASA_APOD_20190719)<span class="sc">$</span>date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2019-07-19"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">content</span>(NASA_APOD_20190719)<span class="sc">$</span>title</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tranquility Base Panorama"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">content</span>(NASA_APOD_20190719)<span class="sc">$</span>explanation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "On July 20, 1969 the Apollo 11 lunar module Eagle safely touched down on the Moon. It landed near the southwestern corner of the Moon's Mare Tranquillitatis at a landing site dubbed Tranquility Base. This panoramic view of Tranquility Base was constructed from the historic photos taken from the lunar surface. On the far left astronaut Neil Armstrong casts a long shadow with Sun is at his back and the Eagle resting about 60 meters away ( AS11-40-5961). He stands near the rim of 30 meter-diameter Little West crater seen here to the right ( AS11-40-5954). Also visible in the foreground is the top of the camera intended for taking stereo close-ups of the lunar surface."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">content</span>(NASA_APOD_20190719)<span class="sc">$</span>url</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://apod.nasa.gov/apod/image/1907/apollo11TranquilitybasePan600h.jpg"</code></pre>
</div>
</div>
<p>We can provide that URL to <code>include_graphics()</code> from <code>knitr</code> to display it (<a href="#fig-nasaone">Figure&nbsp;<span>7.3</span></a>).</p>
<div id="fig-nasaone" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="fig-nasamoon" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/apollo11TranquilitybasePan.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.2: Tranquility Base Panorama (Image Credit: Neil Armstrong, Apollo 11, NASA)</figcaption><p></p>
</figure>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.3: Images obtained from the NASA APOD API</figcaption><p></p>
</figure>
</div>
</section>
<section id="dataverse" class="level4" data-number="7.2.1.3">
<h4 data-number="7.2.1.3" class="anchored" data-anchor-id="dataverse"><span class="header-section-number">7.2.1.3</span> Dataverse</h4>
<p>Finally, another common API response in semi-structured form is JSON. JSON is a human-readable way to store data that can be parsed by machines. In contrast to, say, a CSV, where we are used to rows and columns, JSON uses key-value pairs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  "firstName"<span class="in">: "Rohan</span>"<span class="op">,</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  "lastName"<span class="in">: "Alexander</span>"<span class="op">,</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  "age"<span class="in">: 36,</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  "favFoods"<span class="in">: {</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    "first"<span class="in">: "Pizza</span>"<span class="op">,</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    "second"<span class="in">: "Bagels</span>"<span class="op">,</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    "third"<span class="in">: null</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<style type="text/css">
{
  "firstName": "Rohan",
  "lastName": "Alexander",
  "age": 36,
  "favFoods": {
    "first": "Pizza",
    "second": "Bagels",
    "third": null
  }
}
</style>
</div>
<p>We can parse JSON with <code>jsonlite</code>. To consider a specific example, we use a “Dataverse” which is a web application that makes it easier to share datasets. We can use an API to query a demonstration dataverse. For instance, we might be interested in datasets related to politics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>politics_datasets <span class="ot">&lt;-</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fromJSON</span>(<span class="st">"https://demo.dataverse.org/api/search?q=politics"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>politics_datasets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$status
[1] "OK"

$data
$data$q
[1] "politics"

$data$total_count
[1] 9

$data$start
[1] 0

$data$spelling_alternatives
named list()

$data$items
                                                                                               name
1                                                                              CAP - United Kingdom
2                                                                           China Archive Dataverse
3 Policy Dynamics and Government Attention over Welfare Policies: An Analysis of the Brazilian Case
4                                                              Aspetti della vita quotidiana (2016)
5                                                              Aspetti della vita quotidiana (2020)
6                                                                                   CAP - Australia
7                                                                                       table_1.tab
8                                                                      cora-efc2000-E-2000-4_F1.tab
9                                                                                        survey.tab
       type                                                    url
1 dataverse            https://demo.dataverse.org/dataverse/CAP_UK
2 dataverse     https://demo.dataverse.org/dataverse/china-archive
3   dataset                    https://doi.org/10.70122/FK2/ZR9M6C
4   dataset                    https://doi.org/10.70122/FK2/ZKZPSJ
5   dataset                    https://doi.org/10.70122/FK2/NJ77JM
6 dataverse     https://demo.dataverse.org/dataverse/CAP_Australia
7      file https://demo.dataverse.org/api/access/datafile/2029365
8      file https://demo.dataverse.org/api/access/datafile/2069367
9      file https://demo.dataverse.org/api/access/datafile/2077715
     identifier
1        CAP_UK
2 china-archive
3          &lt;NA&gt;
4          &lt;NA&gt;
5          &lt;NA&gt;
6 CAP_Australia
7          &lt;NA&gt;
8          &lt;NA&gt;
9          &lt;NA&gt;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     description
1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            The UK Policy Agendas Project seeks to develop systematic measures of the policy agenda of British government and politics over time. It applies the policy content coding system of the original Policy Agendas Project in the United States, founded by Frank Baumgartner and Bryan Jones, with the aim of creating a consistent record of the issues that are attended to at different points in time, across many of the main venues of British public policy and politics – namely in parliament, the media and public opinion. The reliability of these measures of policy attention are ensured through adherence to clearly defined coding rules and standards, which give us confidence that changes in the priorities of government can be tracked consistently over time and in different arenas of politics. Location: University of Edinburgh; University of Southampton Downloadable Data Series: 12 Time Span: 1910-2015 Total Observations: 125,539
2 Introduction The China Archive is a data archive dedicated to support of scholarly, empirical research by anthropologists, economists, historians, political scientists, sociologists, and others in the fields of business, agriculture, and engineering. The goal of the Archive is to enable case research on Chinese domestic matters and China–U.S. relations, as well as to facilitate the inclusion of China in more broadly comparative studies. To that end, the Archive’s mission includes: acquiring and maintaining extant data sets and data sources on an ongoing basis, facilitating production of quantitative data from textual information when such is desirable and feasible, making all of the Archive’s data available on a user-friendly basis to scholars at and visiting Texas A&amp;M University, and establishing web-based links to searchable electronic sources of information on China. As long-term goals, The China Archive is especially dedicated to: locating and acquiring difficult-to-obtain Chinese data such as public opinion data, making as many of the holdings as possible available online or via other computer media, and providing capability for converting textual data to numerical data suitable for quantitative analysis. In keeping with these goals, the Archive includes data sets collected by individuals and research centers/institutes as well as by government agencies. The Archive was planned by a faculty committee in 2002–2003, and is now a project of the Texas A&amp;M University Libraries. A faculty committee continues to function as an advisory committee to the Libraries on matters related to the upkeep and expansion of The China Archive. The faculty committee is, in turn, advised by an External Advisory Panel, composed of China scholars from other academic institutions in the United States. Faculty Planning Committee Bob Harmel, Archive Planning Committee Chair; Political Science; Director, Program in the Cross-National Study of Politics Stephen Atkins, Sterling Evans Library Ben Crouch, Associate Dean, College of Liberal Arts Qi Li, Department of Economics Xinsheng Liu, Institute for Science, Technology and Public Policy, Bush School of Government and Public Service; School of Government, Peking University Rick Nader, Director, Institute for Pacific Asia Dudley Poston, Professor of Sociology and Abell Professor of Liberal Arts Raghavan (Srini) Srinivasan, Director, Spatial Sciences Laboratory, Texas Agriculture Experiment Station Di Wang, Assistant Professor of History Ben Wu, Associate Professor, Rangeland Ecology and Management Wei Zhao, Professor, Computer Science; Associate Vice President for Research Dianzhi (Dan) Sui, Department of Geography
3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             The recognition of issues as public problems and the ways governments prioritize them constitute focal points in the study of policy change and policy dynamics. In Brazil and other Latin American countries, social welfare systems and related policies have undergone transformations throughout the recent democratic period. This article aims to understand changes in the Brazilian social welfare agenda by means of an analysis of the attention given to social welfare policies at the federal level. The main analytical and methodological contribution of this article is its use of the research strategy developed under the Comparative Agendas Project (CAP) to analyze the Brazilian situation. We drew on a set of unpublished datasets on the attention given by governments to social welfare policies from 1988 to 2018 that involves more than one thousand observations across six different datasets. The analyses are made at two different levels: first, we seek to understand macro trends and moments of continuity and inflection in social welfare policy by federal government administration. Second, we analyze the composition of the attention given to social welfare policies, thereby identifying the themes given the highest priority.
4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       The survey Aspects of Daily Life, which is part of an integrated system of social surveys – Multiscopo ISTAT – reveals the basic information relating to the daily lives of individuals and families. Since 1993, the survey is conducted annually and the information gathered provides insight into the habits of citizens and the problems they face every day. The main topics of the survey are: eating habits smoking habits (electronic cigarettes too) health conditions mass-media use PC and Internet use, IT skills cell phone use cultural consumption (films, concerts, performances, exhibition, reading books, etc.) religious, political, and social participation use of public services and public utility services and degree of satisfaction use of health services and degree of satisfaction environmental issues safety trust in people and institutions education daily commuting leisure time domestic accidents physical activity and sports family life and friendship working conditions use of the justice system characteristics of the house and the area possession of home appliances and means of transport possession of IT equipment access to Internet household economic situation
5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   The survey Aspects of Daily Life, which is part of an integrated system of social surveys – Multiscopo ISTAT – reveals the basic information relating to the daily lives of individuals and families. Since 1993, the survey is conducted annually and the information gathered provides insight into the habits of citizens and the problems they face every day. The main topics of the survey are: eating habits and alcohol consumption smoking habits (electronic cigarettes too) health conditions mass-media use libraries use PC and Internet use, IT skills purchase of goods and services online cell phone/smartphone use cultural consumption (cinema, theatre, books) religious, political, and social participation use of public services and public utility services and degree of satisfaction use of health services and degree of satisfaction environmental issues safety general satisfaction, trust in people and institutions relationship with local territory education and training daily commuting leisure time domestic accidents physical activity and sports relationship with friends, family and neighbourhood working conditions electricity and gas consumption characteristics of the house and the area private services to households accessibility to the area services possession of home appliances and means of transport possession of books and of IT equipment, Internet connection household economic situation
6                                                                                                                                                                                                                                         The Australian Policy Agendas Project collects and organizes data on Australian legislation, executive speeches, opposition questions, public opinion, media coverage, and High Court decisions. Some details are listed below. Data is forthcoming. Decisions of the High Court of Australia This dataset contains information on every case decided by the High Court of Australia between the years 1970 and 2015. Cases serve as the unit of analysis. Each case was coded in terms of its policy content and several other variables controlling for the nature of the case and the nature of the court. In coding for policy content, we utilized the Comparative Agendas Project’s topics coding scheme, where each case was assigned both a major topic and a sub topic depending on its policy content. A full description of these categories and their corresponding codes may be found in the codebook. Sydney Morning Herald - Front Page Articles This dataset contains information on each article published on the Sydney Morning Herald's front page for each day from 1990 through 2015. Front page articles serve as the unit of analysis. Each article was coded in terms of its policy content and other variables of interest controlling for location, political context, and key actors. In coding for policy content, we utilized the Comparative Agendas Project’s major topics coding scheme, where each article was assigned a major topic code. A full description of the policy content categories and their corresponding codes may be found in the major topics codebook. Dr. Keith Dowding (ANU), Dr. Aaron Martin (Melbourne), and Dr. Rhonda Evans (UT-Austin) lead the Australian Policy Agendas Project. Dr. Dowding and Dr. Martin coded legislation, executive speeches, opposition questions, public opinion, and media data, and Dr. Evans collected data on decisions of the High Court of Australia as well as additional media data. Data is forthcoming. Principal Investigator: Dr. Keith Dowding, Dr. Aaron Martin, Dr. Rhonda Evans Location: Australian National University, University of Melbourne, The University of Texas at Austin Downloadable Data Series: 1 Time Span: 1970-2015 Total Observations: 2,548 Sponsoring Institutions Dr. Dowding and Dr. Martin’s research was funded by the Australian Research Council Discovery Award DP 110102622. Dr. Evans’ research is funded by the Edward A. Clark Center for Australian and New Zealand Studies at The University of Texas at Austin.
7                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       raw data to use to created cem data file
8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           &lt;NA&gt;
9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           &lt;NA&gt;
          published_at               global_id
1 2023-06-06T17:18:53Z                    &lt;NA&gt;
2 2016-12-09T15:13:22Z                    &lt;NA&gt;
3 2022-09-06T07:18:10Z doi:10.70122/FK2/ZR9M6C
4 2022-11-22T15:27:16Z doi:10.70122/FK2/ZKZPSJ
5 2023-02-28T11:10:06Z doi:10.70122/FK2/NJ77JM
6 2023-06-06T17:18:42Z                    &lt;NA&gt;
7 2023-03-06T22:13:12Z                    &lt;NA&gt;
8 2023-06-16T16:27:13Z                    &lt;NA&gt;
9 2023-08-16T18:57:34Z                    &lt;NA&gt;
                               publisher
1                                   &lt;NA&gt;
2                                   &lt;NA&gt;
3                        Academia Xavier
4 UniData Bicocca Data Archive Dataverse
5 UniData Bicocca Data Archive Dataverse
6                                   &lt;NA&gt;
7                                   &lt;NA&gt;
8                                   &lt;NA&gt;
9                                   &lt;NA&gt;
                                                                                                                                                                                                                                                                                                                     citationHtml
1                                                                                                                                                                                                                                                                                                                            &lt;NA&gt;
2                                                                                                                                                                                                                                                                                                                            &lt;NA&gt;
3 Brasil, Felipe Gon&amp;ccedil;alves; Bichir, Renata, 2022, "Policy Dynamics and Government Attention over Welfare Policies: An Analysis of the Brazilian Case", &lt;a href="https://doi.org/10.70122/FK2/ZR9M6C" target="_blank"&gt;https://doi.org/10.70122/FK2/ZR9M6C&lt;/a&gt;, Demo Dataverse, V1, UNF:6:AUntVYA8//WWvy37I1fn/w== [fileUNF]
4                                                                                                                                                  Istat, 2022, "Aspetti della vita quotidiana (2016)", &lt;a href="https://doi.org/10.70122/FK2/ZKZPSJ" target="_blank"&gt;https://doi.org/10.70122/FK2/ZKZPSJ&lt;/a&gt;, Demo Dataverse, V1
5                                                                                                                                                  Istat, 2023, "Aspetti della vita quotidiana (2020)", &lt;a href="https://doi.org/10.70122/FK2/NJ77JM" target="_blank"&gt;https://doi.org/10.70122/FK2/NJ77JM&lt;/a&gt;, Demo Dataverse, V1
6                                                                                                                                                                                                                                                                                                                            &lt;NA&gt;
7                                                                                                                                                                                                                                                                                                                            &lt;NA&gt;
8                                                                                                                                                                                                                                                                                                                            &lt;NA&gt;
9                                                                                                                                                                                                                                                                                                                            &lt;NA&gt;
  identifier_of_dataverse                      name_of_dataverse
1                    &lt;NA&gt;                                   &lt;NA&gt;
2                    &lt;NA&gt;                                   &lt;NA&gt;
3          academiaxavier                        Academia Xavier
4                   dassi UniData Bicocca Data Archive Dataverse
5                   dassi UniData Bicocca Data Archive Dataverse
6                    &lt;NA&gt;                                   &lt;NA&gt;
7                    &lt;NA&gt;                                   &lt;NA&gt;
8                    &lt;NA&gt;                                   &lt;NA&gt;
9                    &lt;NA&gt;                                   &lt;NA&gt;
                                                                                                                                                                                                                                                citation
1                                                                                                                                                                                                                                                   &lt;NA&gt;
2                                                                                                                                                                                                                                                   &lt;NA&gt;
3 Brasil, Felipe Gonçalves; Bichir, Renata, 2022, "Policy Dynamics and Government Attention over Welfare Policies: An Analysis of the Brazilian Case", https://doi.org/10.70122/FK2/ZR9M6C, Demo Dataverse, V1, UNF:6:AUntVYA8//WWvy37I1fn/w== [fileUNF]
4                                                                                                                                           Istat, 2022, "Aspetti della vita quotidiana (2016)", https://doi.org/10.70122/FK2/ZKZPSJ, Demo Dataverse, V1
5                                                                                                                                           Istat, 2023, "Aspetti della vita quotidiana (2020)", https://doi.org/10.70122/FK2/NJ77JM, Demo Dataverse, V1
6                                                                                                                                                                                                                                                   &lt;NA&gt;
7                                                                                                                                                                                                                                                   &lt;NA&gt;
8                                                                                                                                                                                                                                                   &lt;NA&gt;
9                                                                                                                                                                                                                                                   &lt;NA&gt;
         storageIdentifier
1                     &lt;NA&gt;
2                     &lt;NA&gt;
3 s3://10.70122/FK2/ZR9M6C
4 s3://10.70122/FK2/ZKZPSJ
5 s3://10.70122/FK2/NJ77JM
6                     &lt;NA&gt;
7                     &lt;NA&gt;
8                     &lt;NA&gt;
9                     &lt;NA&gt;
                                                                                  keywords
1                                                                                     NULL
2                                                                                     NULL
3 Policy change, Welfare policy, Punctuated equilibrium, Policy dynamics, Policy attention
4                                                                                     NULL
5                                                                                     NULL
6                                                                                     NULL
7                                                                                     NULL
8                                                                                     NULL
9                                                                                     NULL
         subjects fileCount versionId versionState majorVersion minorVersion
1            NULL        NA        NA         &lt;NA&gt;           NA           NA
2            NULL        NA        NA         &lt;NA&gt;           NA           NA
3 Social Sciences        10    220301     RELEASED            1            1
4 Social Sciences         0    223199     RELEASED            1            0
5 Social Sciences         0    226493     RELEASED            1            0
6            NULL        NA        NA         &lt;NA&gt;           NA           NA
7            NULL        NA        NA         &lt;NA&gt;           NA           NA
8            NULL        NA        NA         &lt;NA&gt;           NA           NA
9            NULL        NA        NA         &lt;NA&gt;           NA           NA
             createdAt            updatedAt
1                 &lt;NA&gt;                 &lt;NA&gt;
2                 &lt;NA&gt;                 &lt;NA&gt;
3 2022-09-06T01:38:45Z 2022-09-06T11:38:01Z
4 2022-11-22T15:26:43Z 2022-11-22T15:27:16Z
5 2023-02-27T12:57:28Z 2023-02-28T11:10:06Z
6                 &lt;NA&gt;                 &lt;NA&gt;
7                 &lt;NA&gt;                 &lt;NA&gt;
8                 &lt;NA&gt;                 &lt;NA&gt;
9                 &lt;NA&gt;                 &lt;NA&gt;
                                            contacts
1                                               NULL
2                                               NULL
3 Oliveira, Gustavo, Academia Xavier (Bibliotecário)
4                                            DASSI, 
5        Data Archive for Social Sciences in Italy, 
6                                               NULL
7                                               NULL
8                                               NULL
9                                               NULL
                                                                                                                                                                                                                                publications
1                                                                                                                                                                                                                                       NULL
2                                                                                                                                                                                                                                       NULL
3 Brasil, Felipe Gonçalves; Bichir, Renata. "Policy Dynamics and Government Attention over Welfare Policies: An Analysis of the Brazilian Case." Braz. political sci. rev. 16 (1) • 2022. DOI: https://doi.org/10.1590/1981-3821202200010006
4                                                                                                                                                                                                                                       NULL
5                                                                                                                                                                                                                                       NULL
6                                                                                                                                                                                                                                       NULL
7                                                                                                                                                                                                                                       NULL
8                                                                                                                                                                                                                                       NULL
9                                                                                                                                                                                                                                       NULL
                                   authors file_id     file_type
1                                     NULL    &lt;NA&gt;          &lt;NA&gt;
2                                     NULL    &lt;NA&gt;          &lt;NA&gt;
3 Brasil, Felipe Gonçalves, Bichir, Renata    &lt;NA&gt;          &lt;NA&gt;
4                                    Istat    &lt;NA&gt;          &lt;NA&gt;
5                                    Istat    &lt;NA&gt;          &lt;NA&gt;
6                                     NULL    &lt;NA&gt;          &lt;NA&gt;
7                                     NULL 2029365 Tab-Delimited
8                                     NULL 2069367 Tab-Delimited
9                                     NULL 2077715 Tab-Delimited
          file_content_type size_in_bytes                              md5
1                      &lt;NA&gt;            NA                             &lt;NA&gt;
2                      &lt;NA&gt;            NA                             &lt;NA&gt;
3                      &lt;NA&gt;            NA                             &lt;NA&gt;
4                      &lt;NA&gt;            NA                             &lt;NA&gt;
5                      &lt;NA&gt;            NA                             &lt;NA&gt;
6                      &lt;NA&gt;            NA                             &lt;NA&gt;
7 text/tab-separated-values        596398 37e83da30d716060ca5d7f289de2ac5f
8 text/tab-separated-values        908083 a2d42bc2d8acf0dd224116c96b93a77e
9 text/tab-separated-values       1565999 2160f247e7b739c19c6b123eba8d8adb
  checksum.type                   checksum.value                            unf
1          &lt;NA&gt;                             &lt;NA&gt;                           &lt;NA&gt;
2          &lt;NA&gt;                             &lt;NA&gt;                           &lt;NA&gt;
3          &lt;NA&gt;                             &lt;NA&gt;                           &lt;NA&gt;
4          &lt;NA&gt;                             &lt;NA&gt;                           &lt;NA&gt;
5          &lt;NA&gt;                             &lt;NA&gt;                           &lt;NA&gt;
6          &lt;NA&gt;                             &lt;NA&gt;                           &lt;NA&gt;
7           MD5 37e83da30d716060ca5d7f289de2ac5f UNF:6:7pIYE/ETWB2c1Jei5fwA6w==
8           MD5 a2d42bc2d8acf0dd224116c96b93a77e UNF:6:aP35eeDYtLi99gqAeHK5yA==
9           MD5 2160f247e7b739c19c6b123eba8d8adb UNF:6:xvDAh14r4cr+Mec/kK5suQ==
              file_persistent_id
1                           &lt;NA&gt;
2                           &lt;NA&gt;
3                           &lt;NA&gt;
4                           &lt;NA&gt;
5                           &lt;NA&gt;
6                           &lt;NA&gt;
7 doi:10.70122/FK2/W5RRCR/FLR3JK
8 doi:10.70122/FK2/HWIRHD/IOGVHM
9 doi:10.70122/FK2/HUUQPF/KC6EHB
                                                                                dataset_name
1                                                                                       &lt;NA&gt;
2                                                                                       &lt;NA&gt;
3                                                                                       &lt;NA&gt;
4                                                                                       &lt;NA&gt;
5                                                                                       &lt;NA&gt;
6                                                                                       &lt;NA&gt;
7 Replication Data for "School Shootings, Protests and the Gun Culture in the United States"
8                                                                                      test2
9                                                              Darwin's Finches: CC0 License
  dataset_id   dataset_persistent_id
1       &lt;NA&gt;                    &lt;NA&gt;
2       &lt;NA&gt;                    &lt;NA&gt;
3       &lt;NA&gt;                    &lt;NA&gt;
4       &lt;NA&gt;                    &lt;NA&gt;
5       &lt;NA&gt;                    &lt;NA&gt;
6       &lt;NA&gt;                    &lt;NA&gt;
7    2029363 doi:10.70122/FK2/W5RRCR
8    2008345 doi:10.70122/FK2/HWIRHD
9    2023467 doi:10.70122/FK2/HUUQPF
                                                                                                                                                                                                     dataset_citation
1                                                                                                                                                                                                                &lt;NA&gt;
2                                                                                                                                                                                                                &lt;NA&gt;
3                                                                                                                                                                                                                &lt;NA&gt;
4                                                                                                                                                                                                                &lt;NA&gt;
5                                                                                                                                                                                                                &lt;NA&gt;
6                                                                                                                                                                                                                &lt;NA&gt;
7 Olzak, Susan, 2023, "Replication Data for "School Shootings, Protests and the Gun Culture in the United States"", https://doi.org/10.70122/FK2/W5RRCR, Demo Dataverse, V1, UNF:6:3FFG3U7z859Y+Ujet+CeKA== [fileUNF]
8                                                                                        Myers, Jim, 2022, "test2", https://doi.org/10.70122/FK2/HWIRHD, Demo Dataverse, V2, UNF:6:aP35eeDYtLi99gqAeHK5yA== [fileUNF]
9                                                              Finch, Fiona, 2023, "Darwin's Finches: CC0 License", https://doi.org/10.70122/FK2/HUUQPF, Demo Dataverse, V3, UNF:6:e1mgFxJtO5XDCjJXlHrP7g== [fileUNF]

$data$count_in_response
[1] 9</code></pre>
</div>
</div>
<p>We could look at the dataset using <code>View(politics_datasets)</code>, which would allow us to expand the tree based on what we are interested in. We can even get the code that we need to focus on different aspects by hovering on the item and then clicking the icon with the green arrow (<a href="#fig-jsonfirst">Figure&nbsp;<span>7.4</span></a>).</p>
<div id="fig-jsonfirst" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/jsonlite.png" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.4: Example of hovering over a JSON element, “items”, where the icon with a green arrow can be clicked on to get the code that would focus on that element</figcaption><p></p>
</figure>
</div>
<p>This tells us how to obtain the dataset of interest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(politics_datasets[[<span class="st">"data"</span>]][[<span class="st">"items"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- ### Gathering data from Twitter -->
<!-- Twitter is a rich source of text and other data and an extraordinary amount of academic research uses it [@twitterseemsokay]. The Twitter API is the way in which Twitter asks that we gather these data. `rtweet` is built around this API and allows us to interact with it in ways that are similar to using any other R package. (Another useful R package is `academictwitteR` [@academictwitteR], which only works with the full access academic-track API, but enables full archive searches.) Initially, we can use the Twitter API with just a regular Twitter account.  -->
<!-- Begin by installing and loading `rtweet` and `tidyverse`. We then need to authorize `rtweet` and we start that process by calling any function from the package, for instance `get_favorites()` which would normally return a tibble of a user's favorites. When it is executed before authorization, this will open a browser, and we then log into a regular Twitter account (@fig-rtweetlogin). -->
<!-- ```{r} -->
<!-- #| warning: false -->
<!-- #| message: false -->
<!-- #| label: loadpackages -->
<!-- library(rtweet) -->
<!-- library(tidyverse) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- #| eval: false -->
<!-- #| label: initialise_rtweet -->
<!-- get_favorites(user = "RohanAlexander") -->
<!-- ``` -->
<!-- ![rtweet authorisation page](figures/rtweet.png){#fig-rtweetlogin width=90% fig-align="center"} -->
<!-- Once the application is authorized, we can use `get_favorites()` to actually get the favorites of a user and save them. -->
<!-- ```{r} -->
<!-- #| label: get_rohan_favs -->
<!-- #| eval: false -->
<!-- rohans_favorites <- get_favorites("RohanAlexander") -->
<!-- saveRDS(rohans_favorites, "rohans_favorites.rds") -->
<!-- ``` -->
<!-- ```{r} -->
<!-- #| label: get_rohan_favsactual -->
<!-- #| include: false -->
<!-- #| eval: false -->
<!-- # INTERNAL -->
<!-- rohans_favorites <- get_favorites("RohanAlexander") -->
<!-- saveRDS(rohans_favorites, "inputs/data/rohans_favs.rds") -->
<!-- ``` -->
<!-- ```{r} -->
<!-- #| include: false -->
<!-- rohans_favorites <- readRDS(here::here("inputs/data/rohans_favs.rds")) -->
<!-- ``` -->
<!-- We could then look at some recent favorites, keeping in mind that they may be different depending on when they are being accessed. -->
<!-- ```{r} -->
<!-- #| label: look_at_rohans_favs -->
<!-- rohans_favorites |> -->
<!--   arrange(desc(created_at)) |> -->
<!--   slice(1:10) |> -->
<!--   select(screen_name, text) -->
<!-- ``` -->
<!-- We can use `search_tweets()` to search for tweets about a particular topic. For instance, we could look at tweets using a hashtag commonly associated with R: "#rstats".  -->
<!-- ```{r} -->
<!-- #| label: get_rstats -->
<!-- #| eval: false -->
<!-- rstats_tweets <- search_tweets( -->
<!--   q = "#rstats", -->
<!--   include_rts = FALSE -->
<!-- ) -->
<!-- saveRDS(rstats_tweets, "rstats_tweets.rds") -->
<!-- ``` -->
<!-- ```{r} -->
<!-- #| label: get_rstatsactual -->
<!-- #| include: false -->
<!-- #| eval: false -->
<!-- # INTERNAL -->
<!-- rstats_tweets <- search_tweets( -->
<!--   q = "#rstats", -->
<!--   include_rts = FALSE -->
<!-- ) -->
<!-- saveRDS(rstats_tweets, "inputs/data/rstats_tweets.rds") -->
<!-- ``` -->
<!-- ```{r} -->
<!-- #| include: false -->
<!-- rstats_tweets <- readRDS(here::here("inputs/data/rstats_tweets.rds")) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- #| label: look_at_rstats -->
<!-- rstats_tweets |> -->
<!--   select(screen_name, text) |> -->
<!--   head() -->
<!-- ``` -->
<!-- Other useful functions that can be used include `get_friends()` to get all the accounts that a user follows, and `get_timelines()` to get a user's recent tweets. Registering as a developer enables access to more Twitter API functionality.  -->
<!-- When using APIs, even when they are wrapped in an R package, in this case `rtweet`, it is important to read the terms under which access is provided. The Twitter API documentation is surprisingly readable, and the [developer policy](https://developer.twitter.com/en/developer-terms/policy) is especially clear. To see how easy it is to violate the terms under which an API provider makes data available, consider that we saved the tweets that we downloaded. If we were to push these to GitHub, then it is possible that we may have accidentally stored sensitive information if there happened to be some in the tweets. Twitter is also explicit about asking those that use their API to be especially careful about sensitive information and not matching Twitter users with their off-Twitter identity. Again, the [documentation around these restricted uses](https://developer.twitter.com/en/developer-terms/more-on-restricted-use-cases) is clear and readable. -->
</section>
</section>
<section id="spotify" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="spotify"><span class="header-section-number">7.2.2</span> Spotify</h3>
<p>Sometimes there is an R package built around an API and allows us to interact with it in ways that are similar what we have seen before. For instance, <code>spotifyr</code> is a wrapper around the Spotify API. When using APIs, even when they are wrapped in an R package, in this case <code>spotifyr</code>, it is important to read the terms under which access is provided.</p>
<p>To access the Spotify API, we need a <a href="https://developer.spotify.com/dashboard/">Spotify Developer Account</a>. This is free but will require logging in with a Spotify account and then accepting the Developer Terms (<a href="#fig-spotifyaccept">Figure&nbsp;<span>7.5</span></a>).</p>
<div id="fig-spotifyaccept" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/spotify.png" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.5: Spotify Developer Account Terms agreement page</figcaption><p></p>
</figure>
</div>
<p>Continuing with the registration process, in our case, we “do not know” what we are building and so Spotify requires us to use a non-commercial agreement which is fine. To use the Spotify API we need a “Client ID” and a “Client Secret”. These are things that we want to keep to ourselves because otherwise anyone with the details could use our developer account as though they were us. One way to keep these details secret with minimum hassle is to keep them in our “System Environment”. In this way, when we push to GitHub they should not be included. To do this we will load and use <code>usethis</code> to modify our System Environment. In particular, there is a file called “.Renviron” which we will open and then add our “Client ID” and “Client Secret”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">edit_r_environ</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When we run <code>edit_r_environ()</code>, a “.Renviron” file will open and we can add our “Spotify Client ID” and “Client Secret”. Use the same names, because <code>spotifyr</code> will look in our environment for keys with those specific names. Being careful to use single quotes is important here even though we normally use double quotes in this book.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>SPOTIFY_CLIENT_ID <span class="ot">=</span> <span class="st">'PUT_YOUR_CLIENT_ID_HERE'</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>SPOTIFY_CLIENT_SECRET <span class="ot">=</span> <span class="st">'PUT_YOUR_SECRET_HERE'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Save the “.Renviron” file, and then restart R: “Session” <span class="math inline">\(\rightarrow\)</span> “Restart R”. We can now use our “Spotify Client ID” and “Client Secret” as needed. And functions that require those details as arguments will work without them being explicitly specified again.</p>
<p>To try this out we install and load <code>spotifyr</code>. We will get and save some information about Radiohead, the English rock band, using <code>get_artist_audio_features()</code>. One of the required arguments is <code>authorization</code>, but as that is set, by default, to look at the “.Renviron” file, we do not need to specify it here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>radiohead <span class="ot">&lt;-</span> <span class="fu">get_artist_audio_features</span>(<span class="st">"radiohead"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(radiohead, <span class="st">"radiohead.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>radiohead <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"radiohead.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is a variety of information available based on songs. We might be interested to see whether their songs are getting longer over time (<a href="#fig-readioovertime">Figure&nbsp;<span>7.6</span></a>). Following the guidance in <a href="05-static_communication.html"><span>Chapter&nbsp;5</span></a> this is a nice opportunity to additionally use a boxplot to communicate summary statistics by album at the same time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>radiohead <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(radiohead)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>radiohead <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">album_release_date =</span> <span class="fu">ymd</span>(album_release_date)) <span class="sc">|&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> album_release_date,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> duration_ms,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> album_release_date</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Album release date"</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Duration of song (ms)"</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-readioovertime" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-gather_files/figure-html/fig-readioovertime-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.6: Length of each Radiohead song, over time, as gathered from Spotify</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>One interesting variable provided by Spotify about each song is “valence”. The Spotify <a href="https://developer.spotify.com/documentation/web-api/reference/#/operations/get-audio-features">documentation</a> describes this as a measure between zero and one that signals “the musical positiveness” of the track with higher values being more positive. We might be interested to compare valence over time between a few artists, for instance, Radiohead, the American rock band The National, and the American singer Taylor Swift.</p>
<p>First, we need to gather the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>taylor_swift <span class="ot">&lt;-</span> <span class="fu">get_artist_audio_features</span>(<span class="st">"taylor swift"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>the_national <span class="ot">&lt;-</span> <span class="fu">get_artist_audio_features</span>(<span class="st">"the national"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(taylor_swift, <span class="st">"taylor_swift.rds"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(the_national, <span class="st">"the_national.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we can bring them together and make the graph (<a href="#fig-swiftyvsnationalvsradiohead">Figure&nbsp;<span>7.7</span></a>). This appears to show that while Taylor Swift and Radiohead have largely maintained their level of valence over time, The National has decreased theirs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(taylor_swift, the_national, radiohead) <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(artist_name, album_release_date, valence) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">album_release_date =</span> <span class="fu">ymd</span>(album_release_date)) <span class="sc">|&gt;</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>( <span class="at">x =</span> album_release_date, <span class="at">y =</span> valence, <span class="at">color =</span> artist_name)) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(artist_name), <span class="at">dir =</span> <span class="st">"v"</span>) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Album release date"</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Valence"</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Artist"</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-swiftyvsnationalvsradiohead" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-gather_files/figure-html/fig-swiftyvsnationalvsradiohead-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.7: Comparing valence, over time, for Radiohead, Taylor Swift, and The National</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>How amazing that we live in a world where all that information is available with very little effort or cost! And having gathered the data, there is a lot that could be done. For instance, <span class="citation" data-cites="kaylinpavlik">Pavlik (<a href="99-references.html#ref-kaylinpavlik" role="doc-biblioref">2019</a>)</span> uses an expanded dataset to classify musical genres and <span class="citation" data-cites="theeconomistonspotify">The Economist (<a href="99-references.html#ref-theeconomistonspotify" role="doc-biblioref">2022</a>)</span> looks at how language is associated with music streaming on Spotify. Our ability to gather such data enables us to answer questions that had to be considered experimentally in the past. For instance, <span class="citation" data-cites="salganik2006experimental">Salganik, Dodds, and Watts (<a href="99-references.html#ref-salganik2006experimental" role="doc-biblioref">2006</a>)</span> had to use experimental data to analyze the social aspect of what makes a hit song, rather than the observational data we can now access.</p>
<p>That said, it is worth thinking about what valence is purporting to measure. Little information is available in the Spotify documentation how it was created. It is doubtful that one number can completely represent how positive is a song. And what about the songs from these artists that are not on Spotify, or even publicly released? This is a nice example of how measurement and sampling pervade all aspects of telling stories with data.</p>
</section>
</section>
<section id="web-scraping" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="web-scraping"><span class="header-section-number">7.3</span> Web scraping</h2>
<section id="principles" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="principles"><span class="header-section-number">7.3.1</span> Principles</h3>
<p>Web scraping is a way to get data from websites. Rather than going to a website using a browser and then saving a copy of it, we write code that does it for us. This opens a lot of data to us, but on the other hand, it is not typically data that are being made available for these purposes. This means that it is especially important to be respectful. While generally not illegal, the specifics about the legality of web scraping depend on jurisdictions and what we are doing, and so it is also important to be mindful. Even if our use is not commercially competitive, of particular concern is the conflict between the need for our work to be reproducible with the need to respect terms of service that may disallow data republishing <span class="citation" data-cites="luscombe2021algorithmic">(<a href="99-references.html#ref-luscombe2021algorithmic" role="doc-biblioref">Luscombe, Dick, and Walby 2021</a>)</span>.</p>
<p>Privacy often trumps reproducibility. There is also a considerable difference between data being publicly available on a website and being scraped, cleaned, and prepared into a dataset which is then publicly released. For instance, <span class="citation" data-cites="kirkegaard2016okcupid">Kirkegaard and Bjerrekær (<a href="99-references.html#ref-kirkegaard2016okcupid" role="doc-biblioref">2016</a>)</span> scraped publicly available OKCupid profiles and then made the resulting dataset easily available <span class="citation" data-cites="hackett2016researchers">(<a href="99-references.html#ref-hackett2016researchers" role="doc-biblioref">Hackett 2016</a>)</span>. <span class="citation" data-cites="zimmer2018addressing">Zimmer (<a href="99-references.html#ref-zimmer2018addressing" role="doc-biblioref">2018</a>)</span> details some of the important considerations that were overlooked including “minimizing harm”, “informed consent”, and ensuring those in the dataset maintain “privacy and confidentiality”. While it is correct to say that OKCupid made data public, they did so in a certain context, and when their data was scraped that context was changed.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Oh, you think we have good data on that!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Police violence is particularly concerning because of the need for trust between the police and society. Without good data it is difficult to hold police departments accountable, or know whether there is an issue, but getting data is difficult <span class="citation" data-cites="bronnerpolicenordata">(<a href="99-references.html#ref-bronnerpolicenordata" role="doc-biblioref">Thomson-DeVeaux, Bronner, and Sharma 2021</a>)</span>. The fundamental problem is that there is no way to easily simplify an encounter that results in violence into a dataset. Two popular datasets draw on web scraping:</p>
<ol type="1">
<li>“Mapping Police Violence”; and</li>
<li>“Fatal Force Database”.</li>
</ol>
<p><span class="citation" data-cites="Bor2018">Bor et al. (<a href="99-references.html#ref-Bor2018" role="doc-biblioref">2018</a>)</span> use “Mapping Police Violence” to examine police killings of Black Americans, especially when unarmed, and find a substantial effect on the mental health of Black Americans. Responses to the paper, such as <span class="citation" data-cites="Nix2020">Nix and Lozada (<a href="99-references.html#ref-Nix2020" role="doc-biblioref">2020</a>)</span>, have special concern with the coding of the dataset, and after re-coding draw different conclusions. An example of a coding difference is the unanswerable question, because it depends on context and usage, of whether to code an individual who was killed with a toy firearm as “armed” or “unarmed”. We may want a separate category, but some simplification is necessary for the construction of a quantitative dataset. <em>The Washington Post</em> writes many articles using the “Fatal Force Database” <span class="citation" data-cites="washpostfatalforce">(<a href="99-references.html#ref-washpostfatalforce" role="doc-biblioref">The Washington Post 2023</a>)</span>. <span class="citation" data-cites="washpostfatalforcemethods">Jenkins et al. (<a href="99-references.html#ref-washpostfatalforcemethods" role="doc-biblioref">2022</a>)</span> describes their methodology and the challenges of standardization. <span class="citation" data-cites="Comer2022">Comer and Ingram (<a href="99-references.html#ref-Comer2022" role="doc-biblioref">2022</a>)</span> compare the datasets and find similarities, but document ways in which the datasets are different.</p>
</div>
</div>
<p>Web scraping is an invaluable source of data. But they are typically datasets that can be created as a by-product of someone trying to achieve another aim. And web scraping imposes a cost on the website host, and so we should reduce this to the extent possible. For instance, a retailer may have a website with their products and their prices. That has not been created deliberately as a source of data, but we can scrape it to create a dataset. The following principles may be useful to guide web scraping.</p>
<ol type="1">
<li>Avoid it. Try to use an API wherever possible.</li>
<li>Abide by their desires. Some websites have a “robots.txt” file that contains information about what they are comfortable with scrapers doing. In general, if it exists, a “robots.txt” file can be accessed by appending “robots.txt” to the base URL. For instance, the “robots.txt” file for https://www.google.com, can be accessed at https://www.google.com/robots.txt. Note if there are folders listed against “Disallow:”. These are the folders that the website would not like to be scraped. And also note any instances of “Crawl-delay:”. This is the number of seconds the website would like you to wait between visits.</li>
<li>Reduce the impact.
<ol type="1">
<li>Slow down the scraper, for instance, rather than having it visit the website every second, slow it down using <code>sys.sleep()</code>. If you only need a few hundred files, then why not just have it visit the website a few times a minute, running in the background overnight?</li>
<li>Consider the timing of when you run the scraper. For instance, if you are scraping a retailer then maybe set the script to run from 10pm through to the morning, when fewer customers are likely using the site. Similarly, if it is a government website and they have a regular monthly release, then it might be polite to avoid that day.</li>
</ol></li>
<li>Take only what is needed. For instance, you do not need to scrape the entirety of Wikipedia if all you need is the names of the ten largest cities in Croatia. This reduces the impact on the website, and allows us to more easily justify our actions.</li>
<li>Only scrape once. This means you should save everything as you go so that you do not have to re-collect data when the scraper inevitably fails at some point. For instance, you will typically spend a lot of time getting a scraper working on one page, but typically the page structure will change at some point and the scraper will need to be updated. Once you have the data, you should save that original, unedited data separately to the modified data. If you need data over time then you will need to go back, but this is different than needlessly re-scraping a page.</li>
<li>Do not republish the pages that were scraped (this contrasts with datasets that you create from it).</li>
<li>Take ownership and ask permission if possible. At a minimum all scripts should have contact details in them. Depending on the circumstances, it may be worthwhile asking for permission before you scrape.</li>
</ol>
</section>
<section id="htmlcss-essentials" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="htmlcss-essentials"><span class="header-section-number">7.3.2</span> HTML/CSS essentials</h3>
<p>Web scraping is possible by taking advantage of the underlying structure of a webpage. We use patterns in the HTML/CSS to get the data that we want. To look at the underlying HTML/CSS we can either:</p>
<ol type="1">
<li>open a browser, right-click, and choose something like “Inspect”; or</li>
<li>save the website and then open it with a text editor rather than a browser.</li>
</ol>
<p>HTML/CSS is a markup language based on matching tags. If we want text to be bold, then we would use something like:</p>
<pre class="text"><code>&lt;b&gt;My bold text&lt;/b&gt;</code></pre>
<p>Similarly, if we want a list, then we start and end the list as well as indicating each item.</p>
<pre class="text"><code>&lt;ul&gt;
  &lt;li&gt;Learn webscraping&lt;/li&gt;
  &lt;li&gt;Do data science&lt;/li&gt;
  &lt;li&gt;Profit&lt;/li&gt;
&lt;/ul&gt;</code></pre>
<p>When scraping we will search for these tags.</p>
<p>To get started, we can pretend that we obtained some HTML from a website, and that we want to get the name from it. We can see that the name is in bold, so we want to focus on that feature and extract it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>website_extract <span class="ot">&lt;-</span> <span class="st">"&lt;p&gt;Hi, I’m &lt;b&gt;Rohan&lt;/b&gt; Alexander.&lt;/p&gt;"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>rvest</code> is part of the <code>tidyverse</code> so it does not have to be installed, but it is not part of the core, so it does need to be loaded. After that, use <code>read_html()</code> to read in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>rohans_data <span class="ot">&lt;-</span> <span class="fu">read_html</span>(website_extract)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>rohans_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{html_document}
&lt;html&gt;
[1] &lt;body&gt;&lt;p&gt;Hi, I’m &lt;b&gt;Rohan&lt;/b&gt; Alexander.&lt;/p&gt;&lt;/body&gt;</code></pre>
</div>
</div>
<p>The language used by <code>rvest</code> to look for tags is “node”, so we focus on bold nodes. By default <code>html_elements()</code> returns the tags as well. We extract the text with <code>html_text()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>rohans_data <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (1)}
[1] &lt;b&gt;Rohan&lt;/b&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>rohans_data <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"b"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Rohan"</code></pre>
</div>
</div>
<p>Web scraping is an exciting source of data, and we will now go through some examples. But in contrast to these examples, information is not usually all on one page. Web scraping quickly becomes a difficult art form that requires a lot of practice. For instance, we distinguish between an index scrape and a contents scrape. The former is scraping to build the list of URLs that have the content you want, while the latter is to get the content from those URLs. An example is provided by <span class="citation" data-cites="luscombe2022jumpstarting">Luscombe, Duncan, and Walby (<a href="99-references.html#ref-luscombe2022jumpstarting" role="doc-biblioref">2022</a>)</span>. If you end up doing a lot of web scraping, then <code>polite</code> <span class="citation" data-cites="polite">(<a href="99-references.html#ref-polite" role="doc-biblioref">Perepolkin 2022</a>)</span> may be helpful to better optimize your workflow. And using GitHub Actions to allow for larger and slower scrapes over time.</p>
</section>
<section id="book-information" class="level3" data-number="7.3.3">
<h3 data-number="7.3.3" class="anchored" data-anchor-id="book-information"><span class="header-section-number">7.3.3</span> Book information</h3>
<p>In this case study we will scrape a list of books available <a href="https://rohansbooks.com">here</a>. We will then clean the data and look at the distribution of the first letters of author surnames. It is slightly more complicated than the example above, but the underlying workflow is the same: download the website, look for the nodes of interest, extract the information, and clean it.</p>
<p>We use <code>rvest</code> to download a website, and to then navigate the HTML to find the aspects that we are interested in. And we use the <code>tidyverse</code> to clean the dataset. We first need to go to the website and then save a local copy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>books_data <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://rohansbooks.com"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_html</span>(books_data, <span class="st">"raw_data.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We need to navigate the HTML to get the aspects that we want. And then try to get the data into a tibble as quickly as possible because this will allow us to more easily use <code>dplyr</code> verbs and other functions from the <code>tidyverse</code>.</p>
<p>See <a href="20-r_essentials.html">Online Appendix&nbsp;<span>A</span></a> if this is unfamiliar to you.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>books_data <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"raw_data.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>books_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{html_document}
&lt;html&gt;
[1] &lt;head&gt;\n&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8 ...
[2] &lt;body&gt;\n    &lt;h1&gt;Books&lt;/h1&gt;\n\n    &lt;p&gt;\n      This is a list of books that ...</code></pre>
</div>
</div>
<p>To get the data into a tibble we first need to use HTML tags to identify the data that we are interested in. If we look at the website then we know we need to focus on list items (<a href="#fig-rohansbooks-display">Figure&nbsp;<span>7.8 (a)</span></a>). And we can look at the source, focusing particularly on looking for a list (<a href="#fig-rohansbooks-html">Figure&nbsp;<span>7.8 (b)</span></a>).</p>
<div id="fig-rohansbooks" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-rohansbooks-display" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/books_display.png" class="img-fluid figure-img" data-ref-parent="fig-rohansbooks"></p>
<p></p><figcaption class="figure-caption">(a) Books website as displayed</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-rohansbooks-html" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/books_source.png" class="img-fluid figure-img" data-ref-parent="fig-rohansbooks"></p>
<p></p><figcaption class="figure-caption">(b) HTML for the top of the books website and the list of books</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.8: Screen captures from the books website as at 16 June 2022</figcaption><p></p>
</figure>
</div>
<p>The tag for a list item is “li”, so we can use that to focus on the list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>text_data <span class="ot">&lt;-</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  books_data <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"li"</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>all_books <span class="ot">&lt;-</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">books =</span> text_data)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_books)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  books                                                                         
  &lt;chr&gt;                                                                         
1 "\n        Agassi, Andre, 2009, Open\n      "                                 
2 "\n        Cramer, Richard Ben, 1992, What It Takes: The Way to the White Hou…
3 "\n        DeWitt, Helen, 2000, The Last Samurai\n      "                     
4 "\n        Gelman, Andrew and Jennifer Hill, 2007, Data Analysis Using Regres…
5 "\n        Halberstam, David, 1972, The Best and the Brightest\n      "       
6 "\n        Ignatieff, Michael, 2013, Fire and Ashes: Success and Failure in P…</code></pre>
</div>
</div>
<p>We now need to clean the data. First we want to separate the title and the author using <code>separate()</code> and then clean up the author and title columns. We can take advantage of the fact that the year is present and separate based on that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>all_books <span class="ot">&lt;-</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  all_books <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">books =</span> <span class="fu">str_squish</span>(books)) <span class="sc">|&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(books, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"author"</span>, <span class="st">"title"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">, [[:digit:]]{4}</span><span class="sc">\\</span><span class="st">, "</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_books)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  author                           title                                        
  &lt;chr&gt;                            &lt;chr&gt;                                        
1 Agassi, Andre                    Open                                         
2 Cramer, Richard Ben              What It Takes: The Way to the White House    
3 DeWitt, Helen                    The Last Samurai                             
4 Gelman, Andrew and Jennifer Hill Data Analysis Using Regression and Multileve…
5 Halberstam, David                The Best and the Brightest                   
6 Ignatieff, Michael               Fire and Ashes: Success and Failure in Polit…</code></pre>
</div>
</div>
<p>Finally, we could make, say, a table of the distribution of the first letter of the names (<a href="#tbl-lettersofbooks">Table&nbsp;<span>7.1</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>all_books <span class="sc">|&gt;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">first_letter =</span> <span class="fu">str_sub</span>(author, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">.by =</span> first_letter) <span class="sc">|&gt;</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"First letter"</span>, <span class="st">"Number of times"</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-lettersofbooks" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;7.1: Distribution of first letter of author names in a collection of books</caption>
<thead>
<tr class="header">
<th style="text-align: left;">First letter</th>
<th style="text-align: right;">Number of times</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">G</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">I</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">L</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">M</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">P</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">R</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">V</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">W</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Y</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="prime-ministers-of-the-united-kingdom" class="level3" data-number="7.3.4">
<h3 data-number="7.3.4" class="anchored" data-anchor-id="prime-ministers-of-the-united-kingdom"><span class="header-section-number">7.3.4</span> Prime Ministers of the United Kingdom</h3>
<p>In this case study we are interested in how long prime ministers of the United Kingdom lived, based on the year they were born. We will scrape data from Wikipedia using <code>rvest</code>, clean it, and then make a graph. From time to time a website will change. This makes many scrapes largely bespoke, even if we can borrow some code from earlier projects. It is normal to feel frustrated at times. It helps to begin with an end in mind.</p>
<p>To that end, we can start by generating some simulated data. Ideally, we want a table that has a row for each prime minister, a column for their name, and a column each for the birth and death years. If they are still alive, then that death year can be empty. We know that birth and death years should be somewhere between 1700 and 1990, and that death year should be larger than birth year. Finally, we also know that the years should be integers, and the names should be characters. We want something that looks roughly like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>simulated_dataset <span class="ot">&lt;-</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">prime_minister =</span> babynames <span class="sc">|&gt;</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(prop <span class="sc">&gt;</span> <span class="fl">0.01</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>(name) <span class="sc">|&gt;</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlist</span>() <span class="sc">|&gt;</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sample</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>),</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">birth_year =</span> <span class="fu">sample</span>(<span class="dv">1700</span><span class="sc">:</span><span class="dv">1990</span>, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">years_lived =</span> <span class="fu">sample</span>(<span class="dv">50</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">death_year =</span> birth_year <span class="sc">+</span> years_lived</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(prime_minister, birth_year, death_year, years_lived) <span class="sc">|&gt;</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(birth_year)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>simulated_dataset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   prime_minister birth_year death_year years_lived
   &lt;chr&gt;               &lt;int&gt;      &lt;int&gt;       &lt;int&gt;
 1 Kevin                1813       1908          95
 2 Karen                1832       1896          64
 3 Robert               1839       1899          60
 4 Bertha               1846       1915          69
 5 Jennifer             1867       1943          76
 6 Arthur               1892       1984          92
 7 Donna                1907       2006          99
 8 Emma                 1957       2031          74
 9 Ryan                 1959       2053          94
10 Tyler                1990       2062          72</code></pre>
</div>
</div>
<p>One of the advantages of generating a simulated dataset is that if we are working in groups then one person can start making the graph, using the simulated dataset, while the other person gathers the data. In terms of a graph, we are aiming for something like <a href="#fig-pmsgraphexample">Figure&nbsp;<span>7.9</span></a>.</p>
<div id="fig-pmsgraphexample" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/pms_graph_plan.png" class="img-fluid figure-img" style="width:75.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.9: Sketch of planned graph showing how long United Kingdom prime ministers lived</figcaption><p></p>
</figure>
</div>
<p>We are starting with a question that is of interest, which is how long each prime minister of the United Kingdom lived. As such, we need to identify a source of data. While there are plenty of data sources that have the births and deaths of each prime minister, we want one that we can trust, and as we are going to be scraping, we want one that has some structure to it. The <a href="https://en.wikipedia.org/wiki/List_of_prime_ministers_of_the_United_Kingdom">Wikipedia page about prime ministers of the United Kingdom</a> fits both these criteria. As it is a popular page the information is likely to be correct, and the data are available in a table.</p>
<p>We load <code>rvest</code> and then download the page using <code>read_html()</code>. Saving it locally provides us with a copy that we need for reproducibility in case the website changes, and means that we do not have to keep visiting the website. But it is not ours, and so this is typically not something that should be publicly redistributed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://en.wikipedia.org/wiki/List_of_prime_ministers_of_the_United_Kingdom"</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_html</span>(raw_data, <span class="st">"pms.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As with the earlier case study, we are looking for patterns in the HTML that we can use to help us get closer to the data that we want. This is an iterative process and requires a lot of trial and error. Even simple examples will take time.</p>
<p>One tool that may help is the <a href="https://rvest.tidyverse.org/articles/articles/selectorgadget.html">SelectorGadget</a>. This allows us to pick and choose the elements that we want, and then gives us the input for <code>html_element()</code> (<a href="#fig-selectorgadget">Figure&nbsp;<span>7.10</span></a>). By default, SelectorGadget uses CSS selectors. These are not the only way to specify the location of the information you want, and using an alternative, such as XPath, can be a useful option to consider.</p>
<div id="fig-selectorgadget" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/07-wikipedia_selectorgadget_screenshot.png" class="img-fluid figure-img" style="width:75.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.10: Using the Selector Gadget to identify the tag, as at 12 February 2023</figcaption><p></p>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"pms.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>parse_data_selector_gadget <span class="ot">&lt;-</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  raw_data <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">".wikitable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>()</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(parse_data_selector_gadget)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  Portrait Portrait   Prime ministerOffice(L…¹ `Term of office` `Term of office`
  &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;                    &lt;chr&gt;            &lt;chr&gt;           
1 Portrait "Portrait" Prime ministerOffice(Li… start            end             
2 ​         ""         Robert Walpole[27]MP fo… 3 April1721      11 February1742 
3 ​         ""         Robert Walpole[27]MP fo… 3 April1721      11 February1742 
4 ​         ""         Robert Walpole[27]MP fo… 3 April1721      11 February1742 
5 ​         ""         Robert Walpole[27]MP fo… 3 April1721      11 February1742 
6 ​         ""         Spencer Compton[28]1st … 16 February1742  2 July1743      
# ℹ abbreviated name: ¹​`Prime ministerOffice(Lifespan)`
# ℹ 6 more variables: `Term of office` &lt;chr&gt;, `Mandate[a]` &lt;chr&gt;,
#   `Ministerial offices held as prime minister` &lt;chr&gt;, Party &lt;chr&gt;,
#   Government &lt;chr&gt;, MonarchReign &lt;chr&gt;</code></pre>
</div>
</div>
<p>In this case there are many columns that we do not need, and some duplicated rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>parsed_data <span class="ot">&lt;-</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  parse_data_selector_gadget <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">raw_text =</span> prime_minister_office_lifespan) <span class="sc">|&gt;</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(raw_text) <span class="sc">|&gt;</span> </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(raw_text <span class="sc">!=</span> <span class="st">"Prime ministerOffice(Lifespan)"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(parsed_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  raw_text                                                
  &lt;chr&gt;                                                   
1 Robert Walpole[27]MP for King's Lynn(1676–1745)         
2 Spencer Compton[28]1st Earl of Wilmington(1673–1743)    
3 Henry Pelham[29]MP for Sussex(1694–1754)                
4 Thomas Pelham-Holles[30]1st Duke of Newcastle(1693–1768)
5 William Cavendish[31]4th Duke of Devonshire(1720–1764)  
6 Thomas Pelham-Holles[32]1st Duke of Newcastle(1693–1768)</code></pre>
</div>
</div>
<p>Now that we have the parsed data, we need to clean it to match what we wanted. We want a names column, as well as columns for birth year and death year. We use <code>separate()</code> to take advantage of the fact that it looks like the names and dates are distinguished by brackets. The argument in <code>str_extract()</code> is a regular expression. It looks for four digits in a row, followed by a dash, followed by four more digits in a row. We use a slightly different regular expression for those prime ministers who are still alive.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>initial_clean <span class="ot">&lt;-</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  parsed_data <span class="sc">|&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    raw_text, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"name"</span>, <span class="st">"not_name"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">["</span>, <span class="at">extra =</span> <span class="st">"merge"</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">str_extract</span>(not_name, <span class="st">"[[:digit:]]{4}–[[:digit:]]{4}"</span>),</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">born =</span> <span class="fu">str_extract</span>(not_name, <span class="st">"born[[:space:]][[:digit:]]{4}"</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, date, born)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(initial_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  name                 date      born 
  &lt;chr&gt;                &lt;chr&gt;     &lt;chr&gt;
1 Robert Walpole       1676–1745 &lt;NA&gt; 
2 Spencer Compton      1673–1743 &lt;NA&gt; 
3 Henry Pelham         1694–1754 &lt;NA&gt; 
4 Thomas Pelham-Holles 1693–1768 &lt;NA&gt; 
5 William Cavendish    1720–1764 &lt;NA&gt; 
6 Thomas Pelham-Holles 1693–1768 &lt;NA&gt; </code></pre>
</div>
</div>
<p>Finally, we need to clean up the columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="ot">&lt;-</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  initial_clean <span class="sc">|&gt;</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(date, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"birth"</span>, <span class="st">"died"</span>), </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">"–"</span>) <span class="sc">|&gt;</span>   <span class="co"># PMs who have died have their birth and death years </span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># separated by a hyphen, but we need to be careful with the hyphen as it seems </span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># to be a slightly odd type of hyphen and we need to copy/paste it.</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">born =</span> <span class="fu">str_remove_all</span>(born, <span class="st">"born[[:space:]]"</span>),</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">birth =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(born), born, birth)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="co"># Alive PMs have slightly different format</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>born) <span class="sc">|&gt;</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">born =</span> birth) <span class="sc">|&gt;</span> </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(born, died), as.integer)) <span class="sc">|&gt;</span> </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age_at_Death =</span> died <span class="sc">-</span> born) <span class="sc">|&gt;</span> </span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="co"># Some of the PMs had two goes at it.</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cleaned_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  name                  born  died Age_at_Death
  &lt;chr&gt;                &lt;int&gt; &lt;int&gt;        &lt;int&gt;
1 Robert Walpole        1676  1745           69
2 Spencer Compton       1673  1743           70
3 Henry Pelham          1694  1754           60
4 Thomas Pelham-Holles  1693  1768           75
5 William Cavendish     1720  1764           44
6 John Stuart           1713  1792           79</code></pre>
</div>
</div>
<p>Our dataset looks similar to the one that we said we wanted at the start (<a href="#tbl-canadianpmscleanddata">Table&nbsp;<span>7.2</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="sc">|&gt;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Prime Minister"</span>, <span class="st">"Birth year"</span>, <span class="st">"Death year"</span>, <span class="st">"Age at death"</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-canadianpmscleanddata" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;7.2: UK Prime Ministers, by how old they were when they died</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Prime Minister</th>
<th style="text-align: right;">Birth year</th>
<th style="text-align: right;">Death year</th>
<th style="text-align: right;">Age at death</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Robert Walpole</td>
<td style="text-align: right;">1676</td>
<td style="text-align: right;">1745</td>
<td style="text-align: right;">69</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spencer Compton</td>
<td style="text-align: right;">1673</td>
<td style="text-align: right;">1743</td>
<td style="text-align: right;">70</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Henry Pelham</td>
<td style="text-align: right;">1694</td>
<td style="text-align: right;">1754</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="even">
<td style="text-align: left;">Thomas Pelham-Holles</td>
<td style="text-align: right;">1693</td>
<td style="text-align: right;">1768</td>
<td style="text-align: right;">75</td>
</tr>
<tr class="odd">
<td style="text-align: left;">William Cavendish</td>
<td style="text-align: right;">1720</td>
<td style="text-align: right;">1764</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">John Stuart</td>
<td style="text-align: right;">1713</td>
<td style="text-align: right;">1792</td>
<td style="text-align: right;">79</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>At this point we would like to make a graph that illustrates how long each prime minister lived (<a href="#fig-pmslives">Figure&nbsp;<span>7.11</span></a>). If they are still alive then we would like them to run to the end, but we would like to color them differently.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="sc">|&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">still_alive =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(died), <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">died =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(died), <span class="fu">as.integer</span>(<span class="dv">2023</span>), died)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as_factor</span>(name)) <span class="sc">|&gt;</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> born, <span class="at">xend =</span> died, <span class="at">y =</span> name, <span class="at">yend =</span> name, <span class="at">color =</span> still_alive)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>() <span class="sc">+</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year of birth"</span>, <span class="at">y =</span> <span class="st">"Prime minister"</span>, <span class="at">color =</span> <span class="st">"PM is currently alive"</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-pmslives" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-gather_files/figure-html/fig-pmslives-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.11: How long each prime minister of the United Kingdom lived</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="iteration" class="level3" data-number="7.3.5">
<h3 data-number="7.3.5" class="anchored" data-anchor-id="iteration"><span class="header-section-number">7.3.5</span> Iteration</h3>
<p>Considering text as data is exciting and opens a lot of different research questions. We will draw on it in <a href="16-text.html"><span>Chapter&nbsp;16</span></a>. Many guides assume that we already have a nicely formatted text dataset, but that is rarely actually the case. In this case study we will download files from a few different pages. While we have already seen two examples of web scraping, those were focused on just one page, whereas we often need many. Here we will focus on this iteration. We will use <code>download.file()</code> to do the download, and use <code>purrr</code> to apply this function across multiple sites. You do not need to install or load that package because it is part of the core <code>tidyverse</code> so it is loaded when you load the <code>tidyverse</code>.</p>
<p>The Reserve Bank of Australia (RBA) is Australia’s central bank. It has responsibility for setting the cash rate, which is the interest rate used for loans between banks. This interest rate is an especially important one and has a large impact on the other interest rates in the economy. Four times a year—February, May, August, and November—the RBA publishes a statement on monetary policy, and these are available as PDFs. In this example we will download two statements published in 2023.</p>
<p>First we set up a tibble that has the information that we need. We will take advantage of commonalities in the structure of the URLs. We need to specify both a URL and a local file name for each state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>first_bit <span class="ot">&lt;-</span> <span class="st">"https://www.rba.gov.au/publications/smp/2023/"</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>last_bit <span class="ot">&lt;-</span> <span class="st">"/pdf/overview.pdf"</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>statements_of_interest <span class="ot">&lt;-</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">address =</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste0</span>(first_bit, <span class="st">"feb"</span>, last_bit),</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste0</span>(first_bit, <span class="st">"may"</span>, last_bit)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_save_name =</span> <span class="fu">c</span>(<span class="st">"2023-02.pdf"</span>, <span class="st">"2023-05.pdf"</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>statements_of_interest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  address                                                        local_save_name
  &lt;chr&gt;                                                          &lt;chr&gt;          
1 https://www.rba.gov.au/publications/smp/2023/feb/pdf/overview… 2023-02.pdf    
2 https://www.rba.gov.au/publications/smp/2023/may/pdf/overview… 2023-05.pdf    </code></pre>
</div>
</div>
<p>We want to apply the function <code>download.files()</code> to these two statements. To do this we write a function that will download the file, let us know that it was downloaded, wait a polite amount of time, and then go get the next file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>visit_download_and_wait <span class="ot">&lt;-</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(address_to_visit,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>           where_to_save_it_locally) {</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(<span class="at">url =</span> address_to_visit,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">destfile =</span> where_to_save_it_locally)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Done with"</span>, address_to_visit, <span class="st">"at"</span>, <span class="fu">Sys.time</span>()))</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="fu">sample</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span>))</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now apply that function to our tibble of URLs and save names using the function <code>walk2()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  statements_of_interest<span class="sc">$</span>address,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  statements_of_interest<span class="sc">$</span>local_save_name,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">visit_download_and_wait</span>(.x, .y)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The result is that we have downloaded these PDFs and saved them to our computer. An alternative to writing these functions ourselves would be to use <code>heapsofpapers</code> <span class="citation" data-cites="heapsofpapers">(<a href="99-references.html#ref-heapsofpapers" role="doc-biblioref">Alexander and Mahfouz 2021</a>)</span>. This includes various helpful options for downloading lists of files, especially PDF, CSV, and txt files. For instance, <span class="citation" data-cites="collinsalexander">Collins and Alexander (<a href="99-references.html#ref-collinsalexander" role="doc-biblioref">2022</a>)</span> use this to obtain thousands of PDFs and estimate the extent to which COVID-19 research was reproducible. In the next section we will build on this to discuss getting information from PDFs.</p>
</section>
</section>
<section id="pdfs" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="pdfs"><span class="header-section-number">7.4</span> PDFs</h2>
<p>PDF files were developed in the 1990s by the technology company Adobe. They are useful for documents because they are meant to display in a consistent way independent of the environment that created them or the environment in which they are being viewed. A PDF viewed on an iPhone should look the same as on an Android phone, as on a Linux desktop. One feature of PDFs is that they can include a variety of objects, for instance, text, photos, figures, etc. However, this variety can limit the capacity of PDFs to be used directly as data. The data first needs to be extracted from the PDF.</p>
<p>It is often possible to copy and paste the data from the PDF. This is more likely when the PDF only contains text or regular tables. In particular, if the PDF has been created by an application such as Microsoft Word, or another document- or form-creation system, then often the text data can be extracted in this way because they are actually stored as text within the PDF. We begin with that case. But it is not as easy if the text has been stored as an image which is then part of the PDF. This may be the case for PDFs produced through scans or photos of physical documents, and some older document preparation software. We go through that case later.</p>
<p>In contrast to an API, a PDF is usually produced for human rather than computer consumption. The nice thing about PDFs is that they are static and constant. And it is great that data are available. But the trade-off is that:</p>
<ul>
<li>It is not overly useful to do larger-scale data.</li>
<li>We do not know how the PDF was put together so we do not know whether we can trust it.</li>
<li>We cannot manipulate the data to get results that we are interested in.</li>
</ul>
<p>There are two important aspects to keep in mind when extracting data from a PDF:</p>
<ol type="1">
<li>Begin with an end in mind. Plan and sketch what we want from a final dataset/graph/paper to limit time wastage.</li>
<li>Start simple, then iterate. The quickest way to make something that needs to be complicated is often to first build a simple version and then add to it. Start with just trying to get one page of the PDF working or even just one line. Then iterate from there.</li>
</ol>
<p>We will go through several examples and then go through a case study where we will gather data on United States Total Fertility Rate, by state.</p>
<section id="jane-eyre" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="jane-eyre"><span class="header-section-number">7.4.1</span> <em>Jane Eyre</em></h3>
<p><a href="#fig-firstpdfexample">Figure&nbsp;<span>7.12</span></a> is a PDF that consists of just the first sentence from Charlotte Brontë’s novel <em>Jane Eyre</em> taken from Project Gutenberg <span class="citation" data-cites="janeeyre">(<a href="99-references.html#ref-janeeyre" role="doc-biblioref">Brontë 1847</a>)</span>. You can get it <a href="https://github.com/RohanAlexander/telling_stories/blob/aa6e2d76c80eba7bd31ca68161f0065344449ed8/inputs/pdfs/first_example.pdf">here</a>. If we assume that it was saved as “first_example.pdf”, then after installing and loading <code>pdftools</code> to get the text from this one-page PDF into R.</p>
<div id="fig-firstpdfexample" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="inputs/pdfs/first_example.png" class="img-fluid figure-img" style="width:75.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.12: First sentence of Jane Eyre</figcaption><p></p>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>first_example <span class="ot">&lt;-</span> <span class="fu">pdf_text</span>(<span class="st">"first_example.pdf"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>first_example</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(first_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There was no possibility of taking a walk that day.\n"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>We can see that the PDF has been correctly read in, as a character vector.</p>
<p>We will now try a slightly more complicated example that consists of the first few paragraphs of <em>Jane Eyre</em> (<a href="#fig-secondpdfexample">Figure&nbsp;<span>7.13</span></a>). Now we have the chapter heading as well.</p>
<div id="fig-secondpdfexample" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="inputs/pdfs/second_example.png" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.13: First few paragraphs of Jane Eyre</figcaption><p></p>
</figure>
</div>
<p>We use the same function as before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>second_example <span class="ot">&lt;-</span> <span class="fu">pdf_text</span>(<span class="st">"second_example.pdf"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(second_example)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>second_example</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "CHAPTER I\nThere was no possibility of taking a walk that day. We had been wandering, indeed, in the\nleafless shrubbery an hour in the morning; but since dinner (Mrs. Reed, when there was no\ncompany, dined early) the cold winter wind had brought with it clouds so sombre, and a rain so\npenetrating, that further out-door exercise was now out of the question.\n\nI was glad of it: I never liked long walks, especially on chilly afternoons: dreadful to me was the\ncoming home in the raw twilight, with nipped fingers and toes, and a heart saddened by the\nchidings of Bessie, the nurse, and humbled by the consciousness of my physical inferiority to\nEliza, John, and Georgiana Reed.\n\nThe said Eliza, John, and Georgiana were now clustered round their mama in the drawing-room:\nshe lay reclined on a sofa by the fireside, and with her darlings about her (for the time neither\nquarrelling nor crying) looked perfectly happy. Me, she had dispensed from joining the group;\nsaying, “She regretted to be under the necessity of keeping me at a distance; but that until she\nheard from Bessie, and could discover by her own observation, that I was endeavouring in good\nearnest to acquire a more sociable and childlike disposition, a more attractive and sprightly\nmanner—something lighter, franker, more natural, as it were—she really must exclude me from\nprivileges intended only for contented, happy, little children.”\n\n“What does Bessie say I have done?” I asked.\n\n“Jane, I don’t like cavillers or questioners; besides, there is something truly forbidding in a child\ntaking up her elders in that manner. Be seated somewhere; and until you can speak pleasantly,\nremain silent.”\n\nA breakfast-room adjoined the drawing-room, I slipped in there. It contained a bookcase: I soon\npossessed myself of a volume, taking care that it should be one stored with pictures. I mounted\ninto the window-seat: gathering up my feet, I sat cross-legged, like a Turk; and, having drawn the\nred moreen curtain nearly close, I was shrined in double retirement.\n\nFolds of scarlet drapery shut in my view to the right hand; to the left were the clear panes of\nglass, protecting, but not separating me from the drear November day. At intervals, while\nturning over the leaves of my book, I studied the aspect of that winter afternoon. Afar, it offered\na pale blank of mist and cloud; near a scene of wet lawn and storm-beat shrub, with ceaseless\nrain sweeping away wildly before a long and lamentable blast.\n"</code></pre>
</div>
</div>
<p>Again, we have a character vector. The end of each line is signaled by “\n”, but other than that it looks pretty good. Finally, we consider the first two pages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>third_example <span class="ot">&lt;-</span> <span class="fu">pdf_text</span>(<span class="st">"third_example.pdf"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(third_example)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>third_example</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "CHAPTER I\nThere was no possibility of taking a walk that day. We had been wandering, indeed, in the\nleafless shrubbery an hour in the morning; but since dinner (Mrs. Reed, when there was no\ncompany, dined early) the cold winter wind had brought with it clouds so sombre, and a rain so\npenetrating, that further out-door exercise was now out of the question.\n\nI was glad of it: I never liked long walks, especially on chilly afternoons: dreadful to me was the\ncoming home in the raw twilight, with nipped fingers and toes, and a heart saddened by the\nchidings of Bessie, the nurse, and humbled by the consciousness of my physical inferiority to\nEliza, John, and Georgiana Reed.\n\nThe said Eliza, John, and Georgiana were now clustered round their mama in the drawing-room:\nshe lay reclined on a sofa by the fireside, and with her darlings about her (for the time neither\nquarrelling nor crying) looked perfectly happy. Me, she had dispensed from joining the group;\nsaying, “She regretted to be under the necessity of keeping me at a distance; but that until she\nheard from Bessie, and could discover by her own observation, that I was endeavouring in good\nearnest to acquire a more sociable and childlike disposition, a more attractive and sprightly\nmanner—something lighter, franker, more natural, as it were—she really must exclude me from\nprivileges intended only for contented, happy, little children.”\n\n“What does Bessie say I have done?” I asked.\n\n“Jane, I don’t like cavillers or questioners; besides, there is something truly forbidding in a child\ntaking up her elders in that manner. Be seated somewhere; and until you can speak pleasantly,\nremain silent.”\n\nA breakfast-room adjoined the drawing-room, I slipped in there. It contained a bookcase: I soon\npossessed myself of a volume, taking care that it should be one stored with pictures. I mounted\ninto the window-seat: gathering up my feet, I sat cross-legged, like a Turk; and, having drawn the\nred moreen curtain nearly close, I was shrined in double retirement.\n\nFolds of scarlet drapery shut in my view to the right hand; to the left were the clear panes of\nglass, protecting, but not separating me from the drear November day. At intervals, while\nturning over the leaves of my book, I studied the aspect of that winter afternoon. Afar, it offered\na pale blank of mist and cloud; near a scene of wet lawn and storm-beat shrub, with ceaseless\nrain sweeping away wildly before a long and lamentable blast.\n\nI returned to my book—Bewick’s History of British Birds: the letterpress thereof I cared little\nfor, generally speaking; and yet there were certain introductory pages that, child as I was, I could\nnot pass quite as a blank. They were those which treat of the haunts of sea-fowl; of “the solitary\nrocks and promontories” by them only inhabited; of the coast of Norway, studded with isles from\nits southern extremity, the Lindeness, or Naze, to the North Cape—\n\n“Where the Northern Ocean, in vast whirls,\nBoils round the naked, melancholy isles\n"
[2] "Of farthest Thule; and the Atlantic surge\nPours in among the stormy Hebrides.”\n\nNor could I pass unnoticed the suggestion of the bleak shores of Lapland, Siberia, Spitzbergen,\nNova Zembla, Iceland, Greenland, with “the vast sweep of the Arctic Zone, and those forlorn\nregions of dreary space,—that reservoir of frost and snow, where firm fields of ice, the\naccumulation of centuries of winters, glazed in Alpine heights above heights, surround the pole,\nand concentre the multiplied rigours of extreme cold.” Of these death-white realms I formed an\nidea of my own: shadowy, like all the half-comprehended notions that float dim through\nchildren’s brains, but strangely impressive. The words in these introductory pages connected\nthemselves with the succeeding vignettes, and gave significance to the rock standing up alone in\na sea of billow and spray; to the broken boat stranded on a desolate coast; to the cold and ghastly\nmoon glancing through bars of cloud at a wreck just sinking.\n\nI cannot tell what sentiment haunted the quite solitary churchyard, with its inscribed headstone;\nits gate, its two trees, its low horizon, girdled by a broken wall, and its newly-risen crescent,\nattesting the hour of eventide.\n\nThe two ships becalmed on a torpid sea, I believed to be marine phantoms.\n\nThe fiend pinning down the thief’s pack behind him, I passed over quickly: it was an object of\nterror.\n\nSo was the black horned thing seated aloof on a rock, surveying a distant crowd surrounding a\ngallows.\n\nEach picture told a story; mysterious often to my undeveloped understanding and imperfect\nfeelings, yet ever profoundly interesting: as interesting as the tales Bessie sometimes narrated on\nwinter evenings, when she chanced to be in good humour; and when, having brought her ironing-\ntable to the nursery hearth, she allowed us to sit about it, and while she got up Mrs. Reed’s lace\nfrills, and crimped her nightcap borders, fed our eager attention with passages of love and\nadventure taken from old fairy tales and other ballads; or (as at a later period I discovered) from\nthe pages of Pamela, and Henry, Earl of Moreland.\n\nWith Bewick on my knee, I was then happy: happy at least in my way. I feared nothing but\ninterruption, and that came too soon. The breakfast-room door opened.\n\n“Boh! Madam Mope!” cried the voice of John Reed; then he paused: he found the room\napparently empty.\n\n“Where the dickens is she!” he continued. “Lizzy! Georgy! (calling to his sisters) Joan is not\nhere: tell mama she is run out into the rain—bad animal!”\n\n“It is well I drew the curtain,” thought I; and I wished fervently he might not discover my hiding-\nplace: nor would John Reed have found it out himself; he was not quick either of vision or\nconception; but Eliza just put her head in at the door, and said at once—\n"                                                                                                                                                                                                            </code></pre>
</div>
</div>
<p>Notice that the first page is the first element of the character vector, and the second page is the second element. As we are most familiar with rectangular data, we will try to get it into that format as quickly as possible. And then we can use functions from the <code>tidyverse</code> to deal with it.</p>
<p>First we want to convert the character vector into a tibble. At this point we may like to add page numbers as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>jane_eyre <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">raw_text =</span> third_example,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">page_number =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then want to separate the lines so that each line is an observation. We can do that by looking for “\n” remembering that we need to escape the backslash as it is a special character.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>jane_eyre <span class="ot">&lt;-</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(jane_eyre, raw_text, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">n"</span>, <span class="at">convert =</span> <span class="cn">FALSE</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>jane_eyre</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 93 × 2
   raw_text                                                          page_number
   &lt;chr&gt;                                                                   &lt;int&gt;
 1 "CHAPTER I"                                                                 1
 2 "There was no possibility of taking a walk that day. We had been…           1
 3 "leafless shrubbery an hour in the morning; but since dinner (Mr…           1
 4 "company, dined early) the cold winter wind had brought with it …           1
 5 "penetrating, that further out-door exercise was now out of the …           1
 6 ""                                                                          1
 7 "I was glad of it: I never liked long walks, especially on chill…           1
 8 "coming home in the raw twilight, with nipped fingers and toes, …           1
 9 "chidings of Bessie, the nurse, and humbled by the consciousness…           1
10 "Eliza, John, and Georgiana Reed."                                          1
# ℹ 83 more rows</code></pre>
</div>
</div>
</section>
<section id="total-fertility-rate-in-the-united-states" class="level3" data-number="7.4.2">
<h3 data-number="7.4.2" class="anchored" data-anchor-id="total-fertility-rate-in-the-united-states"><span class="header-section-number">7.4.2</span> Total Fertility Rate in the United States</h3>
<p>The United States Department of Health and Human Services Vital Statistics Report provides information about the Total Fertility Rate (TFR) for each state. The average number of births per woman if women experience the current age-specific fertility rates throughout their reproductive years. The data are available in PDFs. We can use the approaches above to get the data into a dataset.</p>
<p>The table that we are interested in is on page 40 of a PDF that is available <a href="https://www.cdc.gov/nchs/data/nvsr/nvsr50/nvsr50_05.pdf">here</a> or <a href="https://github.com/RohanAlexander/telling_stories/blob/main/inputs/pdfs/dhs/year_2000.pdf">here</a>. The column of interest is labelled: “Total fertility rate” (<a href="#fig-dhsexample">Figure&nbsp;<span>7.14</span></a>).</p>
<div id="fig-dhsexample" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/dhs_example.png" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.14: Example Vital Statistics Report, from 2000</figcaption><p></p>
</figure>
</div>
<p>The first step when getting data out of a PDF is to sketch out what we eventually want. A PDF typically contains a lot of information, and so we should be clear about what is needed. This helps keep you focused, and prevents scope creep, but it is also helpful when thinking about data checks. We literally write down on paper what we have in mind. In this case, what is needed is a table with a column for state, year, and total fertility rate (TFR) (<a href="#fig-tfrdesired">Figure&nbsp;<span>7.15</span></a>).</p>
<div id="fig-tfrdesired" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/07-tfr_dataset_sketch.png" class="img-fluid figure-img" style="width:40.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.15: Planned dataset of TFR for each US state</figcaption><p></p>
</figure>
</div>
<p>We are interested in a particular column in a particular table for this PDF. Unfortunately, there is nothing magical about what is coming. This first step requires finding the PDF online, working out the link for each, and searching for the page and column name that is of interest. We have built a CSV with the details that we need and can read that in.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>summary_tfr_dataset <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"https://raw.githubusercontent.com/RohanAlexander/"</span>,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">"telling_stories/main/inputs/tfr_tables_info.csv"</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Year and associated data for TFR tables {#tbl-dhslinks}</caption>
<colgroup>
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 22%">
<col style="width: 60%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Year</th>
<th style="text-align: right;">Page</th>
<th style="text-align: right;">Table</th>
<th style="text-align: left;">Column</th>
<th style="text-align: left;">URL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2000</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">Total fertility rate</td>
<td style="text-align: left;">https://www.cdc.gov/nchs/data/nvsr/nvsr50/nvsr50_05.pdf</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We first download and save the PDF using <code>download.file()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> summary_tfr_dataset<span class="sc">$</span>url[<span class="dv">1</span>],</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile =</span> <span class="st">"year_2000.pdf"</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then read the PDF in as a character vector using <code>pdf_text()</code> from <code>pdftools</code>. And then convert it to a tibble, so that we can use familiar verbs on it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>dhs_2000 <span class="ot">&lt;-</span> <span class="fu">pdf_text</span>(<span class="st">"year_2000.pdf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>dhs_2000_tibble <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">raw_data =</span> dhs_2000)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dhs_2000_tibble)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  raw_data                                                                      
  &lt;chr&gt;                                                                         
1 "Volume 50, Number 5                                                         …
2 "2   National Vital Statistics Report, Vol. 50, No. 5, February 12, 2002\n\n\…
3 "                                                                            …
4 "4   National Vital Statistics Report, Vol. 50, No. 5, February 12, 2002\n\n\…
5 "                                                                            …
6 "6   National Vital Statistics Report, Vol. 50, No. 5, February 12, 2002\n\n …</code></pre>
</div>
</div>
<p>Grab the page that is of interest (remembering that each page is an element of the character vector, hence a row in the tibble).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>dhs_2000_relevant_page <span class="ot">&lt;-</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  dhs_2000_tibble <span class="sc">|&gt;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(summary_tfr_dataset<span class="sc">$</span>page[<span class="dv">1</span>])</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dhs_2000_relevant_page)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  raw_data                                                                      
  &lt;chr&gt;                                                                         
1 "40 National Vital Statistics Report, Vol. 50, No. 5, Revised May 15, 20022\n…</code></pre>
</div>
</div>
<p>We want to separate the rows and use <code>separate_rows()</code> from <code>tidyr</code>, which is part of the core tidyverse.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>dhs_2000_separate_rows <span class="ot">&lt;-</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  dhs_2000_relevant_page <span class="sc">|&gt;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(raw_data, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">n"</span>, <span class="at">convert =</span> <span class="cn">FALSE</span>)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dhs_2000_separate_rows)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  raw_data                                                                      
  &lt;chr&gt;                                                                         
1 "40 National Vital Statistics Report, Vol. 50, No. 5, Revised May 15, 20022"  
2 ""                                                                            
3 "Table 10. Number of births, birth rates, fertility rates, total fertility ra…
4 "United States, each State and territory, 2000"                               
5 "[By place of residence. Birth rates are live births per 1,000 estimated popu…
6 "estimated in each area; total fertility rates are sums of birth rates for 5-…</code></pre>
</div>
</div>
<p>We are searching for patterns that we can use. Let us look at the first ten lines of content (ignoring aspects such as headings and page numbers at the top of the page).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>dhs_2000_separate_rows[<span class="dv">13</span><span class="sc">:</span><span class="dv">22</span>, ] <span class="sc">|&gt;</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">raw_data =</span> <span class="fu">str_remove</span>(raw_data, <span class="st">"</span><span class="sc">\\</span><span class="st">.{40}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 1
   raw_data                                                                     
   &lt;chr&gt;                                                                        
 1 "                                  State                                    …
 2 "                                                                           …
 3 "                                                                           …
 4 ""                                                                           
 5 ""                                                                           
 6 "United States 1 ..............          4,058,814   14.7      67.5      2,1…
 7 ""                                                                           
 8 "Alabama .......................           63,299    14.4      65.0      2,0…
 9 "Alaska ...........................         9,974    16.0      74.6      2,4…
10 "Arizona .........................         85,273    17.5      84.4      2,6…</code></pre>
</div>
</div>
<p>And now at just one line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>dhs_2000_separate_rows[<span class="dv">20</span>, ] <span class="sc">|&gt;</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">raw_data =</span> <span class="fu">str_remove</span>(raw_data, <span class="st">"</span><span class="sc">\\</span><span class="st">.{40}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  raw_data                                                                      
  &lt;chr&gt;                                                                         
1 Alabama .......................           63,299    14.4      65.0      2,021…</code></pre>
</div>
</div>
<p>It does not get much better than this:</p>
<ol type="1">
<li>We have dots separating the states from the data.</li>
<li>We have a space between each of the columns.</li>
</ol>
<p>We can now separate this into columns. First, we want to match on when there are at least two dots (remembering that the dot is a special character and so needs to be escaped).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>dhs_2000_separate_columns <span class="ot">&lt;-</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  dhs_2000_separate_rows <span class="sc">|&gt;</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> raw_data,</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"data"</span>),</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.{2,}"</span>,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove =</span> <span class="cn">FALSE</span>,</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"right"</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>dhs_2000_separate_columns[<span class="dv">18</span><span class="sc">:</span><span class="dv">28</span>, ] <span class="sc">|&gt;</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
   state                   data                                                 
   &lt;chr&gt;                   &lt;chr&gt;                                                
 1 "United States 1 "      "          4,058,814   14.7      67.5      2,130.0  …
 2 ""                       &lt;NA&gt;                                                
 3 "Alabama "              "           63,299    14.4      65.0      2,021.0   …
 4 "Alaska "               "         9,974    16.0      74.6      2,437.0      …
 5 "Arizona "              "         85,273    17.5      84.4      2,652.5     …
 6 "Arkansas "             "          37,783    14.7      69.1      2,140.0    …
 7 "California "           "        531,959    15.8      70.7      2,186.0     …
 8 "Colorado "             "          65,438    15.8      73.1      2,356.5    …
 9 "Connecticut "          "           43,026    13.0      61.2      1,931.5   …
10 "Delaware "             "           11,051    14.5      63.5      2,014.0   …
11 "District of Columbia " "                7,666    14.8      63.0      1,975.…</code></pre>
</div>
</div>
<p>We then separate the data based on spaces. There is an inconsistent number of spaces, so we first squish any example of more than one space into just one with <code>str_squish()</code> from <code>stringr</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>dhs_2000_separate_data <span class="ot">&lt;-</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  dhs_2000_separate_columns <span class="sc">|&gt;</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">str_squish</span>(data)) <span class="sc">|&gt;</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> data,</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"number_of_births"</span>,</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"birth_rate"</span>,</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"fertility_rate"</span>,</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"TFR"</span>,</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"teen_births_all"</span>,</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"teen_births_15_17"</span>,</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"teen_births_18_19"</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>,</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove =</span> <span class="cn">FALSE</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>dhs_2000_separate_data[<span class="dv">18</span><span class="sc">:</span><span class="dv">28</span>, ] <span class="sc">|&gt;</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>raw_data, <span class="sc">-</span>data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 8
   state        number_of_births birth_rate fertility_rate TFR   teen_births_all
   &lt;chr&gt;        &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt;          
 1 "United Sta… 4,058,814        14.7       67.5           2,13… 48.5           
 2 ""           &lt;NA&gt;             &lt;NA&gt;       &lt;NA&gt;           &lt;NA&gt;  &lt;NA&gt;           
 3 "Alabama "   63,299           14.4       65.0           2,02… 62.9           
 4 "Alaska "    9,974            16.0       74.6           2,43… 42.4           
 5 "Arizona "   85,273           17.5       84.4           2,65… 69.1           
 6 "Arkansas "  37,783           14.7       69.1           2,14… 68.5           
 7 "California… 531,959          15.8       70.7           2,18… 48.5           
 8 "Colorado "  65,438           15.8       73.1           2,35… 49.2           
 9 "Connecticu… 43,026           13.0       61.2           1,93… 31.9           
10 "Delaware "  11,051           14.5       63.5           2,01… 51.6           
11 "District o… 7,666            14.8       63.0           1,97… 80.7           
# ℹ 2 more variables: teen_births_15_17 &lt;chr&gt;, teen_births_18_19 &lt;chr&gt;</code></pre>
</div>
</div>
<p>This is all looking fairly great. The only thing left is to clean up.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>dhs_2000_cleaned <span class="ot">&lt;-</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  dhs_2000_separate_data <span class="sc">|&gt;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, TFR) <span class="sc">|&gt;</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">74</span>) <span class="sc">|&gt;</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">TFR =</span> <span class="fu">str_remove_all</span>(TFR, <span class="st">","</span>),</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">TFR =</span> <span class="fu">as.numeric</span>(TFR),</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">str_trim</span>(state),</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">if_else</span>(state <span class="sc">==</span> <span class="st">"United States 1"</span>, <span class="st">"Total"</span>, state)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And run some checks, for instance that we have all the states.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(state.name <span class="sc">%in%</span> dhs_2000_cleaned<span class="sc">$</span>state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>And we are done (<a href="#tbl-tfrforthewin">Table&nbsp;<span>7.3</span></a>). We can see that there is quite a wide distribution of TFR by US state (<a href="#fig-smalldhsexample">Figure&nbsp;<span>7.16</span></a>). Utah has the highest and Vermont the lowest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>dhs_2000_cleaned <span class="sc">|&gt;</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"State"</span>, <span class="st">"TFR"</span>),</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">0</span>,</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-tfrforthewin" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;7.3: First ten rows of a dataset of TFR by United States state, 2000-2019</caption>
<thead>
<tr class="header">
<th style="text-align: left;">State</th>
<th style="text-align: right;">TFR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: right;">2,130</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alabama</td>
<td style="text-align: right;">2,021</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alaska</td>
<td style="text-align: right;">2,437</td>
</tr>
<tr class="even">
<td style="text-align: left;">Arizona</td>
<td style="text-align: right;">2,652</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Arkansas</td>
<td style="text-align: right;">2,140</td>
</tr>
<tr class="even">
<td style="text-align: left;">California</td>
<td style="text-align: right;">2,186</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Colorado</td>
<td style="text-align: right;">2,356</td>
</tr>
<tr class="even">
<td style="text-align: left;">Connecticut</td>
<td style="text-align: right;">1,932</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Delaware</td>
<td style="text-align: right;">2,014</td>
</tr>
<tr class="even">
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">1,976</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>dhs_2000_cleaned <span class="sc">|&gt;</span> </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">!=</span> <span class="st">"Total"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> TFR, <span class="at">y =</span> <span class="fu">fct_reorder</span>(state, TFR))) <span class="sc">+</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"State"</span>, <span class="at">x =</span> <span class="st">"Total Fertility Rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-smalldhsexample" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-gather_files/figure-html/fig-smalldhsexample-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.16: Distribution of TFR by US state in 2000</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><span class="citation" data-cites="kieransparsing">Healy (<a href="99-references.html#ref-kieransparsing" role="doc-biblioref">2022</a>)</span> provides another example of using this approach in a different context.</p>
</section>
<section id="optical-character-recognition" class="level3" data-number="7.4.3">
<h3 data-number="7.4.3" class="anchored" data-anchor-id="optical-character-recognition"><span class="header-section-number">7.4.3</span> Optical Character Recognition</h3>
<p>All of the above is predicated on having a PDF that is already “digitized”. But what if it is made of images, such as the result of a scan. Such PDFs often contain unstructured data, meaning that the data are not tagged nor organized in a regular way. Optical Character Recognition (OCR) is a process that transforms an image of text into actual text. Although there may not be much difference to a human reading a PDF before and after OCR, the PDF becomes machine-readable which allows us to use scripts <span class="citation" data-cites="Cheriet2007">(<a href="99-references.html#ref-Cheriet2007" role="doc-biblioref">Cheriet et al. 2007</a>)</span>. OCR has been used to parse images of characters since the 1950s, initially using manual approaches. While manual approaches remain the gold standard, for reasons of cost effectiveness, this has been largely replaced with statistical models.</p>
<p>In this example we use <code>tesseract</code> to OCR a document. This is a R wrapper around the Tesseract open-source OCR engine. Tesseract was initially developed at HP in the 1980s, and is now mostly developed by Google. After we install and load <code>tesseract</code> we can use <code>ocr()</code>.</p>
<p>Let us see an example with a scan from the first page of <em>Jane Eyre</em> (<a href="#fig-janescan">Figure&nbsp;<span>7.17</span></a>).</p>
<div id="fig-janescan" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/jane_scan.png" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.17: Scan of first page of Jane Eyre</figcaption><p></p>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="fu">ocr</span>(</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"jane_scan.png"</span>),</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">engine =</span> <span class="fu">tesseract</span>(<span class="st">"eng"</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>1 THERE was no possibility of taking a walk that day. We had
been wandering, indeed, in the leafless shrubbery an hour in
the morning; but since dinner (Mrs Reed, when there was no com-
pany, dined early) the cold winter wind had brought with it clouds
so sombre, and a rain so penetrating, that further out-door exercise

was now out of the question.

I was glad of it: I never liked long walks, especially on chilly
afternoons: dreadful to me was the coming home in the raw twi-
light, with nipped fingers and toes, and a heart saddened by the
chidings of Bessie, the nurse, and humbled by the consciousness of
my physical inferiority to Eliza, John, and Georgiana Reed.

The said Eliza, John, and Georgiana were now clustered round
their mama in the drawing-room: she lay reclined on a sofa by the
fireside, and with her darlings about her (for the time neither quar-
relling nor crying) looked perfectly happy. Me, she had dispensed
from joining the group; saying, ‘She regretted to be under the
necessity of keeping me at a distance; but that until she heard from
Bessie, and could discover by her own observation that I was
endeavouring in good earnest to acquire a more sociable and
child-like disposition, a more attractive and sprightly manner—
something lighter, franker, more natural as it were—she really
must exclude me from privileges intended only for contented,
happy, littie children.’

‘What does Bessie say I have done?’ I asked.

‘Jane, I don’t like cavillers or questioners: besides, there is
something truly forbidding in a child taking up her elders in that
manner. Be seated somewhere; and until you can speak pleasantly,
remain silent.’

. a TV

i; STA AEE LT JEUNE TIS Sis
a) | | | a) ee
i Ni 4 | | | ae ST | | a eg

ce A FEM yi | eS ee
Pe TT (SB ag ie pe
is \ ie mu) i i es SS
veal | Dy eT |
pa || i er itl |

aes : Oty ZR UIE OR HMR Sa ote ariel
SEEN ed — =
15</code></pre>
</div>
</div>
<p>In general the result is not too bad. OCR is a useful tool but is not perfect and the resulting data may require extra attention in terms of cleaning. For instance, in the OCR results of <a href="#fig-janescan">Figure&nbsp;<span>7.17</span></a> we see irregularities that would need to be fixed. Various options, such as focusing on the particular data of interest and increasing the contrast can help. Other popular OCR engines include Amazon Textract, Google Vision API, and ABBYY.</p>
</section>
</section>
<section id="exercises" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="exercises"><span class="header-section-number">7.5</span> Exercises</h2>
<section id="scales" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="scales">Scales</h3>
<ol type="1">
<li><em>(Plan)</em> Consider the following scenario: <em>A group of five undergraduates—Matt, Ash, Jacki, Rol, and Mike—each read some number of pages from a book each day for 100 days. Two of the undergraduates are a couple and so their number of pages is positively correlated, however all the others are independent.</em> Please sketch what that dataset could look like and then sketch a graph that you could build to show all observations.</li>
<li><em>(Simulate)</em> Please further consider the scenario described and simulate the situation. Please include five tests based on the simulated data. Submit a link to a GitHub Gist that contains your code.</li>
<li><em>(Acquire)</em> Please describe a possible source of such a dataset.</li>
<li><em>(Explore)</em> Please use <code>ggplot2</code> to build the graph that you sketched using the data that you simulated. Submit a link to a GitHub Gist that contains your code.</li>
<li><em>(Communicate)</em> Please write two paragraphs about what you did.</li>
</ol>
</section>
<section id="questions" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="questions">Questions</h3>
<ol type="1">
<li>Separately for both an API of interest to you, and an API that has an R package written around it, please list its name, a link, and a brief description of the data that are available.</li>
<li>Please consider the following code, which uses <code>gh</code> to access the GitHub API (you will need to have set up GitHub on your computer, as covered in <a href="03-workflow.html"><span>Chapter&nbsp;3</span></a>). When was the repo for <code>heapsofpapers</code> created (pick one)?
<ol type="a">
<li>2021-02-23</li>
<li>2021-03-06</li>
<li>2021-05-25</li>
<li>2021-04-27</li>
</ol></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on Tyler Bradley and Monica Alexander</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>repos <span class="ot">&lt;-</span> <span class="fu">gh</span>(<span class="st">"/users/RohanAlexander/repos"</span>, <span class="at">per_page =</span> <span class="dv">100</span>)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>repo_info <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">map_chr</span>(repos, <span class="st">"name"</span>),</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">created =</span> <span class="fu">map_chr</span>(repos, <span class="st">"created_at"</span>),</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">full_name =</span> <span class="fu">map_chr</span>(repos, <span class="st">"full_name"</span>),</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Please consider the UN’s <a href="https://population.un.org/dataportal/about/dataapi">Data API</a> and the introductory note on how to use it by <span class="citation" data-cites="schmertmannunapi">Schmertmann (<a href="99-references.html#ref-schmertmannunapi" role="doc-biblioref">2022</a>)</span>. Argentina’s location code is 32. Modify the following code to determine what Argentina’s single-year fertility rate was for 20-year-olds in 1995 (pick one)?
<ol type="a">
<li>147.679</li>
<li>172.988</li>
<li>204.124</li>
<li>128.665</li>
</ol></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>my_indicator <span class="ot">&lt;-</span> <span class="dv">68</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>my_location <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>my_startyr <span class="ot">&lt;-</span> <span class="dv">1996</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>my_endyr <span class="ot">&lt;-</span> <span class="dv">1999</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://population.un.org/dataportalapi/api/v1"</span>,</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"/data/indicators/"</span>, my_indicator, <span class="st">"/locations/"</span>,</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  my_location, <span class="st">"/start/"</span>, my_startyr, <span class="st">"/end/"</span>,</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  my_endyr, <span class="st">"/?format=csv"</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>un_data <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="at">file =</span> url, <span class="at">delim =</span> <span class="st">"|"</span>, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>un_data <span class="sc">|&gt;</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(AgeLabel <span class="sc">==</span> <span class="dv">25</span> <span class="sc">&amp;</span> TimeLabel <span class="sc">==</span> <span class="dv">1996</span>) <span class="sc">|&gt;</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>What is the main argument to <code>GET()</code> from <code>httr</code> (pick one)?
<ol type="a">
<li>“url”</li>
<li>“website”</li>
<li>“domain”</li>
<li>“location”</li>
</ol></li>
<li>What are three reasons why we should be respectful when getting scraping data from websites (write at least two paragraphs)?</li>
<li>What features of a website do we typically take advantage of when we parse the code (pick one)?
<ol type="a">
<li>HTML/CSS mark-up.</li>
<li>Cookies.</li>
<li>Facebook beacons.</li>
<li>Code comments.</li>
</ol></li>
<li>What are three advantages and three disadvantages of scraping compared with using an API?</li>
<li>What are three delimiters that could be useful when trying to bring order to a PDF that you read in as a character vector (the use of dot points is fine)?</li>
<li>Which of the following, used as part of a regular expression, would match a full stop (hint: see the “strings” cheat sheet) (pick one)?
<ol type="a">
<li>“.”</li>
<li>“.”</li>
<li>“\.”</li>
<li>“\.”</li>
</ol></li>
<li>What are three checks that we might like to use for demographic data, such as the number of births in a country in a particular year?</li>
<li>Which of these are functions from the <code>purrr</code> package (select all that apply)?
<ol type="a">
<li><code>map()</code></li>
<li><code>walk()</code></li>
<li><code>run()</code></li>
<li><code>safely()</code></li>
</ol></li>
<li>What are some principles to follow when scraping (select all that apply)?
<ol type="a">
<li>Avoid it if possible</li>
<li>Follow the site’s guidance</li>
<li>Slow down</li>
<li>Use a scalpel not an axe.</li>
</ol></li>
<li>What is the HTML tag for an item in a list (pick one)?
<ol type="a">
<li><code>li</code></li>
<li><code>body</code></li>
<li><code>b</code></li>
<li><code>em</code></li>
</ol></li>
<li>Which function should we use if we have the following text data: “rohan_alexander” in a column called “names” and want to split it into first name and surname based on the underscore (pick one)?
<ol type="a">
<li><code>separate()</code></li>
<li><code>slice()</code></li>
<li><code>spacing()</code></li>
<li><code>text_to_columns()</code></li>
</ol></li>
</ol>
</section>
<section id="tutorial" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="tutorial">Tutorial</h3>
<p>Please redo the web scraping example, but for one of: <a href="https://en.wikipedia.org/wiki/List_of_prime_ministers_of_Australia">Australia</a>, <a href="https://en.wikipedia.org/wiki/List_of_prime_ministers_of_Canada">Canada</a>, <a href="https://en.wikipedia.org/wiki/List_of_prime_ministers_of_India">India</a>, or <a href="https://en.wikipedia.org/wiki/List_of_prime_ministers_of_New_Zealand">New Zealand</a>.</p>
<p>Plan, gather, and clean the data, and then use it to create a similar table to the one created above. Write a few paragraphs about your findings. Then write a few paragraphs about the data source, what you gathered, and how you went about it. What took longer than you expected? When did it become fun? What would you do differently next time you do this? Your submission should be at least two pages, but likely more.</p>
<p>Use Quarto, and include an appropriate title, author, date, link to a GitHub repo, and citations. Submit a PDF.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-heapsofpapers" class="csl-entry" role="listitem">
Alexander, Rohan, and A Mahfouz. 2021. <em><span class="nocase">heapsofpapers: Easily Download Heaps of PDF and CSV Files</span></em>. <a href="https://CRAN.R-project.org/package=heapsofpapers">https://CRAN.R-project.org/package=heapsofpapers</a>.
</div>
<div id="ref-bailey2008design" class="csl-entry" role="listitem">
Bailey, Rosemary. 2008. <em>Design of Comparative Experiments</em>. Cambridge: Cambridge University Press. <a href="https://doi.org/10.1017/CBO9780511611483">https://doi.org/10.1017/CBO9780511611483</a>.
</div>
<div id="ref-Bor2018" class="csl-entry" role="listitem">
Bor, Jacob, Atheendar Venkataramani, David Williams, and Alexander Tsai. 2018. <span>“Police Killings and Their Spillover Effects on the Mental Health of Black Americans: A Population-Based, Quasi-Experimental Study.”</span> <em>The Lancet</em> 392 (10144): 302–10. <a href="https://doi.org/10.1016/s0140-6736(18)31130-9">https://doi.org/10.1016/s0140-6736(18)31130-9</a>.
</div>
<div id="ref-janeeyre" class="csl-entry" role="listitem">
Brontë, Charlotte. 1847. <em>Jane Eyre</em>. <a href="https://www.gutenberg.org/files/1260/1260-h/1260-h.htm">https://www.gutenberg.org/files/1260/1260-h/1260-h.htm</a>.
</div>
<div id="ref-gh" class="csl-entry" role="listitem">
Bryan, Jenny, and Hadley Wickham. 2021. <em><span class="nocase">gh: GitHub API</span></em>. <a href="https://CRAN.R-project.org/package=gh">https://CRAN.R-project.org/package=gh</a>.
</div>
<div id="ref-Cheriet2007" class="csl-entry" role="listitem">
Cheriet, Mohamed, Nawwaf Kharma, Cheng-Lin Liu, and Ching Suen. 2007. <em>Character Recognition Systems: A Guide for Students and Practitioner</em>. Wiley.
</div>
<div id="ref-cirone" class="csl-entry" role="listitem">
Cirone, Alexandra, and Arthur Spirling. 2021. <span>“Turning History into Data: Data Collection, Measurement, and Inference in HPE.”</span> <em>Journal of Historical Political Economy</em> 1 (1): 127–54. <a href="https://doi.org/10.1561/115.00000005">https://doi.org/10.1561/115.00000005</a>.
</div>
<div id="ref-collinsalexander" class="csl-entry" role="listitem">
Collins, Annie, and Rohan Alexander. 2022. <span>“Reproducibility of COVID-19 Pre-Prints.”</span> <em>Scientometrics</em> 127: 4655–73. <a href="https://doi.org/10.1007/s11192-022-04418-2">https://doi.org/10.1007/s11192-022-04418-2</a>.
</div>
<div id="ref-Comer2022" class="csl-entry" role="listitem">
Comer, Benjamin P., and Jason R. Ingram. 2022. <span>“Comparing Fatal Encounters, Mapping Police Violence, and Washington Post Fatal Police Shooting Data from 2015-2019: A Research Note.”</span> <em>Criminal Justice Review</em>, January, 073401682110710. <a href="https://doi.org/10.1177/07340168211071014">https://doi.org/10.1177/07340168211071014</a>.
</div>
<div id="ref-crawford" class="csl-entry" role="listitem">
Crawford, Kate. 2021. <em><span class="nocase">Atlas of AI</span></em>. 1st ed. New Haven: Yale University Press.
</div>
<div id="ref-Cummins2022" class="csl-entry" role="listitem">
Cummins, Neil. 2022. <span>“The Hidden Wealth of English Dynasties, 1892–2016.”</span> <em>The Economic History Review</em> 75 (3): 667–702. <a href="https://doi.org/10.1111/ehr.13120">https://doi.org/10.1111/ehr.13120</a>.
</div>
<div id="ref-scrapecoviddata" class="csl-entry" role="listitem">
Eisenstein, Michael. 2022. <span>“Need Web Data? Here’s How to Harvest Them.”</span> <em>Nature</em> 607: 200–201. <a href="https://doi.org/10.1038/d41586-022-01830-9">https://doi.org/10.1038/d41586-022-01830-9</a>.
</div>
<div id="ref-janitor" class="csl-entry" role="listitem">
Firke, Sam. 2023. <em><span class="nocase">janitor: Simple Tools for Examining and Cleaning Dirty Data</span></em>. <a href="https://CRAN.R-project.org/package=janitor">https://CRAN.R-project.org/package=janitor</a>.
</div>
<div id="ref-GrolemundWickham2011" class="csl-entry" role="listitem">
Grolemund, Garrett, and Hadley Wickham. 2011. <span>“Dates and Times Made Easy with <span class="nocase">lubridate</span>.”</span> <em>Journal of Statistical Software</em> 40 (3): 1–25. <a href="https://doi.org/10.18637/jss.v040.i03">https://doi.org/10.18637/jss.v040.i03</a>.
</div>
<div id="ref-hackett2016researchers" class="csl-entry" role="listitem">
Hackett, Robert. 2016. <span>“<span class="nocase">Researchers Caused an Uproar By Publishing Data From 70,000 OkCupid Users</span>.”</span> <em>Fortune</em>, May. <a href="https://fortune.com/2016/05/18/okcupid-data-research/">https://fortune.com/2016/05/18/okcupid-data-research/</a>.
</div>
<div id="ref-kieransparsing" class="csl-entry" role="listitem">
Healy, Kieran. 2022. <span>“Unhappy in Its Own Way,”</span> July. <a href="https://kieranhealy.org/blog/archives/2022/07/22/unhappy-in-its-own-way/">https://kieranhealy.org/blog/archives/2022/07/22/unhappy-in-its-own-way/</a>.
</div>
<div id="ref-washpostfatalforcemethods" class="csl-entry" role="listitem">
Jenkins, Jennifer, Steven Rich, Andrew Ba Tran, Paige Moody, Julie Tate, and Ted Mellnik. 2022. <span>“How the Washington Post Examines Police Shootings in the United States.”</span> <a href="https://www.washingtonpost.com/investigations/2022/12/05/washington-post-fatal-police-shootings-methodology/">https://www.washingtonpost.com/investigations/2022/12/05/washington-post-fatal-police-shootings-methodology/</a>.
</div>
<div id="ref-Johnson2021Two" class="csl-entry" role="listitem">
Johnson, Kaneesha. 2021. <span>“Two Regimes of Prison Data Collection.”</span> <em>Harvard Data Science Review</em> 3 (3). <a href="https://doi.org/10.1162/99608f92.72825001">https://doi.org/10.1162/99608f92.72825001</a>.
</div>
<div id="ref-kirkegaard2016okcupid" class="csl-entry" role="listitem">
Kirkegaard, Emil, and Julius Bjerrekær. 2016. <span>“The OKCupid Dataset: A Very Large Public Dataset of Dating Site Users.”</span> <em>Open Differential Psychology</em>, 1–10. <a href="https://doi.org/10.26775/ODP.2016.11.03">https://doi.org/10.26775/ODP.2016.11.03</a>.
</div>
<div id="ref-luscombe2021algorithmic" class="csl-entry" role="listitem">
Luscombe, Alex, Kevin Dick, and Kevin Walby. 2021. <span>“Algorithmic Thinking in the Public Interest: Navigating Technical, Legal, and Ethical Hurdles to Web Scraping in the Social Sciences.”</span> <em>Quality &amp; Quantity</em> 56 (3): 1–22. <a href="https://doi.org/10.1007/s11135-021-01164-0">https://doi.org/10.1007/s11135-021-01164-0</a>.
</div>
<div id="ref-luscombe2022jumpstarting" class="csl-entry" role="listitem">
Luscombe, Alex, Jamie Duncan, and Kevin Walby. 2022. <span>“Jumpstarting the Justice Disciplines: A Computational-Qualitative Approach to Collecting and Analyzing Text and Image Data in Criminology and Criminal Justice Studies.”</span> <em>Journal of Criminal Justice Education</em> 33 (2): 151–71. <a href="https://doi.org/10.1080/10511253.2022.2027477">https://doi.org/10.1080/10511253.2022.2027477</a>.
</div>
<div id="ref-here" class="csl-entry" role="listitem">
Müller, Kirill. 2020. <em><span class="nocase">here: A Simpler Way to Find Your Files</span></em>. <a href="https://CRAN.R-project.org/package=here">https://CRAN.R-project.org/package=here</a>.
</div>
<div id="ref-Nix2020" class="csl-entry" role="listitem">
Nix, Justin, and M. James Lozada. 2020. <span>“Police Killings of Unarmed Black Americans: A Reassessment of Community Mental Health Spillover Effects,”</span> January. <a href="https://doi.org/10.31235/osf.io/ajz2q">https://doi.org/10.31235/osf.io/ajz2q</a>.
</div>
<div id="ref-jsonlite" class="csl-entry" role="listitem">
Ooms, Jeroen. 2014. <span>“<span class="nocase">The jsonlite Package: A Practical and Consistent Mapping Between JSON Data and R Objects</span>.”</span> <em>arXiv:1403.2805 [Stat.CO]</em>. <a href="https://arxiv.org/abs/1403.2805">https://arxiv.org/abs/1403.2805</a>.
</div>
<div id="ref-pdftools" class="csl-entry" role="listitem">
———. 2022a. <em><span class="nocase">pdftools: Text Extraction, Rendering and Converting of PDF Documents</span></em>. <a href="https://CRAN.R-project.org/package=pdftools">https://CRAN.R-project.org/package=pdftools</a>.
</div>
<div id="ref-citetesseract" class="csl-entry" role="listitem">
———. 2022b. <em><span class="nocase">tesseract: Open Source OCR Engine</span></em>. <a href="https://CRAN.R-project.org/package=tesseract">https://CRAN.R-project.org/package=tesseract</a>.
</div>
<div id="ref-kaylinpavlik" class="csl-entry" role="listitem">
Pavlik, Kaylin. 2019. <span>“Understanding + Classifying Genres Using Spotify Audio Features.”</span> <a href="https://www.kaylinpavlik.com/classifying-songs-genres/">https://www.kaylinpavlik.com/classifying-songs-genres/</a>.
</div>
<div id="ref-polite" class="csl-entry" role="listitem">
Perepolkin, Dmytro. 2022. <em><span class="nocase">polite: Be Nice on the Web</span></em>. <a href="https://CRAN.R-project.org/package=polite">https://CRAN.R-project.org/package=polite</a>.
</div>
<div id="ref-citeR" class="csl-entry" role="listitem">
R Core Team. 2023. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-salganik2006experimental" class="csl-entry" role="listitem">
Salganik, Matthew, Peter Sheridan Dodds, and Duncan Watts. 2006. <span>“Experimental Study of Inequality and Unpredictability in an Artificial Cultural Market.”</span> <em>Science</em> 311 (5762): 854–56. <a href="https://doi.org/10.1126/science.1121066">https://doi.org/10.1126/science.1121066</a>.
</div>
<div id="ref-huggingfaceethics" class="csl-entry" role="listitem">
Saulnier, Lucile, Siddharth Karamcheti, Hugo Laurençon, Léo Tronchon, Thomas Wang, Victor Sanh, Amanpreet Singh, et al. 2022. <span>“Putting Ethical Principles at the Core of the Research Lifecycle.”</span> <a href="https://huggingface.co/blog/ethical-charter-multimodal">https://huggingface.co/blog/ethical-charter-multimodal</a>.
</div>
<div id="ref-schmertmannunapi" class="csl-entry" role="listitem">
Schmertmann, Carl. 2022. <span>“UN API Test,”</span> July. <a href="https://bonecave.schmert.net/un-api-example.html">https://bonecave.schmert.net/un-api-example.html</a>.
</div>
<div id="ref-Taflaga2019" class="csl-entry" role="listitem">
Taflaga, Marija, and Matthew Kerby. 2019. <span>“Who Does What Work in a Ministerial Office: Politically Appointed Staff and the Descriptive Representation of Women in Australian Political Offices, 1979<span></span>2010.”</span> <em>Political Studies</em> 68 (2): 463–85. <a href="https://doi.org/10.1177/0032321719853459">https://doi.org/10.1177/0032321719853459</a>.
</div>
<div id="ref-theeconomistonspotify" class="csl-entry" role="listitem">
The Economist. 2022. <span>“What Spotify Data Show about the Decline of English,”</span> January. <a href="https://www.economist.com/interactives/graphic-detail/2022/01/29/what-spotify-data-show-about-the-decline-of-english">https://www.economist.com/interactives/graphic-detail/2022/01/29/what-spotify-data-show-about-the-decline-of-english</a>.
</div>
<div id="ref-washpostfatalforce" class="csl-entry" role="listitem">
The Washington Post. 2023. <span>“Fatal Force Database.”</span> <a href="https://github.com/washingtonpost/data-police-shootings">https://github.com/washingtonpost/data-police-shootings</a>.
</div>
<div id="ref-spotifyr" class="csl-entry" role="listitem">
Thompson, Charlie, Daniel Antal, Josiah Parry, Donal Phipps, and Tom Wolff. 2022. <em><span class="nocase">spotifyr: R Wrapper for the <span>“Spotify”</span> Web API</span></em>. <a href="https://CRAN.R-project.org/package=spotifyr">https://CRAN.R-project.org/package=spotifyr</a>.
</div>
<div id="ref-bronnerpolicenordata" class="csl-entry" role="listitem">
Thomson-DeVeaux, Amelia, Laura Bronner, and Damini Sharma. 2021. <span>“<span class="nocase">Cities Spend Millions On Police Misconduct Every Year. Here’s Why It’s So Difficult to Hold Departments Accountable</span>.”</span> <em>FiveThirtyEight</em>, February. <a href="https://fivethirtyeight.com/features/police-misconduct-costs-cities-millions-every-year-but-thats-where-the-accountability-ends/">https://fivethirtyeight.com/features/police-misconduct-costs-cities-millions-every-year-but-thats-where-the-accountability-ends/</a>.
</div>
<div id="ref-citebabynames" class="csl-entry" role="listitem">
Wickham, Hadley. 2021. <em><span class="nocase">babynames: US Baby Names 1880-2017</span></em>. <a href="https://CRAN.R-project.org/package=babynames">https://CRAN.R-project.org/package=babynames</a>.
</div>
<div id="ref-citervest" class="csl-entry" role="listitem">
———. 2022. <em><span class="nocase">rvest: Easily Harvest (Scrape) Web Pages</span></em>. <a href="https://CRAN.R-project.org/package=rvest">https://CRAN.R-project.org/package=rvest</a>.
</div>
<div id="ref-citehttr" class="csl-entry" role="listitem">
———. 2023. <em><span class="nocase">httr: Tools for Working with URLs and HTTP</span></em>. <a href="https://CRAN.R-project.org/package=httr">https://CRAN.R-project.org/package=httr</a>.
</div>
<div id="ref-tidyverse" class="csl-entry" role="listitem">
Wickham, Hadley, Mara Averick, Jenny Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“<span class="nocase">Welcome to the Tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
<div id="ref-usethis" class="csl-entry" role="listitem">
Wickham, Hadley, Jennifer Bryan, and Malcolm Barrett. 2022. <em><span class="nocase">usethis: Automate Package and Project Setup</span></em>. <a href="https://CRAN.R-project.org/package=usethis">https://CRAN.R-project.org/package=usethis</a>.
</div>
<div id="ref-citepurrr" class="csl-entry" role="listitem">
Wickham, Hadley, and Lionel Henry. 2022. <em><span class="nocase">purrr: Functional Programming Tools</span></em>. <a href="https://CRAN.R-project.org/package=purrr">https://CRAN.R-project.org/package=purrr</a>.
</div>
<div id="ref-xml2" class="csl-entry" role="listitem">
Wickham, Hadley, Jim Hester, and Jeroen Ooms. 2021. <em><span class="nocase">xml2: Parse XML</span></em>. <a href="https://CRAN.R-project.org/package=xml2">https://CRAN.R-project.org/package=xml2</a>.
</div>
<div id="ref-facebookapitrump" class="csl-entry" role="listitem">
Wong, Julia Carrie. 2020. <span>“One Year Inside Trump’s Monumental Facebook Campaign.”</span> <em>The Guardian</em>, January. <a href="https://www.theguardian.com/us-news/2020/jan/28/donald-trump-facebook-ad-campaign-2020-election">https://www.theguardian.com/us-news/2020/jan/28/donald-trump-facebook-ad-campaign-2020-election</a>.
</div>
<div id="ref-citeknitr" class="csl-entry" role="listitem">
Xie, Yihui. 2023. <em><span class="nocase">knitr: A General-Purpose Package for Dynamic Report Generation in R</span></em>. <a href="https://yihui.org/knitr/">https://yihui.org/knitr/</a>.
</div>
<div id="ref-zimmer2018addressing" class="csl-entry" role="listitem">
Zimmer, Michael. 2018. <span>“Addressing Conceptual Gaps in Big Data Research Ethics: An Application of Contextual Integrity.”</span> <em>Social Media + Society</em> 4 (2): 1–11. <a href="https://doi.org/10.1177/2056305118768300">https://doi.org/10.1177/2056305118768300</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06-farm.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Farm data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08-hunt.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Hunt data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>