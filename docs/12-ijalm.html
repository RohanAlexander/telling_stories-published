<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.266">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Telling Stories with Data - 12&nbsp; Linear models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./13-ijaglm.html" rel="next">
<link href="./11-eda.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./11-eda.html">Modeling</a></li><li class="breadcrumb-item"><a href="./12-ijalm.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Linear models</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Telling Stories with Data</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/RohanAlexander/telling_stories/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Telling stories with data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-drinking_from_a_fire_hose.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Drinking from a fire hose</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Reproducible workflows</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Communication</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-writing_research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Writing research</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-static_communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Static communication</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Acquisition</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-farm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Farm data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-gather.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Gather data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-hunt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Hunt data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Preparation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-clean_and_prepare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Clean and prepare</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-store_and_share.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Store and share</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Modeling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-ijalm.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-ijaglm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Generalized linear models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Applications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-causality_from_obs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Causality from observational data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-mrp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Multilevel regression with post-stratification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Text as data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-concluding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Concluding remarks</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-r_essentials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">R essentials</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">R Markdown</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-assessment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Papers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-interaction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Interaction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-datasheet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Datasheets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26-sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">SQL essentials</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27-prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./28-deploy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Production</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./29-activities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Class activities</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./97-errata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Errata and updates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./98-cocktails.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">Cocktails</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">12.1</span> Introduction</a></li>
  <li><a href="#simple-linear-regression" id="toc-simple-linear-regression" class="nav-link" data-scroll-target="#simple-linear-regression"><span class="header-section-number">12.2</span> Simple linear regression</a>
  <ul class="collapse">
  <li><a href="#simulated-example-running-times" id="toc-simulated-example-running-times" class="nav-link" data-scroll-target="#simulated-example-running-times"><span class="header-section-number">12.2.1</span> Simulated example: running times</a></li>
  </ul></li>
  <li><a href="#multiple-linear-regression" id="toc-multiple-linear-regression" class="nav-link" data-scroll-target="#multiple-linear-regression"><span class="header-section-number">12.3</span> Multiple linear regression</a>
  <ul class="collapse">
  <li><a href="#simulated-example-running-times-with-rain-and-humidity" id="toc-simulated-example-running-times-with-rain-and-humidity" class="nav-link" data-scroll-target="#simulated-example-running-times-with-rain-and-humidity"><span class="header-section-number">12.3.1</span> Simulated example: running times with rain and humidity</a></li>
  </ul></li>
  <li><a href="#sec-inferencewithbayesianmethods" id="toc-sec-inferencewithbayesianmethods" class="nav-link" data-scroll-target="#sec-inferencewithbayesianmethods"><span class="header-section-number">12.4</span> Building models</a></li>
  <li><a href="#concluding-remarks" id="toc-concluding-remarks" class="nav-link" data-scroll-target="#concluding-remarks"><span class="header-section-number">12.5</span> Concluding remarks</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">12.6</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#scales" id="toc-scales" class="nav-link" data-scroll-target="#scales">Scales</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions">Questions</a></li>
  <li><a href="#tutorial" id="toc-tutorial" class="nav-link" data-scroll-target="#tutorial">Tutorial</a></li>
  <li><a href="#paper" id="toc-paper" class="nav-link" data-scroll-target="#paper">Paper</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/RohanAlexander/telling_stories/edit/main/12-ijalm.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-its-just-a-linear-model" class="quarto-section-identifier"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Linear models</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><strong>Prerequisites</strong></p>
<ul>
<li>Read <em>Regression and Other Stories</em>, <span class="citation" data-cites="gelmanhillvehtari2020">(<a href="99-references.html#ref-gelmanhillvehtari2020" role="doc-biblioref">Gelman, Hill, and Vehtari 2020</a>)</span>
<ul>
<li>Focus on Chapters 6 “Background on regression modeling”, 7 “Linear regression with a single predictor”, and 10 “Linear regression with multiple predictors”, which provide a detailed guide to linear models.</li>
</ul></li>
<li>Read <em>An Introduction to Statistical Learning with Applications in R</em>, <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. [2013] 2021</a>)</span>
<ul>
<li>Focus on Chapter 3 “Linear Regression”, which provides a complementary treatment of linear models from a different perspective.</li>
</ul></li>
<li>Read <em>Why most published research findings are false</em>, <span class="citation" data-cites="ioannidis2005most">(<a href="99-references.html#ref-ioannidis2005most" role="doc-biblioref">Ioannidis 2005</a>)</span>
<ul>
<li>Details aspects that can undermine the conclusions drawn from statistical models.</li>
</ul></li>
</ul>
<p><strong>Key concepts and skills</strong></p>
<ul>
<li>Linear models are a key component of statistical inference and enable us to quickly explore a wide range of data.</li>
<li>Simple and multiple linear regression model a continuous outcome variable as a function of one, and multiple, predictor variables, respectively.</li>
<li>Linear models tend to focus on either inference or prediction.</li>
</ul>
<p><strong>Software and packages</strong></p>
<ul>
<li>Base R <span class="citation" data-cites="citeR">(<a href="99-references.html#ref-citeR" role="doc-biblioref">R Core Team 2023</a>)</span></li>
<li><code>beepr</code> <span class="citation" data-cites="beepr">(<a href="99-references.html#ref-beepr" role="doc-biblioref">Bååth 2018</a>)</span></li>
<li><code>broom</code> <span class="citation" data-cites="broom">(<a href="99-references.html#ref-broom" role="doc-biblioref">Robinson, Hayes, and Couch 2022</a>)</span></li>
<li><code>broom.mixed</code> <span class="citation" data-cites="mixedbroom">(<a href="99-references.html#ref-mixedbroom" role="doc-biblioref">Bolker and Robinson 2022</a>)</span></li>
<li><code>knitr</code> <span class="citation" data-cites="citeknitr">(<a href="99-references.html#ref-citeknitr" role="doc-biblioref">Xie 2023</a>)</span></li>
<li><code>modelsummary</code> <span class="citation" data-cites="citemodelsummary">(<a href="99-references.html#ref-citemodelsummary" role="doc-biblioref">Arel-Bundock 2022</a>)</span></li>
<li><code>purrr</code> <span class="citation" data-cites="citepurrr">(<a href="99-references.html#ref-citepurrr" role="doc-biblioref">Wickham and Henry 2022</a>)</span></li>
<li><code>rstanarm</code> <span class="citation" data-cites="citerstanarm">(<a href="99-references.html#ref-citerstanarm" role="doc-biblioref">Goodrich et al. 2023</a>)</span></li>
<li><code>testthat</code> <span class="citation" data-cites="testthat">(<a href="99-references.html#ref-testthat" role="doc-biblioref">Wickham 2011</a>)</span></li>
<li><code>tidyverse</code> <span class="citation" data-cites="tidyverse">(<a href="99-references.html#ref-tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(beepr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="introduction" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">12.1</span> Introduction</h2>
<p>Linear models have been used in various forms for a long time. <span class="citation" data-cites="stigler">Stigler (<a href="99-references.html#ref-stigler" role="doc-biblioref">1986, 16</a>)</span> describes how least squares, which is a method to fit simple linear regression, was associated with foundational problems in astronomy in the 1700s, such as determining the motion of the moon and reconciling the non-periodic motion of Jupiter and Saturn. The fundamental issue at the time with least squares was that of hesitancy by those coming from a statistical background to combine different observations. Astronomers were early to develop a comfort with doing this, possibly because they had typically gathered their observations themselves and knew that the conditions of the data gathering were similar, even though the value of the observation was different. For instance, <span class="citation" data-cites="stigler">Stigler (<a href="99-references.html#ref-stigler" role="doc-biblioref">1986, 28</a>)</span> characterizes Leonhard Euler, the eighteenth century mathematician mentioned in <a href="06-farm.html"><span>Chapter&nbsp;6</span></a>, as considering that errors increase as they are aggregated, in comparison to Tobias Mayer, the eighteenth century astronomer, who was comfortable that errors would cancel each other. It took longer, again, for social scientists to become comfortable with linear models, possibly because they were hesitant to group together data they worried were not alike. In one sense astronomers had an advantage because they could compare their predictions with what happened whereas this was more difficult for social scientists <span class="citation" data-cites="stigler">(<a href="99-references.html#ref-stigler" role="doc-biblioref">Stigler 1986, 163</a>)</span>.</p>
<p>When we build models, we are not discovering “the truth”. A model is not, and cannot be, a true representation of reality. We are using the model to help us explore and understand our data. There is no one best model, there are just useful models that help us learn something about the data that we have and hence, hopefully, something about the world from which the data were generated. When we use models, we are trying to understand the world, but there are constraints on the perspective we bring to this. We should not just throw data into a model and hope that it will sort it out. It will not.</p>
<blockquote class="blockquote">
<p>Regression is indeed an oracle, but a cruel one. It speaks in riddles and delights in punishing us for asking bad questions.</p>
<p><span class="citation" data-cites="citemcelreath">McElreath (<a href="99-references.html#ref-citemcelreath" role="doc-biblioref">[2015] 2020, 162</a>)</span></p>
</blockquote>
<p>We use models to understand the world. We poke, push, and test them. We build them and rejoice in their beauty, and then seek to understand their limits and ultimately destroy them. It is this process that is important, it is this process that allows us to better understand the world; not the outcome, although they may be coincident. When we build models, we need to keep in mind both the world of the model and the broader world that we want to be able to speak about. The datasets that we have are often unrepresentative of real-world populations in certain ways. Models trained on such data are not worthless, but they are also not unimpeachable. To what extent does the model teach us about the data that we have? To what extent do the data that we have reflect the world about which we would like to draw conclusions? We need to keep such questions front of mind.</p>
<p>A lot of statistical methods commonly used today were developed for situations such as astronomy and agriculture. Ronald Fisher, introduced in <a href="08-hunt.html"><span>Chapter&nbsp;8</span></a>, published <span class="citation" data-cites="fisherresearchworkers">Fisher (<a href="99-references.html#ref-fisherresearchworkers" role="doc-biblioref">[1925] 1928</a>)</span> while he worked at an agricultural research institution. But many of the subsequent uses in the twentieth and twenty-first centuries concern applications that may have different properties. Statistical validity relies on assumptions, and so while what is taught is correct, our circumstances may not meet the starting criteria. Statistics is often taught as though it proceeds through some idealized process where a hypothesis appears, is tested against some data that similarly appears, and is either confirmed or not. But that is not what happens, in practice. We react to incentives. We dabble, guess, and test, and then follow our intuition, backfilling as we need. All of this is fine. But it is not a world in which a traditional null hypothesis, which we will get to later, holds completely. This means concepts such as p-values and power lose some of their meaning. While we need to understand these foundations, we also need to be sophisticated enough to know when we need to move away from them.</p>
<p>Statistical checks are widely used in modeling. And an extensive suite of them is available. But automated testing of code and data is also important. For instance, <span class="citation" data-cites="wakefieldestimates">Knutson et al. (<a href="99-references.html#ref-wakefieldestimates" role="doc-biblioref">2022</a>)</span> built a model of excess deaths in a variety of countries, to estimate the overall death toll from the pandemic. After initially releasing the model, which had been extensively manually checked for statistical issues and reasonableness, some of the results were reexamined and it was found that the estimates for Germany and Sweden were oversensitive. The authors quickly addressed the issue, but the integration of automated testing of expected values for the coefficients, in addition to the usual manual statistical checks, would go some way to enabling us to have more faith in the models of others.</p>
<p>In this chapter we begin with simple linear regression, and then move to multiple linear regression, the difference being the number of explanatory variables that we allow. We go through two approaches for each of these: base R, in particular the <code>lm()</code> and <code>glm()</code> functions, which are useful when we want to quickly use the models in EDA; and <code>rstanarm</code> for when we are interested in inference. In general, a model is either optimized for inference or prediction. A focus on prediction is one of the hallmarks of machine learning. For historical reasons that has tended to be dominated by Python, although <code>tidymodels</code> <span class="citation" data-cites="citeTidymodels">(<a href="99-references.html#ref-citeTidymodels" role="doc-biblioref">Kuhn and Wickham 2020</a>)</span> has been developed in R. Due to the need to also introduce Python, we devote the <a href="27-prediction.html"><span>Appendix&nbsp;H</span></a> to various approaches focused on prediction. Regardless of the approach we use, the important thing to remember that we are just doing something akin to fancy averaging, and our results always reflect the biases and idiosyncrasies of the dataset.</p>
<p>Finally a note on terminology and notation. For historical and context-specific reasons there are a variety of terms used to describe the same idea across the literature. We follow <span class="citation" data-cites="gelmanhillvehtari2020">Gelman, Hill, and Vehtari (<a href="99-references.html#ref-gelmanhillvehtari2020" role="doc-biblioref">2020</a>)</span> and use the terms “outcome” and “predictor”, we follow the frequentist notation of <span class="citation" data-cites="islr">James et al. (<a href="99-references.html#ref-islr" role="doc-biblioref">[2013] 2021</a>)</span>, and the Bayesian model specification of <span class="citation" data-cites="citemcelreath">McElreath (<a href="99-references.html#ref-citemcelreath" role="doc-biblioref">[2015] 2020</a>)</span>.</p>
</section>
<section id="simple-linear-regression" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="simple-linear-regression"><span class="header-section-number">12.2</span> Simple linear regression</h2>
<p>When we are interested in the relationship of some continuous outcome variable, say <span class="math inline">\(y\)</span>, and some predictor variable, say <span class="math inline">\(x\)</span>, we can use simple linear regression. This is based on the Normal, also called “Gaussian”, distribution, but it is not these variables themselves that are normally distributed. The Normal distribution is determined by two parameters, the mean, <span class="math inline">\(\mu\)</span>, and the standard deviation, <span class="math inline">\(\sigma\)</span> <span class="citation" data-cites="pitman">(<a href="99-references.html#ref-pitman" role="doc-biblioref">Pitman 1993, 94</a>)</span>:</p>
<p><span class="math display">\[y = \frac{1}{\sqrt{2\pi\sigma}}e^{-\frac{1}{2}z^2},\]</span> where <span class="math inline">\(z = (x - \mu)/\sigma\)</span> is the difference between <span class="math inline">\(x\)</span> and the mean, scaled by the standard deviation. <span class="citation" data-cites="Altman1995">Altman and Bland (<a href="99-references.html#ref-Altman1995" role="doc-biblioref">1995</a>)</span> provide an overview of the Normal distribution.</p>
<p>As introduced in <a href="20-r_essentials.html">Appendix&nbsp;<span>A</span></a>, we use <code>rnorm()</code> to simulate data from the Normal distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>normal_example <span class="ot">&lt;-</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">draws =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">20</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>normal_example <span class="sc">|&gt;</span> <span class="fu">pull</span>(draws)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -0.35980342 -0.04064753 -1.78216227 -1.12242282 -1.00278400  1.77670433
 [7] -1.38825825 -0.49749494 -0.55798959 -0.82438245  1.66877818 -0.68196486
[13]  0.06519751 -0.25985911  0.32900796 -0.43696568 -0.32288891  0.11455483
[19]  0.84239206  0.34248268</code></pre>
</div>
</div>
<p>Here we specified 20 draws from a Normal distribution with a true mean, <span class="math inline">\(\mu\)</span>, of zero and a true standard deviation, <span class="math inline">\(\sigma\)</span>, of one. When we deal with real data, we will not know the true value of these, and we want to use our data to estimate them. We can create an estimate of the mean, <span class="math inline">\(\hat{\mu}\)</span>, and an estimate of the standard deviation, <span class="math inline">\(\hat{\sigma}\)</span>, with the following estimators:</p>
<p><span class="math display">\[
\begin{aligned}
\hat{\mu} &amp;= \frac{1}{n} \times \sum_{i = 1}^{n}x_i\\
\hat{\sigma} &amp;= \sqrt{\frac{1}{n-1} \times \sum_{i = 1}^{n}\left(x_i - \hat{\mu}\right)^2}
\end{aligned}
\]</span></p>
<p>If <span class="math inline">\(\hat{\sigma}\)</span> is the estimate of the standard deviation, then the standard error (SE) of the estimate of the mean, <span class="math inline">\(\hat{\mu}\)</span>, is:</p>
<p><span class="math display">\[\mbox{SE}(\hat{\mu}) = \frac{\hat{\sigma}}{\sqrt{n}}.\]</span></p>
<p>The standard error is a comment about the estimate of the mean compared with the actual mean, while the standard deviation is a comment about how widely distributed the data are.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>We can implement these in code using our simulated data to see how close our estimates are.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>estimated_mean <span class="ot">&lt;-</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(normal_example<span class="sc">$</span>draws) <span class="sc">/</span> <span class="fu">nrow</span>(normal_example)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>normal_example <span class="ot">&lt;-</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  normal_example <span class="sc">|&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_square =</span> (draws <span class="sc">-</span> estimated_mean) <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>estimated_standard_deviation <span class="ot">&lt;-</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">sum</span>(normal_example<span class="sc">$</span>diff_square) <span class="sc">/</span> (<span class="fu">nrow</span>(normal_example) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>estimated_standard_error <span class="ot">&lt;-</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  estimated_standard_deviation <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">nrow</span>(normal_example))</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">mean =</span> estimated_mean,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd =</span> estimated_standard_deviation,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> estimated_standard_error),</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Estimated mean"</span>,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Estimated standard deviation"</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Estimated standard error"</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>),</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">linesep =</span> <span class="st">""</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-meanstdexample" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;12.1: Estimates of the mean and standard deviation based on the simulated data</caption>
<colgroup>
<col style="width: 21%">
<col style="width: 42%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Estimated mean</th>
<th style="text-align: right;">Estimated standard deviation</th>
<th style="text-align: right;">Estimated standard error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-0.21</td>
<td style="text-align: right;">0.91</td>
<td style="text-align: right;">0.2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We should not be too worried that our estimates are slightly off (<a href="#tbl-meanstdexample">Table&nbsp;<span>12.1</span></a>), relative to the “true” mean and SD of 0 and 1. We only considered 20 observations. It will typically take a larger number of draws before we get the expected shape, and our estimated parameters get close to the actual parameters, but it will almost surely happen (<a href="#fig-normaldistributiontakingshape">Figure&nbsp;<span>12.1</span></a>). <span class="citation" data-cites="wasserman">Wasserman (<a href="99-references.html#ref-wasserman" role="doc-biblioref">2005, 76</a>)</span> considers our certainty of this, which is due to the Law of Large Numbers, as a crowning accomplishment of probability, although <span class="citation" data-cites="wood">Wood (<a href="99-references.html#ref-wood" role="doc-biblioref">2015, 15</a>)</span>, perhaps more prosaically, describes it as “almost” a statement “of the obvious”!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>normal_takes_shapes <span class="ot">&lt;-</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">10000</span>, <span class="dv">100000</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>          <span class="sc">~</span> <span class="fu">tibble</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">number_draws =</span> <span class="fu">rep</span>(<span class="fu">paste</span>(.x, <span class="st">"draws"</span>), .x),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">draws =</span> <span class="fu">rnorm</span>(.x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>          ))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>normal_takes_shapes <span class="sc">|&gt;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">number_draws =</span> <span class="fu">as_factor</span>(number_draws)) <span class="sc">|&gt;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> draws)) <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(number_draws),</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Draw"</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-normaldistributiontakingshape" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-normaldistributiontakingshape-1.png" class="quarto-discovered-preview-image img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;12.1: The Normal distribution takes its familiar shape as the number of draws increases</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>When we use simple linear regression, we assume that our relationship is characterized by the variables and the parameters. If we have two variables, <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span>, then we could characterize a linear relationship between these as:</p>
<p><span id="eq-xandy"><span class="math display">\[
Y = \beta_0 + \beta_1 X + \epsilon.
\tag{12.1}\]</span></span></p>
<p>Here, there are two parameters, also referred to as coefficients: the intercept, <span class="math inline">\(\beta_0\)</span>, and the slope, <span class="math inline">\(\beta_1\)</span>. In <a href="#eq-xandy">Equation&nbsp;<span>12.1</span></a> we are saying that the expected value of <span class="math inline">\(Y\)</span> is <span class="math inline">\(\beta_0\)</span> when <span class="math inline">\(X\)</span> is 0, and that the expected value of <span class="math inline">\(Y\)</span> will change by <span class="math inline">\(\beta_1\)</span> units for every one unit change in <span class="math inline">\(X\)</span>. We may then take this relationship to the data that we have to estimate these parameters. The <span class="math inline">\(\epsilon\)</span> is noise and accounts for deviations away from this relationship. It is this noise that we generally assume to be normally distributed, and it is this that leads to <span class="math inline">\(Y \sim N(\beta, \sigma^2)\)</span>.</p>
<section id="simulated-example-running-times" class="level3" data-number="12.2.1">
<h3 data-number="12.2.1" class="anchored" data-anchor-id="simulated-example-running-times"><span class="header-section-number">12.2.1</span> Simulated example: running times</h3>
<p>To make this example concrete, we revisit an example from <a href="09-clean_and_prepare.html"><span>Chapter&nbsp;9</span></a> about the time it takes someone to run five kilometers, compared with the time it takes them to run a marathon (<a href="#fig-fivekmvsmarathon-1">Figure&nbsp;<span>12.2 (a)</span></a>). We specified a relationship of 8.4, as that is roughly the ratio between a five-kilometer run and the 42.2-kilometer distance of a marathon. To help the reader, we include the simulation code again here. Notice that it is the noise that is normally distributed, not the variables. We do not require the variables themselves to be normally distributed in order to use linear regression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>num_observations <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>expected_relationship <span class="ot">&lt;-</span> <span class="fl">8.4</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>fast_time <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>good_time <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>sim_run_data <span class="ot">&lt;-</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">five_km_time =</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">runif</span>(<span class="at">n =</span> num_observations, <span class="at">min =</span> fast_time, <span class="at">max =</span> good_time),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">noise =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> num_observations, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">20</span>),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">marathon_time =</span> five_km_time <span class="sc">*</span> expected_relationship <span class="sc">+</span> noise</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">five_km_time =</span> <span class="fu">round</span>(<span class="at">x =</span> five_km_time, <span class="at">digits =</span> <span class="dv">1</span>),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">marathon_time =</span> <span class="fu">round</span>(<span class="at">x =</span> marathon_time, <span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>noise)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>base_plot <span class="ot">&lt;-</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  sim_run_data <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> five_km_time, <span class="at">y =</span> marathon_time)) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Five-kilometer time (minutes)"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Marathon time (minutes)"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel (a)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>base_plot</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel (b)</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>base_plot <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="st">"y ~ x"</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel (c)</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>base_plot <span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="st">"y ~ x"</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-fivekmvsmarathon" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathon-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-fivekmvsmarathon-1.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathon" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Distribution of simulated data</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathon-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-fivekmvsmarathon-2.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathon" width="672"></p>
<p></p><figcaption class="figure-caption">(b) With one linear best-fit line illustrating the implied relationship</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathon-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-fivekmvsmarathon-3.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathon" width="672"></p>
<p></p><figcaption class="figure-caption">(c) Including standard errors</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;12.2: Simulated data of the relationship between the time to run five kilometers and a marathon</figcaption><p></p>
</figure>
</div>
</div>
<p>In this simulated example, we know the true values of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>, which are zero and 8.4, respectively. But our challenge is to see if we can use only the data, and simple linear regression, to recover them. That is, can we use <span class="math inline">\(x\)</span>, which is the five-kilometer time, to produce estimates of <span class="math inline">\(y\)</span>, which is the marathon time, and that we denote by <span class="math inline">\(\hat{y}\)</span> (by convention, hats are used to indicate that these are, or will be, estimated values) <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. [2013] 2021, 61</a>)</span>:</p>
<p><span class="math display">\[\hat{y} = \hat{\beta}_0 + \hat{\beta}_1 x.\]</span></p>
<p>This involves estimating values for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>. But how should we estimate these coefficients? Even if we impose a linear relationship there are many options because many straight lines could be drawn. But some of those lines would fit the data better than others.</p>
<p>One way we could define a line as being “better” than another, is if it is as close as possible to each of the known <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> combinations. There are a lot of candidates for how we define as “close as possible”, but one is to minimize the residual sum of squares. To do this we produce estimates for <span class="math inline">\(\hat{y}\)</span> based on some guesses of <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span>, given the <span class="math inline">\(x\)</span>. We then work out how wrong, for every observation <span class="math inline">\(i\)</span>, we were <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. [2013] 2021, 62</a>)</span>:</p>
<p><span class="math display">\[e_i = y_i - \hat{y}_i.\]</span></p>
<p>To compute the residual sum of squares (RSS), we sum the errors across all the points (taking the square to account for negative differences) <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. [2013] 2021, 62</a>)</span>:</p>
<p><span class="math display">\[\mbox{RSS} = e^2_1+ e^2_2 +\dots + e^2_n.\]</span></p>
<p>This results in one linear best-fit line (<a href="#fig-fivekmvsmarathon-2">Figure&nbsp;<span>12.2 (b)</span></a>), but it is worth reflecting on all the assumptions and decisions that it took to get us to this point.</p>
<p>Underpinning our use of simple linear regression is a belief that there is some “true” relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. And that this is a linear function of <span class="math inline">\(X\)</span>. We do not, and cannot, know the “true” relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. All we can do is use our sample to estimate it. But because our understanding depends on that sample, for every possible sample, we would get a slightly different relationship, as measured by the coefficients.</p>
<p>That <span class="math inline">\(\epsilon\)</span> is a measure of our error—what does the model not know in the small, contained world of the dataset? But it does not tell us whether the model is appropriate outside of the dataset (think, by way of analogy, to the concepts of internal and external validity for experiments introduced in <a href="08-hunt.html"><span>Chapter&nbsp;8</span></a>). That requires our judgement and experience.</p>
<p>We can conduct simple linear regression with <code>lm()</code> from base R. We specify the outcome variable first, then <code>~</code>, followed by the predictor. The outcome variable is the variable of interest, while the predictor is the basis on which we consider that variable. Finally, we specify the dataset.</p>
<p>Before we run a regression, we may want to include a quick check of the class of the variables, and the number of observations, just to ensure that it corresponds with what we were expecting, although we may have done that earlier in the workflow. And after we run it, we may check that our estimate seems reasonable. For instance, (pretending that we had not ourselves imposed this in the simulation) based on our knowledge of the respective distances of a five-kilometer run and a marathon, we would expect <span class="math inline">\(\beta_1\)</span> to be somewhere between six and ten.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the class and number of observations are as expected</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sim_run_data<span class="sc">$</span>marathon_time) <span class="sc">==</span> <span class="st">"numeric"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sim_run_data<span class="sc">$</span>five_km_time) <span class="sc">==</span> <span class="st">"numeric"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(sim_run_data) <span class="sc">==</span> <span class="dv">200</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>sim_run_data_first_model <span class="ot">&lt;-</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    marathon_time <span class="sc">~</span> five_km_time,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">between</span>(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  sim_run_data_first_model<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="dv">6</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To quickly see the result of the regression, we can use <code>summary()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sim_run_data_first_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = marathon_time ~ five_km_time, data = sim_run_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-49.289 -11.948   0.153  11.396  46.511 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    4.4692     6.7517   0.662    0.509    
five_km_time   8.2049     0.3005  27.305   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17.42 on 198 degrees of freedom
Multiple R-squared:  0.7902,    Adjusted R-squared:  0.7891 
F-statistic: 745.5 on 1 and 198 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>But we can also use <code>modelsummary()</code> from <code>modelsummary</code> (<a href="#tbl-modelsummaryfivekmonly">Table&nbsp;<span>12.2</span></a>). The advantage of that approach is that we get a nicely formatted table. We focus initially on those results in the “Five km only” column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Five km only"</span> <span class="ot">=</span> sim_run_data_first_model,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Five km only, centered"</span> <span class="ot">=</span> sim_run_data_centered_model</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-modelsummaryfivekmonly" class="anchored">

<div id="yeyxwjsbjl" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#yeyxwjsbjl table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#yeyxwjsbjl thead, #yeyxwjsbjl tbody, #yeyxwjsbjl tfoot, #yeyxwjsbjl tr, #yeyxwjsbjl td, #yeyxwjsbjl th {
  border-style: none;
}

#yeyxwjsbjl p {
  margin: 0;
  padding: 0;
}

#yeyxwjsbjl .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yeyxwjsbjl .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#yeyxwjsbjl .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yeyxwjsbjl .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yeyxwjsbjl .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yeyxwjsbjl .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yeyxwjsbjl .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yeyxwjsbjl .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yeyxwjsbjl .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yeyxwjsbjl .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yeyxwjsbjl .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yeyxwjsbjl .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yeyxwjsbjl .gt_spanner_row {
  border-bottom-style: hidden;
}

#yeyxwjsbjl .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#yeyxwjsbjl .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yeyxwjsbjl .gt_from_md > :first-child {
  margin-top: 0;
}

#yeyxwjsbjl .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yeyxwjsbjl .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yeyxwjsbjl .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#yeyxwjsbjl .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#yeyxwjsbjl .gt_row_group_first td {
  border-top-width: 2px;
}

#yeyxwjsbjl .gt_row_group_first th {
  border-top-width: 2px;
}

#yeyxwjsbjl .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yeyxwjsbjl .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#yeyxwjsbjl .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#yeyxwjsbjl .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yeyxwjsbjl .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yeyxwjsbjl .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yeyxwjsbjl .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#yeyxwjsbjl .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yeyxwjsbjl .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yeyxwjsbjl .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yeyxwjsbjl .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yeyxwjsbjl .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yeyxwjsbjl .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yeyxwjsbjl .gt_left {
  text-align: left;
}

#yeyxwjsbjl .gt_center {
  text-align: center;
}

#yeyxwjsbjl .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yeyxwjsbjl .gt_font_normal {
  font-weight: normal;
}

#yeyxwjsbjl .gt_font_bold {
  font-weight: bold;
}

#yeyxwjsbjl .gt_font_italic {
  font-style: italic;
}

#yeyxwjsbjl .gt_super {
  font-size: 65%;
}

#yeyxwjsbjl .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#yeyxwjsbjl .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#yeyxwjsbjl .gt_indent_1 {
  text-indent: 5px;
}

#yeyxwjsbjl .gt_indent_2 {
  text-indent: 10px;
}

#yeyxwjsbjl .gt_indent_3 {
  text-indent: 15px;
}

#yeyxwjsbjl .gt_indent_4 {
  text-indent: 20px;
}

#yeyxwjsbjl .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false"><caption>Table&nbsp;12.2:  <p>Explaining marathon times based on five-kilometer run times</p> </caption>
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=" "> </th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Five km only">Five km only</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Five km only, centered">Five km only, centered</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="" class="gt_row gt_left">(Intercept)</td>
<td headers="Five km only" class="gt_row gt_center">4.47</td>
<td headers="Five km only, centered" class="gt_row gt_center">185.73</td></tr>
    <tr><td headers="" class="gt_row gt_left"></td>
<td headers="Five km only" class="gt_row gt_center">(6.75)</td>
<td headers="Five km only, centered" class="gt_row gt_center">(1.23)</td></tr>
    <tr><td headers="" class="gt_row gt_left">five_km_time</td>
<td headers="Five km only" class="gt_row gt_center">8.20</td>
<td headers="Five km only, centered" class="gt_row gt_center"></td></tr>
    <tr><td headers="" class="gt_row gt_left"></td>
<td headers="Five km only" class="gt_row gt_center">(0.30)</td>
<td headers="Five km only, centered" class="gt_row gt_center"></td></tr>
    <tr><td headers="" class="gt_row gt_left">centered_time</td>
<td headers="Five km only" class="gt_row gt_center"></td>
<td headers="Five km only, centered" class="gt_row gt_center">8.20</td></tr>
    <tr><td headers="" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Five km only" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Five km only, centered" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">(0.30)</td></tr>
    <tr><td headers="" class="gt_row gt_left">Num.Obs.</td>
<td headers="Five km only" class="gt_row gt_center">200</td>
<td headers="Five km only, centered" class="gt_row gt_center">200</td></tr>
    <tr><td headers="" class="gt_row gt_left">R2</td>
<td headers="Five km only" class="gt_row gt_center">0.790</td>
<td headers="Five km only, centered" class="gt_row gt_center">0.790</td></tr>
    <tr><td headers="" class="gt_row gt_left">R2 Adj.</td>
<td headers="Five km only" class="gt_row gt_center">0.789</td>
<td headers="Five km only, centered" class="gt_row gt_center">0.789</td></tr>
    <tr><td headers="" class="gt_row gt_left">AIC</td>
<td headers="Five km only" class="gt_row gt_center">1714.7</td>
<td headers="Five km only, centered" class="gt_row gt_center">1714.7</td></tr>
    <tr><td headers="" class="gt_row gt_left">BIC</td>
<td headers="Five km only" class="gt_row gt_center">1724.6</td>
<td headers="Five km only, centered" class="gt_row gt_center">1724.6</td></tr>
    <tr><td headers="" class="gt_row gt_left">Log.Lik.</td>
<td headers="Five km only" class="gt_row gt_center">-854.341</td>
<td headers="Five km only, centered" class="gt_row gt_center">-854.341</td></tr>
    <tr><td headers="" class="gt_row gt_left">F</td>
<td headers="Five km only" class="gt_row gt_center">745.549</td>
<td headers="Five km only, centered" class="gt_row gt_center">745.549</td></tr>
    <tr><td headers="" class="gt_row gt_left">RMSE</td>
<td headers="Five km only" class="gt_row gt_center">17.34</td>
<td headers="Five km only, centered" class="gt_row gt_center">17.34</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
<p>The top half of <a href="#tbl-modelsummaryfivekmonly">Table&nbsp;<span>12.2</span></a> provides our estimated coefficients and standard errors in brackets. And the second half provides some useful diagnostics, which we will not dwell too much in this book. The intercept in the “Five km only” column is the marathon time associated with a hypothetical five-kilometer time of zero minutes. Hopefully this example illustrates the need to always interpret the intercept coefficient carefully. And to disregard it at times. For instance, in this circumstance, we know that the intercept should be zero, and it is just being set to around four because that is the best fit given all the observations were for five-kilometer times between 15 and 30.</p>
<p>The intercept becomes more interpretable when we run the regression using centered five-kilometer time, which we do in the “Five km only, centered” column of <a href="#tbl-modelsummaryfivekmonly">Table&nbsp;<span>12.2</span></a>. That is, for each of the five-kilometer times we subtract the mean five-kilometer time. In this case, the intercept is interpreted as the expected marathon time for someone who runs five kilometers in the average time. Notice that the slope estimate is unchanged it is only the intercept that has changed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sim_run_data <span class="ot">&lt;-</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  sim_run_data <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">centered_time =</span> five_km_time <span class="sc">-</span> <span class="fu">mean</span>(sim_run_data<span class="sc">$</span>five_km_time))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>sim_run_data_centered_model <span class="ot">&lt;-</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    marathon_time <span class="sc">~</span> centered_time,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Following <span class="citation" data-cites="gelmanhillvehtari2020">Gelman, Hill, and Vehtari (<a href="99-references.html#ref-gelmanhillvehtari2020" role="doc-biblioref">2020, 84</a>)</span> we recommend considering the coefficients as comparisons, rather than effects. And to use language that makes it clear these are comparisons, on average, based on one dataset. For instance, we may consider that the coefficient on the five-kilometer run time shows how different individuals compare. When comparing the marathon times of individuals in our dataset whose five-kilometer run time differed by one minute, on average we find their marathon times differ by about eight minutes. This makes sense seeing as a marathon is roughly that many times longer than a five-kilometer run.</p>
<p>We can use <code>augment()</code> from <code>broom</code> to add the fitted values and residuals to our original dataset. This allows us to plot the residuals (<a href="#fig-fivekmvsmarathonresids">Figure&nbsp;<span>12.3</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sim_run_data <span class="ot">&lt;-</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    sim_run_data_first_model,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_run_data, <span class="fu">aes</span>(<span class="at">x =</span> .resid)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Number of occurrences"</span>, <span class="at">x =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot b)</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_run_data, <span class="fu">aes</span>(<span class="at">x =</span> five_km_time, <span class="at">y =</span> .resid)) <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Residuals"</span>, <span class="at">x =</span> <span class="st">"Five-kilometer time (minutes)"</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot c)</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_run_data, <span class="fu">aes</span>(<span class="at">x =</span> marathon_time, <span class="at">y =</span> .resid)) <span class="sc">+</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Residuals"</span>, <span class="at">x =</span> <span class="st">"Marathon time (minutes)"</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot d)</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_run_data, <span class="fu">aes</span>(<span class="at">x =</span> marathon_time, <span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Estimated marathon time"</span>, <span class="at">x =</span> <span class="st">"Actual marathon time"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-fivekmvsmarathonresids" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathonresids-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-fivekmvsmarathonresids-1.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathonresids" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Distribution of residuals</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathonresids-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-fivekmvsmarathonresids-2.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathonresids" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Residuals by five-kilometer time</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathonresids-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-fivekmvsmarathonresids-3.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathonresids" width="672"></p>
<p></p><figcaption class="figure-caption">(c) Residuals by marathon time</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathonresids-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-fivekmvsmarathonresids-4.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathonresids" width="672"></p>
<p></p><figcaption class="figure-caption">(d) Comparing the estimated time with the actual time</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;12.3: Residuals from the simple linear regression with simulated data on the time someone takes to run five kilometers and a marathon</figcaption><p></p>
</figure>
</div>
</div>
<!-- We want our estimate to be unbiased. When we say our estimate is unbiased, we are trying to say that even though for some sample our estimate might be too high, and for another sample our estimate might be too low, eventually if we have a lot of data then our estimate would be the same as the population. That is, an estimator is unbiased if it does not systematically over- or under-estimate [@islr, p. 65]. -->
<p>We want to try to speak to the “true” relationship, so we need to try to capture how much we think our understanding depends on the sample that we have to analyze. And this is where the standard error comes in. It guides us, based on many assumptions, about how to think about the estimates of parameters based on the data that we have (<a href="#fig-fivekmvsmarathon-3">Figure&nbsp;<span>12.2 (c)</span></a>). Part of this is captured by the fact that standard errors are a function of sample size <span class="math inline">\(n\)</span>, and as the sample size increases, the standard errors decrease.</p>
<p>The most common way to summarize the range of uncertainty for a coefficient is to transform its standard error into a confidence interval. These intervals are often misunderstood to represent a statement of probability about a given realization of the coefficients (i.e.&nbsp;<span class="math inline">\(\hat\beta\)</span>). In reality, confidence intervals are a statistic whose properties can only be understood “in expectation” (which is equivalent to repeating an experiment many times). A 95 per cent confidence interval is a range, such that there is “approximately a 95 per cent chance that the” range contains the population parameter, which is typically unknown <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. [2013] 2021, 66</a>)</span>. <!-- This does not mean that when you generate a 95 per cent confidence interval, there is a 95 per cent chance the "true" coefficient lies within this range.  --> <!-- Unlike Bayesian statistics, the frequentist paradigm is not able to make probabilistic claims about coefficients during inference. --></p>
<p>When the coefficient follows a Normal distribution, the lower and upper end of a 95 per cent confidence interval range will be about <span class="math inline">\(\hat{\beta_1} \pm 2 \times \mbox{SE}\left(\hat{\beta_1}\right)\)</span>. For instance, in the case of the marathon time example, the lower end is <span class="math inline">\(8.2 - 2 \times 0.3 = 7.6\)</span> and the upper end is <span class="math inline">\(8.2 + 2 \times 0.3 = 8.8\)</span>, and the true value (which we only know in this case because we simulated it) is 8.4.</p>
<p>We can use this machinery to test claims. For instance, we could claim that there is no relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, i.e.&nbsp;<span class="math inline">\(\beta_1 = 0\)</span>, as an alternative to a claim that there is some relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, i.e.&nbsp;<span class="math inline">\(\beta_1 \neq 0\)</span>. This is the null hypothesis testing approach mentioned earlier. In <a href="08-hunt.html"><span>Chapter&nbsp;8</span></a> we needed to decide how much evidence it would take to convince us that our tea taster could distinguish whether milk or tea had been added first. In the same way, here we need to decide if the estimate of <span class="math inline">\(\beta_1\)</span>, which we denote as <span class="math inline">\(\hat{\beta}_1\)</span>, is far enough away from zero for us to be comfortable claiming that <span class="math inline">\(\beta_1 \neq 0\)</span>. If we were very confident in our estimate of <span class="math inline">\(\beta_1\)</span> then it would not have to be far, but if we were not, then it would have to be substantial. For instance, if the confidence interval contains zero, then we lack evidence to suggest <span class="math inline">\(\beta_1 \neq 0\)</span>. The standard error of <span class="math inline">\(\hat{\beta}_1\)</span> does an awful lot of work here in accounting for a variety of factors, only some of which it can actually account for, as does our choice as to what it would take to convince us.</p>
<p>We use this standard error and <span class="math inline">\(\hat{\beta}_1\)</span> to get the “test statistic” or t-statistic:</p>
<p><span class="math display">\[t = \frac{\hat{\beta}_1}{\mbox{SE}(\hat{\beta}_1)}.\]</span></p>
<p>And we then compare our t-statistic to the t-distribution of <span class="citation" data-cites="student1908probable">Student (<a href="99-references.html#ref-student1908probable" role="doc-biblioref">1908</a>)</span> to compute the probability of getting this absolute t-statistic or a larger one, if it was the case that <span class="math inline">\(\beta_1 = 0\)</span>. This probability is the p-value. A smaller p-value means there is a smaller “probability of observing something at least as extreme as the observed test statistic” <span class="citation" data-cites="gelmanhillvehtari2020">(<a href="99-references.html#ref-gelmanhillvehtari2020" role="doc-biblioref">Gelman, Hill, and Vehtari 2020, 57</a>)</span>. Here we use the t-distribution of <span class="citation" data-cites="student1908probable">Student (<a href="99-references.html#ref-student1908probable" role="doc-biblioref">1908</a>)</span> rather than the Normal distribution, because the t-distribution has slightly larger tails than a standard Normal distribution.</p>
<blockquote class="blockquote">
<p>Words! Mere words! How terrible they were! How clear, and vivid, and cruel! One could not escape from them. And yet what a subtle magic there was in them! They seemed to be able to give a plastic form to formless things, and to have a music of their own as sweet as that of viol or of lute. Mere words! Was there anything so real as words?</p>
<p><em>The Picture of Dorian Gray</em> <span class="citation" data-cites="wilde">(<a href="99-references.html#ref-wilde" role="doc-biblioref">Wilde 1891</a>)</span>.</p>
</blockquote>
<p>We will not make much use of p-values in this book because they are a specific and subtle concept. They are difficult to understand and easy to abuse. Even though they are “little help” for “scientific inference” many disciplines are incorrectly fixated on them <span class="citation" data-cites="nelderdoesntmiss">(<a href="99-references.html#ref-nelderdoesntmiss" role="doc-biblioref">Nelder 1999, 257</a>)</span>. One issue is that they embody every assumption of the workflow, including everything that went into gathering and cleaning the data. While p-values have implications if all the assumptions were correct, when we consider the full data science workflow there are usually an awful lot of assumptions. And we do not get guidance from p-values about whether the assumptions are satisfied <span class="citation" data-cites="greenland2016statistical">(<a href="99-references.html#ref-greenland2016statistical" role="doc-biblioref">Greenland et al. 2016, 339</a>)</span>.</p>
<p>A p-value may reject a null hypothesis because the null hypothesis is false, but it may also be that some data were incorrectly gathered or prepared. We can only be sure that the p-value speaks to the hypothesis we are interested in testing if all the other assumptions are correct. There is nothing wrong about using p-values, but it is important to use them in sophisticated and thoughtful ways. <span class="citation" data-cites="coxtalks">Cox (<a href="99-references.html#ref-coxtalks" role="doc-biblioref">2018</a>)</span> discusses what this requires.</p>
<p>One application where it is easy to see an inappropriate focus on p-values is in power analysis. Power, in a statistical sense, refers to probability of rejecting a null hypothesis that is false. As power relates to hypothesis testing, it also relates to sample size. There is often a worry that a study is “under-powered”, meaning there was not a large enough sample, but rarely a worry that, say, the data were inappropriately cleaned, even though we cannot distinguish between these based only on a p-value. As <span class="citation" data-cites="meng2018statistical">Meng (<a href="99-references.html#ref-meng2018statistical" role="doc-biblioref">2018</a>)</span> and <span class="citation" data-cites="Bradley2021">Bradley et al. (<a href="99-references.html#ref-Bradley2021" role="doc-biblioref">2021</a>)</span> demonstrate, a focus on power can blind us from our responsibility to ensure our data are high quality.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Shoulders of giants
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dr Nancy Reid is University Professor in the Department of Statistical Sciences at the University of Toronto. After obtaining a PhD in Statistics from Stanford University in 1979, she took a position as a postdoctoral fellow at Imperial College London. She was appointed as an assistant professor at the University of British Columbia in 1980, and then moved to the University of Toronto in 1986, where she was promoted to full professor in 1988 and served as department chair between 1997 and 2002 <span class="citation" data-cites="Staicu2017">(<a href="99-references.html#ref-Staicu2017" role="doc-biblioref">Staicu 2017</a>)</span>. Her research focuses on obtaining accurate inference in small-sample regimes and developing inferential procedures for complex models featuring intractable likelihoods. <span class="citation" data-cites="cox1987parameter">Cox and Reid (<a href="99-references.html#ref-cox1987parameter" role="doc-biblioref">1987</a>)</span> examine how re-parameterizing models can simplify inference, <span class="citation" data-cites="varin2011overview">Varin, Reid, and Firth (<a href="99-references.html#ref-varin2011overview" role="doc-biblioref">2011</a>)</span> surveys methods for approximating intractable likelihoods, and <span class="citation" data-cites="reid2003asymptotics">Reid (<a href="99-references.html#ref-reid2003asymptotics" role="doc-biblioref">2003</a>)</span> overviews inferential procedures in the small-sample regime. Dr Reid was awarded the 1992 COPSS Presidents’ Award, the Royal Statistical Society Guy Medal in Silver in 2016 and in Gold in 2022, and the COPSS Distinguished Achievement Award and Lectureship in 2022.</p>
</div>
</div>
</section>
</section>
<section id="multiple-linear-regression" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="multiple-linear-regression"><span class="header-section-number">12.3</span> Multiple linear regression</h2>
<p>To this point we have just considered one explanatory variable. But we will usually have more than one. One approach would be to run separate regressions for each explanatory variable. But compared with separate linear regressions for each, adding more explanatory variables allows for associations between the outcome variable and the predictor variable of interest to be assessed while adjusting for other explanatory variables. The results can be quite different, especially when the explanatory variables are correlated with each other.</p>
<p>We may also like to consider explanatory variables that are not continuous. For instance: pregnant or not; day or night. When there are only two options then we can use a binary variable, which is considered either 0 or 1. If we have a column of character values that only has two values, such as: <code>c("Myles", "Ruth", "Ruth", "Myles", "Myles", "Ruth")</code>, then using this as an explanatory variable in the usual regression set-up would mean that it is treated as a binary variable. If there are more than two levels, then we can use a combination of binary variables, where some baseline outcome gets integrated into the intercept.</p>
<section id="simulated-example-running-times-with-rain-and-humidity" class="level3" data-number="12.3.1">
<h3 data-number="12.3.1" class="anchored" data-anchor-id="simulated-example-running-times-with-rain-and-humidity"><span class="header-section-number">12.3.1</span> Simulated example: running times with rain and humidity</h3>
<p>As an example, we add whether it was raining to our simulated relationship between marathon and five-kilometer run times. We then specify that if it was raining, the individual is ten minutes slower than they otherwise would have been.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>slow_in_rain <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>sim_run_data <span class="ot">&lt;-</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  sim_run_data <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">was_raining =</span> <span class="fu">sample</span>(</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> num_observations,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">marathon_time =</span> <span class="fu">if_else</span>(</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>      was_raining <span class="sc">==</span> <span class="st">"Yes"</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>      marathon_time <span class="sc">+</span> slow_in_rain,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>      marathon_time</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(five_km_time, marathon_time, was_raining)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can add additional explanatory variables to <code>lm()</code> with <code>+</code>. Again, we will include a variety of quick tests for class and the number of observations, and add another about missing values. We may not have any idea what the coefficient of rain should be, but if we did not expect it to make them faster, then we could also add a test of that with a wide interval of non-negative values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sim_run_data<span class="sc">$</span>marathon_time) <span class="sc">==</span> <span class="st">"numeric"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sim_run_data<span class="sc">$</span>five_km_time) <span class="sc">==</span> <span class="st">"numeric"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sim_run_data<span class="sc">$</span>was_raining) <span class="sc">==</span> <span class="st">"character"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">all</span>(<span class="fu">complete.cases</span>(sim_run_data)),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(sim_run_data) <span class="sc">==</span> <span class="dv">200</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>sim_run_data_rain_model <span class="ot">&lt;-</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    marathon_time <span class="sc">~</span> five_km_time <span class="sc">+</span> was_raining,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">between</span>(sim_run_data_rain_model<span class="sc">$</span>coefficients[<span class="dv">3</span>], <span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sim_run_data_rain_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = marathon_time ~ five_km_time + was_raining, data = sim_run_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-48.592 -11.623   0.591  11.300  47.228 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      3.4951     6.8225   0.512    0.609    
five_km_time     8.2208     0.3009  27.318  &lt; 2e-16 ***
was_rainingYes  13.0409     3.0561   4.267 3.07e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17.42 on 197 degrees of freedom
Multiple R-squared:  0.7929,    Adjusted R-squared:  0.7908 
F-statistic: 377.1 on 2 and 197 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The result, in the second column of <a href="#tbl-modelsummaryruntimes">Table&nbsp;<span>12.3</span></a>, shows that when we compare individuals in our dataset who ran in the rain with those who did not, the ones in the rain tended to have a slower time. And this corresponds with what we expect if we look at a plot of the data (<a href="#fig-fivekmvsmarathonbinary-1">Figure&nbsp;<span>12.4 (a)</span></a>).</p>
<p>We have included two types of tests here. The ones run before <code>lm()</code> check inputs, and the ones run after <code>lm()</code> check outputs. We may notice that some of the input checks are the same as earlier. One way to avoid having to rewrite tests many times would be to install and load <code>testthat</code> to create a suite of tests of class in say an R file called “class_tests.R”, which are then called using <code>test_file()</code>.</p>
<p>For instance, we could save the following as “test_class.R” in a dedicated tests folder.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Check class"</span>, {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(sim_run_data<span class="sc">$</span>marathon_time, <span class="st">"double"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(sim_run_data<span class="sc">$</span>five_km_time, <span class="st">"double"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(sim_run_data<span class="sc">$</span>was_raining, <span class="st">"character"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could save the following as “test_observations.R”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Check number of observations is correct"</span>, {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(sim_run_data), <span class="dv">200</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Check complete"</span>, {</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">complete.cases</span>(sim_run_data)))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And finally, we could save the following as “test_coefficient_estimates.R”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Check coefficients"</span>, {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(sim_run_data_rain_model<span class="sc">$</span>coefficients[<span class="dv">3</span>], <span class="dv">0</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(sim_run_data_rain_model<span class="sc">$</span>coefficients[<span class="dv">3</span>], <span class="dv">20</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could then change the regression code to call these test files rather than write them all out.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_file</span>(<span class="st">"tests/test_observations.R"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_file</span>(<span class="st">"tests/test_class.R"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>sim_run_data_rain_model <span class="ot">&lt;-</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    marathon_time <span class="sc">~</span> five_km_time <span class="sc">+</span> was_raining,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">test_file</span>(<span class="st">"tests/test_coefficient_estimates.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is important to be clear about what we are looking for in the checks of the coefficients. When we simulate data, we put in place reasonable guesses for what the data could look like, and it is similarly reasonable guesses that we test. A failing test is not necessarily a reason to go back and change things, but instead a reminder to look at what is going on in both, and potentially update the test if necessary.</p>
<p>In addition to wanting to include additional explanatory variables, we may think that they are related to each another. For instance, maybe rain really matters if it is also humid that day. We are interested in the humidity and temperature, but also how those two variables interact (<a href="#fig-fivekmvsmarathonbinary-2">Figure&nbsp;<span>12.4 (b)</span></a>). We can do this by using <code>*</code> instead of <code>+</code> when we specify the model. When we interact variables in this way, then we almost always need to include the individual variables as well and <code>lm()</code> will do this by default. The result is contained in the third column of <a href="#tbl-modelsummaryruntimes">Table&nbsp;<span>12.3</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>slow_in_humidity <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>sim_run_data <span class="ot">&lt;-</span> sim_run_data <span class="sc">|&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">humidity =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"High"</span>, <span class="st">"Low"</span>), <span class="at">size =</span> num_observations, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>)),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">marathon_time =</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>      marathon_time <span class="sc">+</span> <span class="fu">if_else</span>(humidity <span class="sc">==</span> <span class="st">"High"</span>, slow_in_humidity, <span class="dv">0</span>),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">weather_conditions =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>      was_raining <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> humidity <span class="sc">==</span> <span class="st">"Low"</span> <span class="sc">~</span> <span class="st">"No rain, not humid"</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>      was_raining <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">&amp;</span> humidity <span class="sc">==</span> <span class="st">"Low"</span> <span class="sc">~</span> <span class="st">"Rain, not humid"</span>,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>      was_raining <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> humidity <span class="sc">==</span> <span class="st">"High"</span> <span class="sc">~</span> <span class="st">"No rain, humid"</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>      was_raining <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">&amp;</span> humidity <span class="sc">==</span> <span class="st">"High"</span> <span class="sc">~</span> <span class="st">"Rain, humid"</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>base <span class="ot">&lt;-</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  sim_run_data <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> five_km_time, <span class="at">y =</span> marathon_time)) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Five-kilometer time (minutes)"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Marathon time (minutes)"</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>base <span class="sc">+</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> was_raining)) <span class="sc">+</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> was_raining),</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="st">"y ~ x"</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Was raining"</span>)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>base <span class="sc">+</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> weather_conditions)) <span class="sc">+</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> weather_conditions),</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span>,</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="st">"y ~ x"</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Conditions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-fivekmvsmarathonbinary" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-fivekmvsmarathonbinary-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-fivekmvsmarathonbinary-1.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathonbinary" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Only whether it was raining</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-fivekmvsmarathonbinary-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-fivekmvsmarathonbinary-2.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathonbinary" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Whether it was raining and the level of humidity</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;12.4: Simple linear regression with simulated data on the time someone takes to run five kilometers and a marathon, depending on the weather</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>sim_run_data_rain_and_humidity_model <span class="ot">&lt;-</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    marathon_time <span class="sc">~</span> five_km_time <span class="sc">+</span> was_raining <span class="sc">*</span> humidity,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Five km only"</span> <span class="ot">=</span> sim_run_data_first_model,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Add rain"</span> <span class="ot">=</span> sim_run_data_rain_model,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Add humidity"</span> <span class="ot">=</span> sim_run_data_rain_and_humidity_model</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-modelsummaryruntimes" class="anchored">

<div id="kpavstyjdg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#kpavstyjdg table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kpavstyjdg thead, #kpavstyjdg tbody, #kpavstyjdg tfoot, #kpavstyjdg tr, #kpavstyjdg td, #kpavstyjdg th {
  border-style: none;
}

#kpavstyjdg p {
  margin: 0;
  padding: 0;
}

#kpavstyjdg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kpavstyjdg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kpavstyjdg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kpavstyjdg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kpavstyjdg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kpavstyjdg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kpavstyjdg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kpavstyjdg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kpavstyjdg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kpavstyjdg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kpavstyjdg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kpavstyjdg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kpavstyjdg .gt_spanner_row {
  border-bottom-style: hidden;
}

#kpavstyjdg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kpavstyjdg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kpavstyjdg .gt_from_md > :first-child {
  margin-top: 0;
}

#kpavstyjdg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kpavstyjdg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kpavstyjdg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kpavstyjdg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kpavstyjdg .gt_row_group_first td {
  border-top-width: 2px;
}

#kpavstyjdg .gt_row_group_first th {
  border-top-width: 2px;
}

#kpavstyjdg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kpavstyjdg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kpavstyjdg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kpavstyjdg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kpavstyjdg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kpavstyjdg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kpavstyjdg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kpavstyjdg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kpavstyjdg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kpavstyjdg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kpavstyjdg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kpavstyjdg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kpavstyjdg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kpavstyjdg .gt_left {
  text-align: left;
}

#kpavstyjdg .gt_center {
  text-align: center;
}

#kpavstyjdg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kpavstyjdg .gt_font_normal {
  font-weight: normal;
}

#kpavstyjdg .gt_font_bold {
  font-weight: bold;
}

#kpavstyjdg .gt_font_italic {
  font-style: italic;
}

#kpavstyjdg .gt_super {
  font-size: 65%;
}

#kpavstyjdg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kpavstyjdg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kpavstyjdg .gt_indent_1 {
  text-indent: 5px;
}

#kpavstyjdg .gt_indent_2 {
  text-indent: 10px;
}

#kpavstyjdg .gt_indent_3 {
  text-indent: 15px;
}

#kpavstyjdg .gt_indent_4 {
  text-indent: 20px;
}

#kpavstyjdg .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false"><caption>Table&nbsp;12.3:  <p>Explaining marathon times based on five-kilometer run times and
weather features</p> </caption>
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=" "> </th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Five km only">Five km only</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Add rain">Add rain</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Add humidity">Add humidity</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="" class="gt_row gt_left">(Intercept)</td>
<td headers="Five km only" class="gt_row gt_center">4.47</td>
<td headers="Add rain" class="gt_row gt_center">3.50</td>
<td headers="Add humidity" class="gt_row gt_center">17.65</td></tr>
    <tr><td headers="" class="gt_row gt_left"></td>
<td headers="Five km only" class="gt_row gt_center">(6.75)</td>
<td headers="Add rain" class="gt_row gt_center">(6.82)</td>
<td headers="Add humidity" class="gt_row gt_center">(7.18)</td></tr>
    <tr><td headers="" class="gt_row gt_left">five_km_time</td>
<td headers="Five km only" class="gt_row gt_center">8.20</td>
<td headers="Add rain" class="gt_row gt_center">8.22</td>
<td headers="Add humidity" class="gt_row gt_center">8.23</td></tr>
    <tr><td headers="" class="gt_row gt_left"></td>
<td headers="Five km only" class="gt_row gt_center">(0.30)</td>
<td headers="Add rain" class="gt_row gt_center">(0.30)</td>
<td headers="Add humidity" class="gt_row gt_center">(0.30)</td></tr>
    <tr><td headers="" class="gt_row gt_left">was_rainingYes</td>
<td headers="Five km only" class="gt_row gt_center"></td>
<td headers="Add rain" class="gt_row gt_center">13.04</td>
<td headers="Add humidity" class="gt_row gt_center">21.46</td></tr>
    <tr><td headers="" class="gt_row gt_left"></td>
<td headers="Five km only" class="gt_row gt_center"></td>
<td headers="Add rain" class="gt_row gt_center">(3.06)</td>
<td headers="Add humidity" class="gt_row gt_center">(7.68)</td></tr>
    <tr><td headers="" class="gt_row gt_left">humidityLow</td>
<td headers="Five km only" class="gt_row gt_center"></td>
<td headers="Add rain" class="gt_row gt_center"></td>
<td headers="Add humidity" class="gt_row gt_center">-14.23</td></tr>
    <tr><td headers="" class="gt_row gt_left"></td>
<td headers="Five km only" class="gt_row gt_center"></td>
<td headers="Add rain" class="gt_row gt_center"></td>
<td headers="Add humidity" class="gt_row gt_center">(3.28)</td></tr>
    <tr><td headers="" class="gt_row gt_left">was_rainingYes × humidityLow</td>
<td headers="Five km only" class="gt_row gt_center"></td>
<td headers="Add rain" class="gt_row gt_center"></td>
<td headers="Add humidity" class="gt_row gt_center">-9.93</td></tr>
    <tr><td headers="" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Five km only" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Add rain" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Add humidity" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">(8.38)</td></tr>
    <tr><td headers="" class="gt_row gt_left">Num.Obs.</td>
<td headers="Five km only" class="gt_row gt_center">200</td>
<td headers="Add rain" class="gt_row gt_center">200</td>
<td headers="Add humidity" class="gt_row gt_center">200</td></tr>
    <tr><td headers="" class="gt_row gt_left">R2</td>
<td headers="Five km only" class="gt_row gt_center">0.790</td>
<td headers="Add rain" class="gt_row gt_center">0.793</td>
<td headers="Add humidity" class="gt_row gt_center">0.796</td></tr>
    <tr><td headers="" class="gt_row gt_left">R2 Adj.</td>
<td headers="Five km only" class="gt_row gt_center">0.789</td>
<td headers="Add rain" class="gt_row gt_center">0.791</td>
<td headers="Add humidity" class="gt_row gt_center">0.792</td></tr>
    <tr><td headers="" class="gt_row gt_left">AIC</td>
<td headers="Five km only" class="gt_row gt_center">1714.7</td>
<td headers="Add rain" class="gt_row gt_center">1715.7</td>
<td headers="Add humidity" class="gt_row gt_center">1718.2</td></tr>
    <tr><td headers="" class="gt_row gt_left">BIC</td>
<td headers="Five km only" class="gt_row gt_center">1724.6</td>
<td headers="Add rain" class="gt_row gt_center">1728.9</td>
<td headers="Add humidity" class="gt_row gt_center">1738.0</td></tr>
    <tr><td headers="" class="gt_row gt_left">Log.Lik.</td>
<td headers="Five km only" class="gt_row gt_center">-854.341</td>
<td headers="Add rain" class="gt_row gt_center">-853.840</td>
<td headers="Add humidity" class="gt_row gt_center">-853.091</td></tr>
    <tr><td headers="" class="gt_row gt_left">F</td>
<td headers="Five km only" class="gt_row gt_center">745.549</td>
<td headers="Add rain" class="gt_row gt_center">377.132</td>
<td headers="Add humidity" class="gt_row gt_center">190.612</td></tr>
    <tr><td headers="" class="gt_row gt_left">RMSE</td>
<td headers="Five km only" class="gt_row gt_center">17.34</td>
<td headers="Add rain" class="gt_row gt_center">17.29</td>
<td headers="Add humidity" class="gt_row gt_center">17.23</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
<p>There are a variety of threats to the validity of linear regression estimates, and aspects to think about, particularly when using an unfamiliar dataset. We need to address these when we use it, and usually graphs and associated text are sufficient to assuage most of them. Aspects of concern include:</p>
<ol type="1">
<li>Linearity of explanatory variables. We are concerned with whether the predictors enter in a linear way. We can usually be convinced there is enough linearity in our explanatory variables for our purposes by using graphs of the variables.</li>
<li>Homoscedasticity of errors. We are concerned that the errors are not becoming systematically larger or smaller throughout the sample. If that is happening, then we term it heteroscedasticity. Again, graphs of errors, such as <a href="#fig-fivekmvsmarathonresids-2">Figure&nbsp;<span>12.3 (b)</span></a>, are used to convince us of this.</li>
<li>Independence of errors. We are concerned that the errors are not correlated with each other. For instance, if we are interested in weather-related measurement such as average daily temperature, then we may find a pattern because the temperature on one day is likely similar to the temperature on another. We can be convinced that we have satisfied this condition by looking at the residuals compared with observed values, such as <a href="#fig-fivekmvsmarathonresids-3">Figure&nbsp;<span>12.3 (c)</span></a>, or estimates compared with actual outcomes, such as <a href="#fig-fivekmvsmarathonresids-4">Figure&nbsp;<span>12.3 (d)</span></a>.</li>
<li>Outliers and other high-impact observations. Finally, we might be worried that our results are being driven by a handful of observations. For instance, thinking back to <a href="05-static_communication.html"><span>Chapter&nbsp;5</span></a> and Anscombe’s Quartet, we notice that linear regression estimates would be heavily influenced by the inclusion of one or two particular points. We can become comfortable with this by considering our analysis on various subsets. For instance, randomly removing some observation in the way we did to the US states in <a href="11-eda.html"><span>Chapter&nbsp;11</span></a>.</li>
</ol>
<p>Those aspects are statistical concerns and relate to whether the model is working. The most important threat to validity and hence the aspect that must be addressed at some length, is whether this model is directly relevant to the research question of interest.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Shoulders of giants
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dr Daniela Witten is the Dorothy Gilford Endowed Chair of Mathematical Statistics and Professor of Statistics &amp; Biostatistics at the University of Washington. After taking a PhD in Statistics from Stanford University in 2010, she joined the University of Washington as an assistant professor. She was promoted to full professor in 2018. One active area of her research is double-dipping which is focused on the effect of sample splitting <span class="citation" data-cites="selectiveinference">(<a href="99-references.html#ref-selectiveinference" role="doc-biblioref">Gao, Bien, and Witten 2022</a>)</span>. She is an author of the influential <em>Introduction to Statistical Learning</em> <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. [2013] 2021</a>)</span>. Witten was appointed a Fellow of the American Statistical Association in 2020 and awarded the COPSS Presidents’ Award in 2022.</p>
</div>
</div>
</section>
</section>
<section id="sec-inferencewithbayesianmethods" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="sec-inferencewithbayesianmethods"><span class="header-section-number">12.4</span> Building models</h2>
<p><span class="citation" data-cites="breiman2001statistical">Breiman (<a href="99-references.html#ref-breiman2001statistical" role="doc-biblioref">2001</a>)</span> describes two cultures of statistical modeling: one focused on inference and the other on prediction. In general, around the time <span class="citation" data-cites="breiman2001statistical">Breiman (<a href="99-references.html#ref-breiman2001statistical" role="doc-biblioref">2001</a>)</span> was published, various disciplines tended to focus on either inference or prediction. For instance, <span class="citation" data-cites="Jordan2004">Jordan (<a href="99-references.html#ref-Jordan2004" role="doc-biblioref">2004</a>)</span> describes how statistics and computer science had been separate for some time, but how the goals of each field were becoming more closely aligned. The rise of data science, and in particular machine learning has meant there is now a need to be comfortable with both <span class="citation" data-cites="Neufeld2021">(<a href="99-references.html#ref-Neufeld2021" role="doc-biblioref">Neufeld and Witten 2021</a>)</span>. The two cultures are being brought closer together, and there is an overlap and interaction between prediction and inference. But their separate evolution means there are still considerable cultural differences. As a small example of this, the term “machine learning” tends to be used in computer science, while the term “statistical learning” tends to be used in statistics, even though they usually refer to the same machinery.</p>
<p>In this book we will focus on inference using the probabilistic programming language Stan to fit models in a Bayesian framework, and interface with it using <code>rstanarm</code>. Inference and forecasting have different cultures, ecosystems, and priorities. You should try to develop a comfort in both. One way these different cultures manifest is in language choice. The primary language in this book is R, and for the sake of consistency we focus on that here. But there is an extensive culture, especially but not exclusively focused on prediction, that uses Python. We recommend focusing on only one language and approach initially, but after developing that initial familiarity it is important to become multilingual. We introduce prediction based on Python in <a href="27-prediction.html">Online Appendix&nbsp;<span>H</span></a>.</p>
<p>We will again not go into the details, but running a regression in a Bayesian setting is similar to the frequentist approach that underpins <code>lm()</code>. The main difference from a regression point of view, is that the parameters involved in the models (i.e.&nbsp;<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_1\)</span>, etc) are considered random variables, and so themselves have associated probability distributions. In contrast, the frequentist paradigm assumes that any randomness from these coefficients comes from a parametric assumption on the distribution of the error term, <span class="math inline">\(\epsilon\)</span>.</p>
<p>Before we run a regression in a Bayesian framework, we need to decide on a starting probability distribution for each of these parameters, which we call a “prior”. While the presence of priors adds some additional complication, it has several advantages, and we will discuss the issue of priors in more detail below. This is another reason for the workflow advocated in this book: the simulation stage leads directly to priors. We will again specify the model that we are interested in, but this time we include priors.</p>
<p><span class="math display">\[
\begin{aligned}
y_i|\mu_i, \sigma &amp;\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &amp;= \beta_0 +\beta_1x_i\\
\beta_0 &amp;\sim \mbox{Normal}(0, 2.5) \\
\beta_1 &amp;\sim \mbox{Normal}(0, 2.5) \\
\sigma &amp;\sim \mbox{Exponential}(1) \\
\end{aligned}
\]</span></p>
<p>We combine information from the data with the priors to obtain posterior distributions for our parameters. Inference is then carried out based on analyzing posterior distributions.</p>
<p>Another aspect that is different between Bayesian approaches and the way we have been doing modeling to this point, is that Bayesian models will usually take longer to run. Because of this, it can be useful to run the model in a separate R script and then save it with <code>saveRDS()</code>. With sensible Quarto chunk options for “eval” and “echo” (see <a href="03-workflow.html"><span>Chapter&nbsp;3</span></a>), the model can then be read into the Quarto document with <code>readRDS()</code> rather than being run every time the paper is compiled. In this way, the model delay is only imposed once for a given model. It can also be useful to add <code>beep()</code> from <code>beepr</code> to the end of the model, to get an audio notification when the model is done.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>sim_run_data_first_model_rstanarm <span class="ot">&lt;-</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stan_glm</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> marathon_time <span class="sc">~</span> five_km_time <span class="sc">+</span> was_raining,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">normal</span>(<span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="fl">2.5</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_intercept =</span> <span class="fu">normal</span>(<span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="fl">2.5</span>),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_aux =</span> <span class="fu">exponential</span>(<span class="at">rate =</span> <span class="dv">1</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">853</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="fu">beep</span>()</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  sim_run_data_first_model_rstanarm,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"sim_run_data_first_model_rstanarm.rds"</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>sim_run_data_first_model_rstanarm <span class="ot">&lt;-</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"sim_run_data_first_model_rstanarm.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use <code>stan_glm()</code> with the “gaussian()” family to specify multiple linear regression and the model formula is written in the same way as base R and `rstanarm``. We have explicitly added the default priors, as we see this as good practice, although strictly this is not necessary.</p>
<p>The estimation results, which are in the first column of <a href="#tbl-modelsummarybayesbetter">Table&nbsp;<span>12.4</span></a>, are not quite what we expect. For instance, the rate of increase in marathon times is estimated to be around three minutes per minute of increase in five-kilometer time, which seems low given the ratio of a five-kilometer run to marathon distance.</p>
<p>The issue of picking priors is a challenging one and the subject of extensive research. For the purposes of this book, using the <code>rstanarm</code> defaults is fine. But even if they are just the default, priors should be explicitly specified in the model and included in the function. This is to make it clear to others what has been done. We could use <code>default_prior_intercept()</code> and <code>default_prior_coef()</code> to find the default priors in <code>rstanarm</code> and then explicitly include them in the model.</p>
<p>It is normal to find it difficult to know what prior to specify. Getting started by adapting someone else’s <code>rstanarm</code> code is perfectly fine. If they have not specified their priors, then we can use the helper function <code>prior_summary()</code>, to find out which priors were used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_summary</span>(sim_run_data_first_model_rstanarm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Priors for model 'sim_run_data_first_model_rstanarm' 
------
Intercept (after predictors centered)
 ~ normal(location = 0, scale = 2.5)

Coefficients
 ~ normal(location = [0,0], scale = [2.5,2.5])

Auxiliary (sigma)
 ~ exponential(rate = 1)
------
See help('prior_summary.stanreg') for more details</code></pre>
</div>
</div>
<p>We are interested in understanding what the priors imply before we involve any data. We do this by implementing prior predictive checks. This means simulating from the priors to look at what the model implies about the possible magnitude and direction of the relationships between the explanatory and outcome variables. This process is no different to all the other simulation that we have done to this point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma =</span> <span class="fu">rep</span>(<span class="fu">rexp</span>(<span class="at">n =</span> draws, <span class="at">rate =</span> <span class="dv">1</span>), <span class="at">times =</span> <span class="dv">16</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_0 =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> draws, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">2.5</span>), <span class="at">times =</span> <span class="dv">16</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_1 =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> draws, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">2.5</span>), <span class="at">times =</span> <span class="dv">16</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">five_km_time =</span> <span class="fu">rep</span>(<span class="dv">15</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">each =</span> draws),</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mu =</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> five_km_time</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">marathon_time =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>priors <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> marathon_time)) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>priors <span class="sc">|&gt;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> five_km_time, <span class="at">y =</span> marathon_time)) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-worstmodelever" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-worstmodelever-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-worstmodelever-1.png" class="img-fluid figure-img" data-ref-parent="fig-worstmodelever" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Distribution of implied marathon times</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-worstmodelever-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-worstmodelever-2.png" class="img-fluid figure-img" data-ref-parent="fig-worstmodelever" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Relationship between 5km and marathon times</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;12.5: Some implications from the priors that were used</figcaption><p></p>
</figure>
</div>
</div>
<p><a href="#fig-worstmodelever">Figure&nbsp;<span>12.5</span></a> suggests our model has been poorly constructed. Not only are there world record marathon times, but there are also negative marathon times! One issue is that our prior for <span class="math inline">\(\beta_1\)</span> does not take in all the information that we know. We know that a marathon is about eight times longer than a five-kilometer run and so we could center the prior for <span class="math inline">\(\beta_1\)</span> around that. Our re-specified model is:</p>
<p><span class="math display">\[
\begin{aligned}
y_i|\mu_i, \sigma &amp;\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &amp;= \beta_0 +\beta_1x_i\\
\beta_0 &amp;\sim \mbox{Normal}(0, 2.5) \\
\beta_1 &amp;\sim \mbox{Normal}(8, 2.5) \\
\sigma &amp;\sim \mbox{Exponential}(1) \\
\end{aligned}
\]</span> And we can see from prior prediction checks that it seems more reasonable (<a href="#fig-secondworstmodelever">Figure&nbsp;<span>12.6</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>updated_priors <span class="ot">&lt;-</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma =</span> <span class="fu">rep</span>(<span class="fu">rexp</span>(<span class="at">n =</span> draws, <span class="at">rate =</span> <span class="dv">1</span>), <span class="at">times =</span> <span class="dv">16</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_0 =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> draws, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">2.5</span>), <span class="at">times =</span> <span class="dv">16</span>),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_1 =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> draws, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">2.5</span>), <span class="at">times =</span> <span class="dv">16</span>),</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">five_km_time =</span> <span class="fu">rep</span>(<span class="dv">15</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">each =</span> draws),</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mu =</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> five_km_time</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">marathon_time =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>updated_priors <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> marathon_time)) <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>updated_priors <span class="sc">|&gt;</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> five_km_time, <span class="at">y =</span> marathon_time)) <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-secondworstmodelever" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-secondworstmodelever-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-secondworstmodelever-1.png" class="img-fluid figure-img" data-ref-parent="fig-secondworstmodelever" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Distribution of implied marathon times</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-secondworstmodelever-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-secondworstmodelever-2.png" class="img-fluid figure-img" data-ref-parent="fig-secondworstmodelever" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Relationship between 5km and marathon times</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;12.6: Updated priors</figcaption><p></p>
</figure>
</div>
</div>
<p>If we were not sure what to do then <code>rstanarm</code> could help to improve the specified priors, by scaling them based on the data. Specify the prior that you think is reasonable, even if this is just the default, and include it in the function, but also include “autoscale = TRUE”, and <code>rstanarm</code> will adjust the scale. When we re-run our model with these updated priors and allowing auto-scaling we get much better results, which are in the second column of <a href="#tbl-modelsummarybayesbetter">Table&nbsp;<span>12.4</span></a>. You can then add those to the written-out model instead.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>sim_run_data_second_model_rstanarm <span class="ot">&lt;-</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stan_glm</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> marathon_time <span class="sc">~</span> five_km_time <span class="sc">+</span> was_raining,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">normal</span>(<span class="at">location =</span> <span class="dv">8</span>, <span class="at">scale =</span> <span class="fl">2.5</span>, <span class="at">autoscale =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_intercept =</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">2.5</span>, <span class="at">autoscale =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_aux =</span> <span class="fu">exponential</span>(<span class="at">rate =</span> <span class="dv">1</span>, <span class="at">autoscale =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">853</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  sim_run_data_second_model_rstanarm,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"sim_run_data_second_model_rstanarm.rds"</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Non-scaled priors"</span> <span class="ot">=</span> sim_run_data_first_model_rstanarm,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Auto-scaling priors"</span> <span class="ot">=</span> sim_run_data_second_model_rstanarm</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-modelsummarybayesbetter" class="anchored">

<div id="ukvjkapfts" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ukvjkapfts table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ukvjkapfts thead, #ukvjkapfts tbody, #ukvjkapfts tfoot, #ukvjkapfts tr, #ukvjkapfts td, #ukvjkapfts th {
  border-style: none;
}

#ukvjkapfts p {
  margin: 0;
  padding: 0;
}

#ukvjkapfts .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ukvjkapfts .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ukvjkapfts .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ukvjkapfts .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ukvjkapfts .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ukvjkapfts .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ukvjkapfts .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ukvjkapfts .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ukvjkapfts .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ukvjkapfts .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ukvjkapfts .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ukvjkapfts .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ukvjkapfts .gt_spanner_row {
  border-bottom-style: hidden;
}

#ukvjkapfts .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ukvjkapfts .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ukvjkapfts .gt_from_md > :first-child {
  margin-top: 0;
}

#ukvjkapfts .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ukvjkapfts .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ukvjkapfts .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ukvjkapfts .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ukvjkapfts .gt_row_group_first td {
  border-top-width: 2px;
}

#ukvjkapfts .gt_row_group_first th {
  border-top-width: 2px;
}

#ukvjkapfts .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ukvjkapfts .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ukvjkapfts .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ukvjkapfts .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ukvjkapfts .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ukvjkapfts .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ukvjkapfts .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ukvjkapfts .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ukvjkapfts .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ukvjkapfts .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ukvjkapfts .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ukvjkapfts .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ukvjkapfts .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ukvjkapfts .gt_left {
  text-align: left;
}

#ukvjkapfts .gt_center {
  text-align: center;
}

#ukvjkapfts .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ukvjkapfts .gt_font_normal {
  font-weight: normal;
}

#ukvjkapfts .gt_font_bold {
  font-weight: bold;
}

#ukvjkapfts .gt_font_italic {
  font-style: italic;
}

#ukvjkapfts .gt_super {
  font-size: 65%;
}

#ukvjkapfts .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ukvjkapfts .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ukvjkapfts .gt_indent_1 {
  text-indent: 5px;
}

#ukvjkapfts .gt_indent_2 {
  text-indent: 10px;
}

#ukvjkapfts .gt_indent_3 {
  text-indent: 15px;
}

#ukvjkapfts .gt_indent_4 {
  text-indent: 20px;
}

#ukvjkapfts .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false"><caption>Table&nbsp;12.4:  <p>Forecasting and explanatory models of marathon times based on
five-kilometer run times</p> </caption>
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=" "> </th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Non-scaled priors">Non-scaled priors</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Auto-scaling priors">Auto-scaling priors</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="" class="gt_row gt_left">(Intercept)</td>
<td headers="Non-scaled priors" class="gt_row gt_center">-67.50</td>
<td headers="Auto-scaling priors" class="gt_row gt_center">8.66</td></tr>
    <tr><td headers="" class="gt_row gt_left">five_km_time</td>
<td headers="Non-scaled priors" class="gt_row gt_center">3.47</td>
<td headers="Auto-scaling priors" class="gt_row gt_center">7.90</td></tr>
    <tr><td headers="" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">was_rainingYes</td>
<td headers="Non-scaled priors" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">0.12</td>
<td headers="Auto-scaling priors" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">9.23</td></tr>
    <tr><td headers="" class="gt_row gt_left">Num.Obs.</td>
<td headers="Non-scaled priors" class="gt_row gt_center">100</td>
<td headers="Auto-scaling priors" class="gt_row gt_center">100</td></tr>
    <tr><td headers="" class="gt_row gt_left">R2</td>
<td headers="Non-scaled priors" class="gt_row gt_center">0.015</td>
<td headers="Auto-scaling priors" class="gt_row gt_center">0.797</td></tr>
    <tr><td headers="" class="gt_row gt_left">R2 Adj.</td>
<td headers="Non-scaled priors" class="gt_row gt_center">-1.000</td>
<td headers="Auto-scaling priors" class="gt_row gt_center">0.790</td></tr>
    <tr><td headers="" class="gt_row gt_left">Log.Lik.</td>
<td headers="Non-scaled priors" class="gt_row gt_center">-678.336</td>
<td headers="Auto-scaling priors" class="gt_row gt_center">-425.193</td></tr>
    <tr><td headers="" class="gt_row gt_left">ELPD</td>
<td headers="Non-scaled priors" class="gt_row gt_center">-679.5</td>
<td headers="Auto-scaling priors" class="gt_row gt_center">-429.0</td></tr>
    <tr><td headers="" class="gt_row gt_left">ELPD s.e.</td>
<td headers="Non-scaled priors" class="gt_row gt_center">3.3</td>
<td headers="Auto-scaling priors" class="gt_row gt_center">8.9</td></tr>
    <tr><td headers="" class="gt_row gt_left">LOOIC</td>
<td headers="Non-scaled priors" class="gt_row gt_center">1359.0</td>
<td headers="Auto-scaling priors" class="gt_row gt_center">858.0</td></tr>
    <tr><td headers="" class="gt_row gt_left">LOOIC s.e.</td>
<td headers="Non-scaled priors" class="gt_row gt_center">6.6</td>
<td headers="Auto-scaling priors" class="gt_row gt_center">17.8</td></tr>
    <tr><td headers="" class="gt_row gt_left">WAIC</td>
<td headers="Non-scaled priors" class="gt_row gt_center">1359.0</td>
<td headers="Auto-scaling priors" class="gt_row gt_center">857.9</td></tr>
    <tr><td headers="" class="gt_row gt_left">RMSE</td>
<td headers="Non-scaled priors" class="gt_row gt_center">175.52</td>
<td headers="Auto-scaling priors" class="gt_row gt_center">16.85</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
<p>As we used the “autoscale = TRUE” option, it can be helpful to look at how the priors were updated with <code>prior_summary()</code> from <code>rstanarm</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_summary</span>(sim_run_data_second_model_rstanarm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Priors for model 'sim_run_data_second_model_rstanarm' 
------
Intercept (after predictors centered)
  Specified prior:
    ~ normal(location = 0, scale = 2.5)
  Adjusted prior:
    ~ normal(location = 0, scale = 95)

Coefficients
  Specified prior:
    ~ normal(location = [8,8], scale = [2.5,2.5])
  Adjusted prior:
    ~ normal(location = [8,8], scale = [ 22.64,245.52])

Auxiliary (sigma)
  Specified prior:
    ~ exponential(rate = 1)
  Adjusted prior:
    ~ exponential(rate = 0.026)
------
See help('prior_summary.stanreg') for more details</code></pre>
</div>
</div>
<p>Having built a Bayesian model, we may want to look at what it implies (<a href="#fig-ppcheckandposteriorvsprior">Figure&nbsp;<span>12.7</span></a>). One way to do this is to consider the posterior distribution.</p>
<p>One way to use the posterior distribution is to consider whether the model is doing a good job of fitting the data. The idea is that if the model is doing a good job of fitting the data, then the posterior should be able to be used to simulate data that are like the actual data <span class="citation" data-cites="bayesianworkflow">(<a href="99-references.html#ref-bayesianworkflow" role="doc-biblioref">Gelman et al. 2020</a>)</span>. We can implement a posterior predictive check with <code>pp_check()</code> from <code>rstanarm</code> (<a href="#fig-ppcheckandposteriorvsprior-1">Figure&nbsp;<span>12.7 (a)</span></a>). This compares the actual outcome variable with simulations from the posterior distribution. And we can compare the posterior with the prior with <code>posterior_vs_prior()</code> to see how much the estimates change once data are taken into account (<a href="#fig-ppcheckandposteriorvsprior-2">Figure&nbsp;<span>12.7 (b)</span></a>). Helpfully, <code>pp_check()</code> and <code>posterior_vs_prior()</code> return <code>ggplot2</code> objects so we can modify the look of them in the normal way we manipulate graphs. These checks and discussion would typically just be briefly mentioned in the main content of a paper, with the detail and graphs added to a dedicated appendix.</p>
<div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(sim_run_data_second_model_rstanarm) <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_vs_prior</span>(sim_run_data_second_model_rstanarm) <span class="sc">+</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-ppcheckandposteriorvsprior" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ppcheckandposteriorvsprior-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-ppcheckandposteriorvsprior-1.png" class="img-fluid figure-img" data-ref-parent="fig-ppcheckandposteriorvsprior" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Posterior prediction check</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ppcheckandposteriorvsprior-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-ppcheckandposteriorvsprior-2.png" class="img-fluid figure-img" data-ref-parent="fig-ppcheckandposteriorvsprior" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Comparing the posterior with the prior</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;12.7: Examining how the model fits, and is affected by, the data</figcaption><p></p>
</figure>
</div>
</div>
<p>With a simple model like this, the differences between the prediction and inference approaches are minimal. But as model or data complexity increases these differences can become important.</p>
<p>We have already discussed confidence intervals and the Bayesian equivalent to a confidence interval is called a “credibility interval”, and reflects two points where there is a certain probability mass between them, in this case 95 per cent. <!-- @tbl-modelsummarybayesbetter shows confidence intervals for `tidymodels` and credible intervals for `rstanarm`, beneath the estimates.  --> Bayesian estimation provides a distribution for each coefficient. This means there is an infinite number of points that we could use to generate this interval. <!-- We will include standard errors credible interval points in tables, because this is commonly needed.  --> The entire distribution should be shown graphically (<a href="#fig-credibleintervals">Figure&nbsp;<span>12.8</span></a>). This might be using a cross-referenced appendix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  sim_run_data_second_model_rstanarm,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"areas"</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-credibleintervals" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-credibleintervals-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;12.8: Credible intervals</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The final aspect that we would like to check is a practical matter. <code>rstanarm</code> uses a sampling algorithm called Markov chain Monte Carlo (MCMC) to obtain samples from the posterior distributions of interest. We need to quickly check for the existence of signs that the algorithm ran into issues. We consider a trace plot, such as <a href="#fig-stanareyouokay-1">Figure&nbsp;<span>12.9 (a)</span></a>, and a Rhat plot, such as <a href="#fig-stanareyouokay-2">Figure&nbsp;<span>12.9 (b)</span></a>. These would typically go in a cross-referenced appendix.</p>
<div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim_run_data_second_model_rstanarm, <span class="st">"trace"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim_run_data_second_model_rstanarm, <span class="st">"rhat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-stanareyouokay" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-stanareyouokay-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-stanareyouokay-1.png" class="img-fluid figure-img" data-ref-parent="fig-stanareyouokay" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Trace plot</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-stanareyouokay-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="12-ijalm_files/figure-html/fig-stanareyouokay-2.png" class="img-fluid figure-img" data-ref-parent="fig-stanareyouokay" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Rhat plot</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;12.9: Checking the convergence of the MCMC algorithm</figcaption><p></p>
</figure>
</div>
</div>
<p>In the trace plot, we are looking for lines that appear to bounce around, but are horizontal, and have a nice overlap between the chains. The trace plot in <a href="#fig-stanareyouokay-1">Figure&nbsp;<span>12.9 (a)</span></a> does not suggest anything out of the ordinary. Similarly, with the Rhat plot, we are looking for everything to be close to 1, and ideally no more than 1.1. Again <a href="#fig-stanareyouokay-2">Figure&nbsp;<span>12.9 (b)</span></a> is an example that does not suggest any problems. If these diagnostics are not like this, then simplify the model by removing or modifying predictors, change the priors, and re-run it.</p>
</section>
<section id="concluding-remarks" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="concluding-remarks"><span class="header-section-number">12.5</span> Concluding remarks</h2>
<p>In this chapter we have considered linear models. We established a foundation for analysis, and described some essential approaches. We have also skimmed over a lot. This chapter and the next should be considered together. These provide you with enough to get started, but for doing more than that, going through the modeling books recommended in <a href="17-concluding.html"><span>Chapter&nbsp;17</span></a>.</p>
</section>
<section id="exercises" class="level2" data-number="12.6">
<h2 data-number="12.6" class="anchored" data-anchor-id="exercises"><span class="header-section-number">12.6</span> Exercises</h2>
<section id="scales" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="scales">Scales</h3>
<ol type="1">
<li><em>(Plan)</em> Consider the following scenario: <em>A person is interested in the heights of all the buildings in London. They walk around the city counting the number of floors for each building, and noting the year of construction.</em> Please sketch what that dataset could look like and then sketch a graph that you could build to show all observations.</li>
<li><em>(Simulate)</em> Please further consider the scenario described and simulate the situation, along with three predictors that are associated the count of the number of levels. Please include at least ten tests based on the simulated data. Submit a link to a GitHub Gist that contains your code.</li>
<li><em>(Acquire)</em> Please describe one possible source of such a dataset.</li>
<li><em>(Explore)</em> Please use <code>ggplot2</code> to build the graph that you sketched. Then use <code>rstanarm</code> to build a model with number of floors as an outcome and the year of construction as a predictor. Submit a link to a GitHub Gist that contains your code.</li>
<li><em>(Communicate)</em> Please write two paragraphs about what you did.</li>
</ol>
</section>
<section id="questions" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="questions">Questions</h3>
<ol type="1">
<li>Please simulate the situation in which there are two predictors, “race” and “gender”, and one outcome variable, “vote_preference”, which is imperfectly related to them. Submit a link to a GitHub Gist that contains your code.</li>
<li>Please write a linear relationship between some outcome variable, Y, and some predictor, X. What is the intercept term? What is the slope term? What would adding a hat to these indicate?</li>
<li>Which of the following are examples of linear models (select all that apply)?
<ol type="a">
<li><code>lm(y ~ x_1 + x_2 + x_3, data = my_data)</code></li>
<li><code>lm(y ~ x_1 + x_2^2 + x_3, data = my_data)</code></li>
<li><code>lm(y ~ x_1 * x_2 + x_3, data = my_data)</code></li>
<li><code>lm(y ~ x_1 + x_1^2 + x_2 + x_3, data = my_data)</code></li>
</ol></li>
<li>What is the least squares criterion? Similarly, what is RSS and what are we trying to do when we run least squares regression?</li>
<li>What is bias (in a statistical context)?</li>
<li>Consider five variables: earth, fire, wind, water, and heart. Please simulate a scenario where heart depends on the other four, which are independent of each other. Then please write R code that would fit a linear regression model to explain heart as a function of the other variables. Submit a link to a GitHub Gist that contains your code.</li>
<li>According to <span class="citation" data-cites="greenland2016statistical">Greenland et al. (<a href="99-references.html#ref-greenland2016statistical" role="doc-biblioref">2016</a>)</span>, p-values test (pick one):
<ol type="a">
<li>All the assumptions about how the data were generated (the entire model), not just the targeted hypothesis it is supposed to test (such as a null hypothesis).</li>
<li>Whether the hypothesis targeted for testing is true or not.</li>
<li>A dichotomy whereby results can be declared “statistically significant”.</li>
</ol></li>
<li>According to <span class="citation" data-cites="greenland2016statistical">Greenland et al. (<a href="99-references.html#ref-greenland2016statistical" role="doc-biblioref">2016</a>)</span>, a p-value may be small because (select all that apply):
<ol type="a">
<li>The targeted hypothesis is false.</li>
<li>The study protocols were violated.</li>
<li>It was selected for presentation based on its small size.</li>
</ol></li>
<li>Please explain what a p-value is, using only the term itself (i.e.&nbsp;“p-value”) and words that are amongst the 1,000 most common in the English language according to the <a href="https://xkcd.com/simplewriter/">XKCD Simple Writer</a>. (Please write one or two paragraphs.)</li>
<li>What is power (in a statistical context)?</li>
<li>Look at the list of people awarded the <a href="https://en.wikipedia.org/wiki/COPSS_Presidents%27_Award">COPSS Presidents’ Award</a> or the <a href="https://en.wikipedia.org/wiki/Guy_Medal">Guy Medal in Gold</a> and write a short biography of them in the style of the “Shoulders of giants” entries in this book.</li>
<li>Discuss, with the help of examples and citations, the quote from <span class="citation" data-cites="citemcelreath">McElreath (<a href="99-references.html#ref-citemcelreath" role="doc-biblioref">[2015] 2020, 162</a>)</span> included toward the start of this chapter. Write at least three paragraphs.</li>
</ol>
</section>
<section id="tutorial" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="tutorial">Tutorial</h3>
<p>Allow that the true data generating process is a Normal distribution with mean of one, and standard deviation of 1. We obtain a sample of 1,000 observations using some instrument. Simulate the following situation:</p>
<ol type="1">
<li>Unknown to us, the instrument has a mistake in it, which means that it has a maximum memory of 900 observations, and begins over-writing at that point, so the final 100 observations are actually a repeat of the first 100.</li>
<li>We employ a research assistant to clean and prepare the dataset. During the process of doing this, unknown to us, they accidentally change half of the negative draws to be positive.</li>
<li>They additionally, accidentally, change the decimal place on any value between 1 and 1.1, so that, for instance 1 becomes 0.1, and 1.1 would become 0.11.</li>
<li>You finally get the cleaned dataset and are interested in understanding whether the mean of the true data generating process is greater than 0.</li>
</ol>
<p>Write at least two pages about what you did and what you found. Also discuss what effect the issues had, and what steps you can put in place to ensure actual analysis has a chance to flag some of these issues.</p>
<p>Use Quarto, and include an appropriate title, author, date, link to a GitHub repo, and citations to produce a draft. Following this, please pair with another student and exchange your written work. Update it based on their feedback, and be sure to acknowledge them by name in your paper. Submit a PDF.</p>
</section>
<section id="paper" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="paper">Paper</h3>
<p>At about this point the <em>Murrumbidgee</em> Paper from <a href="23-assessment.html">Online Appendix&nbsp;<span>D</span></a> would be appropriate.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-Altman1995" class="csl-entry" role="listitem">
Altman, Douglas, and Martin Bland. 1995. <span>“<span class="nocase">Statistics notes: The normal distribution</span>.”</span> <em><span>BMJ</span></em> 310 (6975): 298–98. <a href="https://doi.org/10.1136/bmj.310.6975.298">https://doi.org/10.1136/bmj.310.6975.298</a>.
</div>
<div id="ref-citemodelsummary" class="csl-entry" role="listitem">
Arel-Bundock, Vincent. 2022. <span>“<span class="nocase">modelsummary</span>: Data and Model Summaries in <span>R</span>.”</span> <em>Journal of Statistical Software</em> 103 (1): 1–23. <a href="https://doi.org/10.18637/jss.v103.i01">https://doi.org/10.18637/jss.v103.i01</a>.
</div>
<div id="ref-beepr" class="csl-entry" role="listitem">
Bååth, Rasmus. 2018. <em><span class="nocase">beepr: Easily Play Notification Sounds on any Platform</span></em>. <a href="https://CRAN.R-project.org/package=beepr">https://CRAN.R-project.org/package=beepr</a>.
</div>
<div id="ref-mixedbroom" class="csl-entry" role="listitem">
Bolker, Ben, and David Robinson. 2022. <em><span class="nocase">broom.mixed: Tidying Methods for Mixed Models</span></em>. <a href="https://CRAN.R-project.org/package=broom.mixed">https://CRAN.R-project.org/package=broom.mixed</a>.
</div>
<div id="ref-Bradley2021" class="csl-entry" role="listitem">
Bradley, Valerie, Shiro Kuriwaki, Michael Isakov, Dino Sejdinovic, Xiao-Li Meng, and Seth Flaxman. 2021. <span>“Unrepresentative Big Surveys Significantly Overestimated <span>US</span> Vaccine Uptake.”</span> <em>Nature</em> 600 (7890): 695–700. <a href="https://doi.org/10.1038/s41586-021-04198-4">https://doi.org/10.1038/s41586-021-04198-4</a>.
</div>
<div id="ref-breiman2001statistical" class="csl-entry" role="listitem">
Breiman, Leo. 2001. <span>“Statistical Modeling: The Two Cultures.”</span> <em>Statistical Science</em> 16 (3): 199–231. <a href="https://doi.org/10.1214/ss/1009213726">https://doi.org/10.1214/ss/1009213726</a>.
</div>
<div id="ref-coxtalks" class="csl-entry" role="listitem">
Cox, David. 2018. <span>“In Gentle Praise of Significance Tests.”</span> <em>YouTube</em>, October. <a href="https://youtu.be/txLj%5FP9UlCQ">https://youtu.be/txLj%5FP9UlCQ</a>.
</div>
<div id="ref-cox1987parameter" class="csl-entry" role="listitem">
Cox, David, and Nancy Reid. 1987. <span>“Parameter Orthogonality and Approximate Conditional Inference.”</span> <em>Journal of the Royal Statistical Society: Series B (Methodological)</em> 49 (1): 1–18. <a href="https://doi.org/10.1111/j.2517-6161.1987.tb01422.x">https://doi.org/10.1111/j.2517-6161.1987.tb01422.x</a>.
</div>
<div id="ref-fisherresearchworkers" class="csl-entry" role="listitem">
Fisher, Ronald. (1925) 1928. <em>Statistical Methods for Research Workers</em>. 2nd ed. London: Oliver; Boyd.
</div>
<div id="ref-selectiveinference" class="csl-entry" role="listitem">
Gao, Lucy, Jacob Bien, and Daniela Witten. 2022. <span>“Selective Inference for Hierarchical Clustering.”</span> <em>Journal of the American Statistical Association</em>, October, 1–11. <a href="https://doi.org/10.1080/01621459.2022.2116331">https://doi.org/10.1080/01621459.2022.2116331</a>.
</div>
<div id="ref-gelmanhillvehtari2020" class="csl-entry" role="listitem">
Gelman, Andrew, Jennifer Hill, and Aki Vehtari. 2020. <em>Regression and Other Stories</em>. Cambridge University Press. <a href="https://avehtari.github.io/ROS-Examples/">https://avehtari.github.io/ROS-Examples/</a>.
</div>
<div id="ref-bayesianworkflow" class="csl-entry" role="listitem">
Gelman, Andrew, Aki Vehtari, Daniel Simpson, Charles Margossian, Bob Carpenter, Yuling Yao, Lauren Kennedy, Jonah Gabry, Paul-Christian Bürkner, and Martin Modrák. 2020. <span>“Bayesian Workflow.”</span> arXiv. <a href="https://doi.org/10.48550/arXiv.2011.01808">https://doi.org/10.48550/arXiv.2011.01808</a>.
</div>
<div id="ref-citerstanarm" class="csl-entry" role="listitem">
Goodrich, Ben, Jonah Gabry, Imad Ali, and Sam Brilleman. 2023. <span>“<span class="nocase">rstanarm: <span>Bayesian</span> applied regression modeling via <span>Stan</span></span>.”</span> <a href="https://mc-stan.org/rstanarm">https://mc-stan.org/rstanarm</a>.
</div>
<div id="ref-greenland2016statistical" class="csl-entry" role="listitem">
Greenland, Sander, Stephen Senn, Kenneth Rothman, John Carlin, Charles Poole, Steven Goodman, and Douglas Altman. 2016. <span>“<span class="nocase">Statistical Tests, P values, Confidence Intervals, and Power: A Guide to Misinterpretations</span>.”</span> <em>European Journal of Epidemiology</em> 31 (4): 337–50. <a href="https://doi.org/10.1007/s10654-016-0149-3">https://doi.org/10.1007/s10654-016-0149-3</a>.
</div>
<div id="ref-ioannidis2005most" class="csl-entry" role="listitem">
Ioannidis, John. 2005. <span>“Why Most Published Research Findings Are False.”</span> <em>PLOS Medicine</em> 2 (8): e124. <a href="https://doi.org/10.1371/journal.pmed.0020124">https://doi.org/10.1371/journal.pmed.0020124</a>.
</div>
<div id="ref-islr" class="csl-entry" role="listitem">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. (2013) 2021. <em><span class="nocase">An Introduction to Statistical Learning with Applications in R</span></em>. 2nd ed. Springer. <a href="https://www.statlearning.com">https://www.statlearning.com</a>.
</div>
<div id="ref-Jordan2004" class="csl-entry" role="listitem">
Jordan, Michael. 2004. <span>“Graphical Models.”</span> <em>Statistical Science</em> 19 (1). <a href="https://doi.org/10.1214/088342304000000026">https://doi.org/10.1214/088342304000000026</a>.
</div>
<div id="ref-wakefieldestimates" class="csl-entry" role="listitem">
Knutson, Victoria, Serge Aleshin-Guendel, Ariel Karlinsky, William Msemburi, and Jon Wakefield. 2022. <span>“Estimating Global and Country-Specific Excess Mortality During the COVID-19 Pandemic,”</span> May. <a href="https://cdn.who.int/media/docs/default-source/world-health-data-platform/covid-19-excessmortality/covid-methods-paper-revision.pdf">https://cdn.who.int/media/docs/default-source/world-health-data-platform/covid-19-excessmortality/covid-methods-paper-revision.pdf</a>.
</div>
<div id="ref-citeTidymodels" class="csl-entry" role="listitem">
Kuhn, Max, and Hadley Wickham. 2020. <em><span class="nocase">tidymodels: a collection of packages for modeling and machine learning using tidyverse principles</span></em>. <a href="https://www.tidymodels.org">https://www.tidymodels.org</a>.
</div>
<div id="ref-citemcelreath" class="csl-entry" role="listitem">
McElreath, Richard. (2015) 2020. <em><span class="nocase">Statistical Rethinking: A Bayesian Course with Examples in R and Stan</span></em>. 2nd ed. Chapman; Hall/CRC.
</div>
<div id="ref-meng2018statistical" class="csl-entry" role="listitem">
Meng, Xiao-Li. 2018. <span>“Statistical Paradises and Paradoxes in Big Data (i): Law of Large Populations, Big Data Paradox, and the 2016 US Presidential Election.”</span> <em>The Annals of Applied Statistics</em> 12 (2): 685–726. <a href="https://doi.org/10.1214/18-AOAS1161SF">https://doi.org/10.1214/18-AOAS1161SF</a>.
</div>
<div id="ref-nelderdoesntmiss" class="csl-entry" role="listitem">
Nelder, John. 1999. <span>“From Statistics to Statistical Science.”</span> <em>Journal of the Royal Statistical Society: Series D (The Statistician)</em> 48 (2): 257–69. <a href="https://doi.org/10.1111/1467-9884.00187">https://doi.org/10.1111/1467-9884.00187</a>.
</div>
<div id="ref-Neufeld2021" class="csl-entry" role="listitem">
Neufeld, Anna, and Daniela Witten. 2021. <span>“Discussion of Breiman’s "Two Cultures": From Two Cultures to One.”</span> <em>Observational Studies</em> 7 (1): 171–74. <a href="https://doi.org/10.1353/obs.2021.0004">https://doi.org/10.1353/obs.2021.0004</a>.
</div>
<div id="ref-pitman" class="csl-entry" role="listitem">
Pitman, Jim. 1993. <em>Probability</em>. 1st ed. New York: Springer. <a href="https://doi.org/10.1007/978-1-4612-4374-8">https://doi.org/10.1007/978-1-4612-4374-8</a>.
</div>
<div id="ref-citeR" class="csl-entry" role="listitem">
R Core Team. 2023. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-reid2003asymptotics" class="csl-entry" role="listitem">
Reid, Nancy. 2003. <span>“Asymptotics and the Theory of Inference.”</span> <em>The Annals of Statistics</em> 31 (6): 1695–1731. <a href="https://doi.org/10.1214/aos/1074290325">https://doi.org/10.1214/aos/1074290325</a>.
</div>
<div id="ref-broom" class="csl-entry" role="listitem">
Robinson, David, Alex Hayes, and Simon Couch. 2022. <em><span class="nocase">broom: Convert Statistical Objects into Tidy Tibbles</span></em>. <a href="https://CRAN.R-project.org/package=broom">https://CRAN.R-project.org/package=broom</a>.
</div>
<div id="ref-Staicu2017" class="csl-entry" role="listitem">
Staicu, Ana-Maria. 2017. <span>“Interview with Nancy Reid.”</span> <em>International Statistical Review</em> 85 (3): 381–403. <a href="https://doi.org/10.1111/insr.12237">https://doi.org/10.1111/insr.12237</a>.
</div>
<div id="ref-stigler" class="csl-entry" role="listitem">
Stigler, Stephen. 1986. <em>The History of Statistics</em>. Massachusetts: Belknap Harvard.
</div>
<div id="ref-student1908probable" class="csl-entry" role="listitem">
Student. 1908. <span>“The Probable Error of a Mean.”</span> <em>Biometrika</em> 6 (1): 1–25. <a href="https://doi.org/10.2307/2331554">https://doi.org/10.2307/2331554</a>.
</div>
<div id="ref-varin2011overview" class="csl-entry" role="listitem">
Varin, Cristiano, Nancy Reid, and David Firth. 2011. <span>“An Overview of Composite Likelihood Methods.”</span> <em>Statistica Sinica</em>, 5–42. <a href="https://www.jstor.org/stable/24309261">https://www.jstor.org/stable/24309261</a>.
</div>
<div id="ref-wasserman" class="csl-entry" role="listitem">
Wasserman, Larry. 2005. <em>All of Statistics</em>. Springer.
</div>
<div id="ref-testthat" class="csl-entry" role="listitem">
Wickham, Hadley. 2011. <span>“<span class="nocase">testthat: Get Started with Testing</span>.”</span> <em>The R Journal</em> 3: 5–10. <a href="https://journal.r-project.org/archive/2011-1/RJournal%5F2011-1%5FWickham.pdf">https://journal.r-project.org/archive/2011-1/RJournal%5F2011-1%5FWickham.pdf</a>.
</div>
<div id="ref-tidyverse" class="csl-entry" role="listitem">
Wickham, Hadley, Mara Averick, Jenny Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“<span class="nocase">Welcome to the Tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
<div id="ref-citepurrr" class="csl-entry" role="listitem">
Wickham, Hadley, and Lionel Henry. 2022. <em><span class="nocase">purrr: Functional Programming Tools</span></em>. <a href="https://CRAN.R-project.org/package=purrr">https://CRAN.R-project.org/package=purrr</a>.
</div>
<div id="ref-wilde" class="csl-entry" role="listitem">
Wilde, Oscar. 1891. <em>The Picture of Dorian Gray</em>. <a href="https://www.gutenberg.org/files/174/174-h/174-h.htm">https://www.gutenberg.org/files/174/174-h/174-h.htm</a>.
</div>
<div id="ref-wood" class="csl-entry" role="listitem">
Wood, Simon. 2015. <em>Core Statistics</em>. Cambridge University Press. <a href="https://www.maths.ed.ac.uk/\%7Eswood34/core-statistics.pdf">https://www.maths.ed.ac.uk/\%7Eswood34/core-statistics.pdf</a>.
</div>
<div id="ref-citeknitr" class="csl-entry" role="listitem">
Xie, Yihui. 2023. <em><span class="nocase">knitr: A General-Purpose Package for Dynamic Report Generation in R</span></em>. <a href="https://yihui.org/knitr/">https://yihui.org/knitr/</a>.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Given the small sample size in the example of 20, we strictly should use the finite-sample adjustment, but as this is not the focus of this book we will move forward with the general approach.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./11-eda.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./13-ijaglm.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Generalized linear models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>